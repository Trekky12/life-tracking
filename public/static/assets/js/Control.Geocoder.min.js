!function(t,e){"object"==typeof exports&&typeof module<"u"?e(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],e):e((t=typeof globalThis<"u"?globalThis:t||self)["leaflet-control-geocoder"]={},t.L)}(this,(function(t,e){"use strict";const o=function(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t)for(const o in t)if("default"!==o){const s=Object.getOwnPropertyDescriptor(t,o);Object.defineProperty(e,o,s.get?s:{enumerable:!0,get:()=>t[o]})}return e.default=t,Object.freeze(e)}(e);function s(t,e){return Object.assign(e,t.geocodingQueryParams)}function n(t,e){return Object.assign(e,t.reverseQueryParams)}const i=/[&<>"'`]/g,r=/[&<>"'`]/,a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function c(t){return a[t]}function l(t,e){const o=new URL(t);return Object.entries(e).forEach((([t,e])=>{(Array.isArray(e)?e:[e]).forEach((e=>{o.searchParams.append(t,e)}))})),fetch(o.toString(),{headers:{Accept:"application/json"}}).then((t=>t.json()))}function p(t,e){return t.replace(/\{ *([\w_]+) *\}/g,((t,o)=>{let s=e[o];return void 0===s?s="":"function"==typeof s&&(s=s(e)),function(t){return null==t?"":t?(t=""+t,r.test(t)?t.replace(i,c):t):t+""}(s)}))}class d{options={serviceUrl:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",apiKey:""};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=s(this.options,{token:this.options.apiKey,SingleLine:t,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"});return(await l(this.options.serviceUrl+"/findAddressCandidates",e)).candidates.map((t=>{const e=new o.LatLng(t.location.y,t.location.x),s=new o.LatLngBounds(new o.LatLng(t.extent.ymax,t.extent.xmax),new o.LatLng(t.extent.ymin,t.extent.xmin));return{name:t.address,bbox:s,center:e}}))}suggest(t){return this.geocode(t)}async reverse(t,e){const s=n(this.options,{location:t.lng+","+t.lat,distance:100,f:"json"}),i=await l(this.options.serviceUrl+"/reverseGeocode",s);if(!i||i.error)return[];const r=new o.LatLng(i.location.y,i.location.x),a=new o.LatLngBounds(r,r);return[{name:i.address.Match_addr,center:r,bbox:a}]}}class u{options={serviceUrl:"https://dev.virtualearth.net/REST/v1/Locations/"};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=s(this.options,{query:t,key:this.options.apiKey}),o=await l(this.options.serviceUrl,e);return this._parseResults(o)}async reverse(t,e){const o=n(this.options,{key:this.options.apiKey}),s=await l(this.options.serviceUrl+t.lat+","+t.lng,o);return this._parseResults(s)}_parseResults(t){return t.resourceSets[0].resources.map((t=>{const e=t.bbox;return{name:t.name,bbox:new o.LatLngBounds([e[0],e[1]],[e[2],e[3]]),center:new o.LatLng(...t.point.coordinates)}}))}}class h{options={apiKey:"",serviceUrl:"https://atlas.microsoft.com/search"};constructor(t){if(o.Util.setOptions(this,t),!this.options.apiKey)throw new Error("Azure Maps Geocoder requires an API key.")}async geocode(t){const e={"api-version":"1.0",query:t,"subscription-key":this.options.apiKey},s=this.options.serviceUrl+"/address/json";return((await l(s,e)).results||[]).map((t=>({name:t.address.freeformAddress,bbox:new o.LatLngBounds([t.viewport.topLeftPoint.lat,t.viewport.topLeftPoint.lon],[t.viewport.btmRightPoint.lat,t.viewport.btmRightPoint.lon]),center:new o.LatLng(t.position.lat,t.position.lon)})))}async reverse(t,e){const s={"api-version":"1.0",query:t.lat+","+t.lng,"subscription-key":this.options.apiKey},n=this.options.serviceUrl+"/address/reverse/json";return((await l(n,s)).addresses||[]).map((e=>({name:e.address.freeformAddress,bbox:new o.LatLngBounds([e.viewport.topLeftPoint.lat,e.viewport.topLeftPoint.lon],[e.viewport.btmRightPoint.lat,e.viewport.btmRightPoint.lon]),center:new o.LatLng(t.lat,t.lng)})))}}class g{options={serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json"};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=s(this.options,{key:this.options.apiKey,address:t}),o=await l(this.options.serviceUrl,e);return this._parseResults(o)}async reverse(t,e){const o=n(this.options,{key:this.options.apiKey,latlng:t.lat+","+t.lng}),s=await l(this.options.serviceUrl,o);return this._parseResults(s)}_parseResults(t){return(t.results||[])?.map((t=>{const e=new o.LatLng(t.geometry.location.lat,t.geometry.location.lng),s=new o.LatLngBounds(new o.LatLng(t.geometry.viewport.northeast.lat,t.geometry.viewport.northeast.lng),new o.LatLng(t.geometry.viewport.southwest.lat,t.geometry.viewport.southwest.lng));return{name:t.formatted_address,bbox:s,center:e,properties:t.address_components}}))}}class m{options={serviceUrl:"https://geocoder.api.here.com/6.2/",app_id:"",app_code:"",apiKey:"",maxResults:5};constructor(t){if(o.Util.setOptions(this,t),t?.apiKey)throw Error("apiKey is not supported, use app_id/app_code instead!")}geocode(t){const e=s(this.options,{searchtext:t,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"geocode.json",e)}reverse(t,e){let o=t.lat+","+t.lng;this.options.reverseGeocodeProxRadius&&(o+=","+this.options.reverseGeocodeProxRadius);const s=n(this.options,{prox:o,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"reversegeocode.json",s)}async getJSON(t,e){return((await l(t,e)).response.view?.[0]?.result||[]).map((t=>{const e=t.location,s=new o.LatLng(e.displayPosition.latitude,e.displayPosition.longitude),n=new o.LatLngBounds(new o.LatLng(e.mapView.topLeft.latitude,e.mapView.topLeft.longitude),new o.LatLng(e.mapView.bottomRight.latitude,e.mapView.bottomRight.longitude));return{name:e.address.label,properties:e.address,bbox:n,center:s}}))}}class L{options={serviceUrl:"https://geocode.search.hereapi.com/v1",apiKey:"",app_id:"",app_code:"",maxResults:10};constructor(t){o.Util.setOptions(this,t)}geocode(t){const e=s(this.options,{q:t,apiKey:this.options.apiKey,limit:this.options.maxResults});if(!e.at&&!e.in)throw Error("at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.");return this.getJSON(this.options.serviceUrl+"/discover",e)}reverse(t,e){const o=n(this.options,{at:t.lat+","+t.lng,limit:this.options.reverseGeocodeProxRadius,apiKey:this.options.apiKey});return this.getJSON(this.options.serviceUrl+"/revgeocode",o)}async getJSON(t,e){return((await l(t,e)).items||[]).map((t=>{const e=new o.LatLng(t.position.lat,t.position.lng);let s;return s=t.mapView?new o.LatLngBounds(new o.LatLng(t.mapView.south,t.mapView.west),new o.LatLng(t.mapView.north,t.mapView.east)):new o.LatLngBounds(new o.LatLng(t.position.lat,t.position.lng),new o.LatLng(t.position.lat,t.position.lng)),{name:t.address.label,properties:t.address,bbox:s,center:e}}))}}function w(t){let e;return(e=t.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?new o.LatLng((/N/i.test(e[1])?1:-1)*+e[2],(/E/i.test(e[3])?1:-1)*+e[4]):(e=t.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?new o.LatLng((/N/i.test(e[2])?1:-1)*+e[1],(/E/i.test(e[4])?1:-1)*+e[3]):(e=t.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?$/))?new o.LatLng((/N/i.test(e[1])?1:-1)*(+e[2]+ +e[3]/60),(/E/i.test(e[4])?1:-1)*(+e[5]+ +e[6]/60)):(e=t.match(/^(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([NS])\W*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([EW])$/))?new o.LatLng((/N/i.test(e[3])?1:-1)*(+e[1]+ +e[2]/60),(/E/i.test(e[6])?1:-1)*(+e[4]+ +e[5]/60)):(e=t.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?$/))?new o.LatLng((/N/i.test(e[1])?1:-1)*(+e[2]+ +e[3]/60+ +e[4]/3600),(/E/i.test(e[5])?1:-1)*(+e[6]+ +e[7]/60+ +e[8]/3600)):(e=t.match(/^(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]\s*([NS])\W*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\s*([EW])$/))?new o.LatLng((/N/i.test(e[4])?1:-1)*(+e[1]+ +e[2]/60+ +e[3]/3600),(/E/i.test(e[8])?1:-1)*(+e[5]+ +e[6]/60+ +e[7]/3600)):(e=t.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))?new o.LatLng(+e[1],+e[2]):void 0}class v{options={next:void 0,sizeInMeters:1e4};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=w(t);return e?[{name:t,center:e,bbox:e.toBounds(this.options.sizeInMeters)}]:this.options.next?this.options.next.geocode(t):[]}}class _{options={serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/"};constructor(t){o.Util.setOptions(this,t)}_getProperties(t){const e={text:t.text,address:t.address};return(t.context||[]).forEach((t=>{const o=t.id.split(".")[0];e[o]=t.text,t.short_code&&(e.countryShortCode=t.short_code)})),e}async geocode(t){const e=this.options.serviceUrl+encodeURIComponent(t)+".json",o=s(this.options,{access_token:this.options.apiKey});void 0!==o.proximity&&void 0!==o.proximity.lat&&void 0!==o.proximity.lng&&(o.proximity=o.proximity.lng+","+o.proximity.lat);const n=await l(e,o);return this._parseResults(n)}suggest(t){return this.geocode(t)}async reverse(t,e){const o=this.options.serviceUrl+t.lng+","+t.lat+".json",s=n(this.options,{access_token:this.options.apiKey}),i=await l(o,s);return this._parseResults(i)}_parseResults(t){return t.features?.length?t.features.map((t=>{const e=new o.LatLng(...t.center.reverse());let s;return s=t.bbox?new o.LatLngBounds(new o.LatLng(...t.bbox.slice(0,2).reverse()),new o.LatLng(...t.bbox.slice(2,4).reverse())):new o.LatLngBounds(e,e),{name:t.place_name,bbox:s,center:e,properties:this._getProperties(t)}})):[]}}class y{options={serviceUrl:"https://www.mapquestapi.com/geocoding/v1"};constructor(t){o.Util.setOptions(this,t),this.options.apiKey=decodeURIComponent(this.options.apiKey)}_formatName(...t){return t.filter((t=>!!t)).join(", ")}async geocode(t){const e=s(this.options,{key:this.options.apiKey,location:t,limit:5,outFormat:"json"}),o=await l(this.options.serviceUrl+"/address",e);return this._parseResults(o)}async reverse(t,e){const o=n(this.options,{key:this.options.apiKey,location:t.lat+","+t.lng,outputFormat:"json"}),s=await l(this.options.serviceUrl+"/reverse",o);return this._parseResults(s)}_parseResults(t){return(t.results?.[0]?.locations||[]).map((t=>{const e=new o.LatLng(t.latLng.lat,t.latLng.lng);return{name:this._formatName(t.street,t.adminArea4,t.adminArea3,t.adminArea1),bbox:new o.LatLngBounds(e,e),center:e}}))}}class b{options={userId:"",apiKey:"",serviceUrl:"https://neutrinoapi.com/"};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=s(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,address:t.split(/\s+/).join(".")}),n=await l(this.options.serviceUrl+"geocode-address",e);if(!n.locations)return[];n.geometry=n.locations[0];const i=new o.LatLng(n.geometry.latitude,n.geometry.longitude),r=new o.LatLngBounds(i,i);return[{name:n.geometry.address,bbox:r,center:i}]}suggest(t){return this.geocode(t)}async reverse(t,e){const s=n(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,latitude:t.lat,longitude:t.lng}),i=await l(this.options.serviceUrl+"geocode-reverse",s);if(200!==i.status.status||!i.found)return[];const r=new o.LatLng(t.lat,t.lng),a=new o.LatLngBounds(r,r);return[{name:i.address,bbox:a,center:r}]}}class f{options={serviceUrl:"https://nominatim.openstreetmap.org/",htmlTemplate(t){const e=t.address;let o;const s=[];return(e.road||e.building)&&s.push("{building} {road} {house_number}"),(e.city||e.town||e.village||e.hamlet)&&(o=s.length>0?"leaflet-control-geocoder-address-detail":"",s.push('<span class="'+o+'">{postcode} {city} {town} {village} {hamlet}</span>')),(e.state||e.country)&&(o=s.length>0?"leaflet-control-geocoder-address-context":"",s.push('<span class="'+o+'">{state} {country}</span>')),p(s.join("<br/>"),e)}};constructor(t){o.Util.setOptions(this,t||{})}async geocode(t){const e=s(this.options,{q:t,limit:5,format:"json",addressdetails:1});return(await l(this.options.serviceUrl+"search",e)).map((t=>{const e=t.boundingbox;return{icon:t.icon,name:t.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,bbox:new o.LatLngBounds([+e[0],+e[2]],[+e[1],+e[3]]),center:new o.LatLng(+t.lat,+t.lon),properties:t}}))}async reverse(t,e){const s=n(this.options,{lat:t.lat,lon:t.lng,zoom:Math.round(Math.log(e/256)/Math.log(2)),addressdetails:1,format:"json"}),i=await l(this.options.serviceUrl+"reverse",s);if(!i?.lat||!i?.lon)return[];const r=new o.LatLng(+i.lat,+i.lon),a=new o.LatLngBounds(r,r);return[{name:i.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(i):void 0,center:r,bbox:a,properties:i}]}}class x{options={};constructor(t){o.Util.setOptions(this,t)}async geocode(t){try{const e=this.options.OpenLocationCode.decode(t);return[{name:t,center:new o.LatLng(e.latitudeCenter,e.longitudeCenter),bbox:new o.LatLngBounds(new o.LatLng(e.latitudeLo,e.longitudeLo),new o.LatLng(e.latitudeHi,e.longitudeHi))}]}catch(t){return console.warn(t),[]}}async reverse(t,e){try{return[{name:this.options.OpenLocationCode.encode(t.lat,t.lng,this.options.codeLength),center:new o.LatLng(t.lat,t.lng),bbox:new o.LatLngBounds(new o.LatLng(t.lat,t.lng),new o.LatLng(t.lat,t.lng))}]}catch(t){return console.warn(t),[]}}}class U{options={serviceUrl:"https://api.opencagedata.com/geocode/v1/json"};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=s(this.options,{key:this.options.apiKey,q:t}),o=await l(this.options.serviceUrl,e);return this._parseResults(o)}suggest(t){return this.geocode(t)}async reverse(t,e){const o=n(this.options,{key:this.options.apiKey,q:[t.lat,t.lng].join(",")}),s=await l(this.options.serviceUrl,o);return this._parseResults(s)}_parseResults(t){return(t.results||[]).map((t=>{const e=new o.LatLng(t.geometry.lat,t.geometry.lng),s=t.annotations&&t.annotations.bounds?new o.LatLngBounds(new o.LatLng(t.annotations.bounds.northeast.lat,t.annotations.bounds.northeast.lng),new o.LatLng(t.annotations.bounds.southwest.lat,t.annotations.bounds.southwest.lng)):new o.LatLngBounds(e,e);return{name:t.formatted,bbox:s,center:e,properties:t}}))}}class R{options={serviceUrl:"https://api.geocode.earth/v1"};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=s(this.options,{api_key:this.options.apiKey,text:t}),o=await l(this.options.serviceUrl+"/search",e);return this._parseResults(o)}async suggest(t){const e=s(this.options,{api_key:this.options.apiKey,text:t}),o=await l(this.options.serviceUrl+"/autocomplete",e);return this._parseResults(o)}async reverse(t,e){const o=n(this.options,{api_key:this.options.apiKey,"point.lat":t.lat,"point.lon":t.lng}),s=await l(this.options.serviceUrl+"/reverse",o);return this._parseResults(s)}_parseResults(t){return(t.features||[]).map((t=>{const e=t.geometry.coordinates,s=new o.LatLng(e[1],e[0]),n=Array.isArray(t.bbox)&&4===t.bbox.length?new o.LatLngBounds([t.bbox[1],t.bbox[0]],[t.bbox[3],t.bbox[2]]):new o.LatLngBounds(s,s);return{name:t.properties.label,center:s,bbox:n,properties:t.properties}}))}}function E(t){return new R(t)}const k=R,O=E,j=R,P=E;class K extends R{constructor(t){super(Object.assign({serviceUrl:"https://api.openrouteservice.org/geocode"},t))}}class B{options={serviceUrl:"https://photon.komoot.io/api/",reverseUrl:"https://photon.komoot.io/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]};constructor(t){o.Util.setOptions(this,t)}async geocode(t,e){const o=s(this.options,{q:t}),n=e?.map?.getCenter?.();n&&(o.lat=n.lat,o.lon=n.lng);const i=e?.map?.getZoom?.();i&&(o.zoom=i);const r=await l(this.options.serviceUrl,o);return this._parseResults(r)}suggest(t){return this.geocode(t)}async reverse(t,e){const o=n(this.options,{lat:t.lat,lon:t.lng}),s=await l(this.options.reverseUrl,o);return this._parseResults(s)}_parseResults(t){return(t.features||[]).map((t=>{const e=t.geometry.coordinates,s=new o.LatLng(e[1],e[0]),n=t.properties?.extent,i=n?new o.LatLngBounds([n[1],n[0]],[n[3],n[2]]):new o.LatLngBounds(s,s);return{name:this._decodeFeatureName(t),html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,center:s,bbox:i,properties:t.properties}}))}_decodeFeatureName(t){return(this.options.nameProperties||[]).map((e=>t.properties?.[e])).filter((t=>!!t)).join(", ")}}class C{options={serviceUrl:"https://api.what3words.com/v2/"};constructor(t){o.Util.setOptions(this,t)}async geocode(t){const e=await l(this.options.serviceUrl+"forward",s(this.options,{key:this.options.apiKey,addr:t.split(/\s+/).join(".")}));if(!e.geometry)return[];const n=new o.LatLng(e.geometry.lat,e.geometry.lng),i=new o.LatLngBounds(n,n);return[{name:e.words,bbox:i,center:n}]}suggest(t){return this.geocode(t)}async reverse(t,e){const s=await l(this.options.serviceUrl+"reverse",n(this.options,{key:this.options.apiKey,coords:[t.lat,t.lng].join(",")}));if(200!=s.status.status)return[];const i=new o.LatLng(s.geometry.lat,s.geometry.lng),r=new o.LatLngBounds(i,i);return[{name:s.words,bbox:r,center:i}]}}const T=Object.freeze(Object.defineProperty({__proto__:null,ArcGis:d,AzureMaps:h,Bing:u,GeocodeEarth:k,Google:g,HERE:m,HEREv2:L,LatLng:v,MapQuest:y,Mapbox:_,Mapzen:j,Neutrino:b,Nominatim:f,OpenCage:U,OpenLocationCode:x,Openrouteservice:K,Pelias:R,Photon:B,What3Words:C,arcgis:function(t){return new d(t)},azure:function(t){return new h(t)},bing:function(t){return new u(t)},geocodeEarth:O,geocodingParams:s,google:function(t){return new g(t)},here:function(t){return t?.apiKey?new L(t):new m(t)},latLng:function(t){return new v(t)},mapQuest:function(t){return new y(t)},mapbox:function(t){return new _(t)},mapzen:P,neutrino:function(t){return new b(t)},nominatim:function(t){return new f(t)},openLocationCode:function(t){return new x(t)},opencage:function(t){return new U(t)},openrouteservice:function(t){return new K(t)},parseLatLng:w,pelias:E,photon:function(t){return new B(t)},reverseParams:n,what3words:function(t){return new C(t)}},Symbol.toStringTag,{value:"Module"}));class M{constructor(...t){}}Object.getOwnPropertyNames(o.Control.prototype).forEach((t=>M.prototype[t]=o.Control.prototype[t])),Object.getOwnPropertyNames(o.Evented.prototype).forEach((t=>M.prototype[t]=o.Evented.prototype[t]));class S extends M{options={showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",iconLabel:"Initiate a new search",query:"",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0};_alts;_container;_errorElement;_geocodeMarker;_input;_lastGeocode;_map;_preventBlurCollapse;_requestCount=0;_results;_selection;_suggestTimeout;constructor(t){super(t),o.Util.setOptions(this,t),this.options.geocoder||(this.options.geocoder=new f)}addThrobberClass(){this._container.classList.add("leaflet-control-geocoder-throbber")}removeThrobberClass(){this._container.classList.remove("leaflet-control-geocoder-throbber")}onAdd(t){const e="leaflet-control-geocoder",s=o.DomUtil.create("div",e+" leaflet-bar"),n=o.DomUtil.create("button",e+"-icon",s),i=o.DomUtil.create("div",e+"-form",s);this._map=t,this._container=s,n.innerHTML="&nbsp;",n.type="button",n.setAttribute("aria-label",this.options.iconLabel);const r=this._input=o.DomUtil.create("input","",i);return r.type="search",r.value=this.options.query,r.placeholder=this.options.placeholder,o.DomEvent.disableClickPropagation(r),this._errorElement=o.DomUtil.create("div",e+"-form-no-error",s),this._errorElement.innerHTML=this.options.errorMessage,this._alts=o.DomUtil.create("ul",e+"-alternatives leaflet-control-geocoder-alternatives-minimized",s),o.DomEvent.disableClickPropagation(this._alts),o.DomEvent.on(r,"keydown",this._keydown,this),this.options.geocoder?.suggest&&o.DomEvent.on(r,"input",this._change,this),o.DomEvent.on(r,"blur",(()=>{this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1})),this.options.collapsed?"click"===this.options.expand?o.DomEvent.on(s,"click",(t=>{0===t.button&&2!==t.detail&&this._toggle()})):"touch"===this.options.expand?o.DomEvent.on(s,o.Browser.touch?"touchstart mousedown":"mousedown",(t=>{this._toggle(),t.preventDefault(),t.stopPropagation()}),this):(o.DomEvent.on(s,"mouseover",this._expand,this),o.DomEvent.on(s,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),o.Browser.touch?o.DomEvent.on(s,"touchstart",(()=>this._geocode())):o.DomEvent.on(s,"click",(()=>this._geocode()))),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),o.DomEvent.disableClickPropagation(s),s}setQuery(t){return this._input.value=t,this}_geocodeResult(t,e){!e&&this.options.showUniqueResult&&1===t.length?this._geocodeResultSelected(t[0]):t.length>0?(this._alts.innerHTML="",this._results=t,this._alts.classList.remove("leaflet-control-geocoder-alternatives-minimized"),this._container.classList.add("leaflet-control-geocoder-options-open"),this._results.forEach(((t,e)=>this._alts.appendChild(this._createAlt(t,e))))):(this._container.classList.add("leaflet-control-geocoder-options-error"),this._errorElement.classList.add("leaflet-control-geocoder-error"))}markGeocode(t){const e=t.geocode;return this._map.fitBounds(e.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new o.Marker(e.center).bindPopup(e.html||e.name).addTo(this._map).openPopup(),this}async _geocode(t=!1){const e=this._input.value;if(!t&&e.length<this.options.queryMinLength)return;const o=++this._requestCount;this._lastGeocode=e,t||this._clearResults();const s={input:e};this.fire(t?"startsuggest":"startgeocode",s);const n={map:this._map},i=t?await this.options.geocoder.suggest(e,n):await this.options.geocoder.geocode(e,n);if(o===this._requestCount){const o={input:e,results:i};this.fire(t?"finishsuggest":"finishgeocode",o),this._geocodeResult(i,t)}}_geocodeResultSelected(t){const e={geocode:t};this.fire("markgeocode",e)}_toggle(){this._container.classList.contains("leaflet-control-geocoder-expanded")?this._collapse():this._expand()}_expand(){this._container.classList.add("leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")}_collapse(){this._container.classList.remove("leaflet-control-geocoder-expanded"),this._alts.classList.add("leaflet-control-geocoder-alternatives-minimized"),this._errorElement.classList.remove("leaflet-control-geocoder-error"),this._container.classList.remove("leaflet-control-geocoder-options-open"),this._container.classList.remove("leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")}_clearResults(){this._alts.classList.add("leaflet-control-geocoder-alternatives-minimized"),this._selection=null,this._errorElement.classList.remove("leaflet-control-geocoder-error"),this._container.classList.remove("leaflet-control-geocoder-options-open"),this._container.classList.remove("leaflet-control-geocoder-options-error")}_createAlt(t,e){const s=o.DomUtil.create("li",""),n=o.DomUtil.create("a","",s),i=this.options.showResultIcons&&t.icon?o.DomUtil.create("img","",n):null,r=t.html?void 0:document.createTextNode(t.name);return i&&(i.src=t.icon),s.setAttribute("data-result-index",String(e)),t.html?n.innerHTML=n.innerHTML+t.html:r&&n.appendChild(r),o.DomEvent.on(s,"mousedown touchstart",(e=>{this._preventBlurCollapse=!0,o.DomEvent.stop(e),this._geocodeResultSelected(t),o.DomEvent.on(s,"click touchend",(()=>{this.options.collapsed?this._collapse():this._clearResults()}))}),this),s}_keydown(t){const e=t=>{this._selection&&(this._selection.classList.remove("leaflet-control-geocoder-selected"),this._selection=this._selection[t>0?"nextSibling":"previousSibling"]),this._selection||(this._selection=this._alts[t>0?"firstChild":"lastChild"]),this._selection&&this._selection.classList.add("leaflet-control-geocoder-selected")};switch(t.key){case"Escape":this.options.collapsed?this._collapse():this._clearResults();break;case"ArrowUp":e(-1);break;case"ArrowDown":e(1);break;case"Enter":if(this._selection){const t=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[t]),this._clearResults()}else this._geocode();break;default:return}o.DomEvent.preventDefault(t)}_change(){const t=this._input.value;t!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),t.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout((()=>this._geocode(!0)),this.options.suggestTimeout):this._clearResults())}}function D(t){return new S(t)}
/* @preserve
 * Leaflet Control Geocoder
 * https://github.com/perliedman/leaflet-control-geocoder
 *
 * Copyright (c) 2012 sa3m (https://github.com/sa3m)
 * Copyright (c) 2018 Per Liedman
 * All rights reserved.
 */Object.assign(S,T),Object.assign(o.Control,{Geocoder:S,geocoder:D}),t.Geocoder=S,t.default=S,t.geocoder=D,t.geocoders=T,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));