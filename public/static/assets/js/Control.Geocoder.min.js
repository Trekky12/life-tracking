!function(t,e){"object"==typeof exports&&typeof module<"u"?e(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],e):e((t=typeof globalThis<"u"?globalThis:t||self)["leaflet-control-geocoder"]={},t.L)}(this,(function(t,e){"use strict";var s=Object.defineProperty,o=(t,e,o)=>((t,e,o)=>e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o)(t,"symbol"!=typeof e?e+"":e,o);const n=function(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t)for(const s in t)if("default"!==s){const o=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:()=>t[s]})}return e.default=t,Object.freeze(e)}(e);function i(t,e){return n.Util.extend(e,t.geocodingQueryParams)}function r(t,e){return n.Util.extend(e,t.reverseQueryParams)}const a=/[&<>"'`]/g,l=/[&<>"'`]/,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function p(t){return c[t]}function d(t,e){const s=new URL(t);return Object.entries(e).forEach((([t,e])=>{(Array.isArray(e)?e:[e]).forEach((e=>{s.searchParams.append(t,e)}))})),fetch(s.toString(),{headers:{Accept:"application/json"}}).then((t=>t.json()))}function h(t,e){return t.replace(/\{ *([\w_]+) *\}/g,((t,s)=>{let o=e[s];return void 0===o?o="":"function"==typeof o&&(o=o(e)),function(t){return null==t?"":t?(t=""+t,l.test(t)?t.replace(a,p):t):t+""}(o)}))}class u{constructor(t){o(this,"options",{serviceUrl:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",apiKey:""}),n.Util.setOptions(this,t)}async geocode(t){const e=i(this.options,{token:this.options.apiKey,SingleLine:t,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"}),s=await d(this.options.serviceUrl+"/findAddressCandidates",e),o=[];if(s.candidates&&s.candidates.length)for(let t=0;t<=s.candidates.length-1;t++){const e=s.candidates[t],i=n.latLng(e.location.y,e.location.x),r=n.latLngBounds(n.latLng(e.extent.ymax,e.extent.xmax),n.latLng(e.extent.ymin,e.extent.xmin));o[t]={name:e.address,bbox:r,center:i}}return o}suggest(t){return this.geocode(t)}async reverse(t,e){const s=r(this.options,{location:t.lng+","+t.lat,distance:100,f:"json"}),o=await d(this.options.serviceUrl+"/reverseGeocode",s),i=[];if(o&&!o.error){const t=n.latLng(o.location.y,o.location.x),e=n.latLngBounds(t,t);i.push({name:o.address.Match_addr,center:t,bbox:e})}return i}}class g{constructor(t){o(this,"options",{serviceUrl:"https://dev.virtualearth.net/REST/v1/Locations/"}),n.Util.setOptions(this,t)}async geocode(t){const e=i(this.options,{query:t,key:this.options.apiKey}),s=await d(this.options.serviceUrl,e),o=[];if(s.resourceSets.length>0)for(let t=s.resourceSets[0].resources.length-1;t>=0;t--){const e=s.resourceSets[0].resources[t],i=e.bbox;o[t]={name:e.name,bbox:n.latLngBounds([i[0],i[1]],[i[2],i[3]]),center:n.latLng(e.point.coordinates)}}return o}async reverse(t,e){const s=r(this.options,{key:this.options.apiKey}),o=await d(this.options.serviceUrl+t.lat+","+t.lng,s),i=[];for(let t=o.resourceSets[0].resources.length-1;t>=0;t--){const e=o.resourceSets[0].resources[t],s=e.bbox;i[t]={name:e.name,bbox:n.latLngBounds([s[0],s[1]],[s[2],s[3]]),center:n.latLng(e.point.coordinates)}}return i}}class m{constructor(t){if(o(this,"options",{apiKey:"",serviceUrl:"https://atlas.microsoft.com/search"}),n.Util.setOptions(this,t),!this.options.apiKey)throw new Error("Azure Maps Geocoder requires an API key.")}async geocode(t){const e={"api-version":"1.0",query:t,"subscription-key":this.options.apiKey},s=this.options.serviceUrl+"/address/json",o=await d(s,e),i=[];if(o.results&&o.results.length>0)for(const t of o.results)i.push({name:t.address.freeformAddress,bbox:n.latLngBounds([t.viewport.topLeftPoint.lat,t.viewport.topLeftPoint.lon],[t.viewport.btmRightPoint.lat,t.viewport.btmRightPoint.lon]),center:n.latLng(t.position.lat,t.position.lon)});return i}async reverse(t,e){const s={"api-version":"1.0",query:t.lat+","+t.lng,"subscription-key":this.options.apiKey},o=this.options.serviceUrl+"/address/reverse/json",i=await d(o,s),r=[];if(i.addresses&&i.addresses.length>0)for(const e of i.addresses)r.push({name:e.address.freeformAddress,bbox:n.latLngBounds([e.viewport.topLeftPoint.lat,e.viewport.topLeftPoint.lon],[e.viewport.btmRightPoint.lat,e.viewport.btmRightPoint.lon]),center:n.latLng(t.lat,t.lng)});return r}}class v{constructor(t){o(this,"options",{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json"}),n.Util.setOptions(this,t)}async geocode(t){const e=i(this.options,{key:this.options.apiKey,address:t}),s=await d(this.options.serviceUrl,e),o=[];if(s.results&&s.results.length)for(let t=0;t<=s.results.length-1;t++){const e=s.results[t],i=n.latLng(e.geometry.location),r=n.latLngBounds(n.latLng(e.geometry.viewport.northeast),n.latLng(e.geometry.viewport.southwest));o[t]={name:e.formatted_address,bbox:r,center:i,properties:e.address_components}}return o}async reverse(t,e){const s=r(this.options,{key:this.options.apiKey,latlng:t.lat+","+t.lng}),o=await d(this.options.serviceUrl,s),i=[];if(o.results&&o.results.length)for(let t=0;t<=o.results.length-1;t++){const e=o.results[t],s=n.latLng(e.geometry.location),r=n.latLngBounds(n.latLng(e.geometry.viewport.northeast),n.latLng(e.geometry.viewport.southwest));i[t]={name:e.formatted_address,bbox:r,center:s,properties:e.address_components}}return i}}class f{constructor(t){if(o(this,"options",{serviceUrl:"https://geocoder.api.here.com/6.2/",app_id:"",app_code:"",apiKey:"",maxResults:5}),n.Util.setOptions(this,t),null!=t&&t.apiKey)throw Error("apiKey is not supported, use app_id/app_code instead!")}geocode(t){const e=i(this.options,{searchtext:t,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"geocode.json",e)}reverse(t,e){let s=t.lat+","+t.lng;this.options.reverseGeocodeProxRadius&&(s+=","+this.options.reverseGeocodeProxRadius);const o=r(this.options,{prox:s,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"reversegeocode.json",o)}async getJSON(t,e){const s=await d(t,e),o=[];if(s.response.view&&s.response.view.length)for(let t=0;t<=s.response.view[0].result.length-1;t++){const e=s.response.view[0].result[t].location,i=n.latLng(e.displayPosition.latitude,e.displayPosition.longitude),r=n.latLngBounds(n.latLng(e.mapView.topLeft.latitude,e.mapView.topLeft.longitude),n.latLng(e.mapView.bottomRight.latitude,e.mapView.bottomRight.longitude));o[t]={name:e.address.label,properties:e.address,bbox:r,center:i}}return o}}class _{constructor(t){o(this,"options",{serviceUrl:"https://geocode.search.hereapi.com/v1",apiKey:"",app_id:"",app_code:"",maxResults:10}),n.Util.setOptions(this,t)}geocode(t){const e=i(this.options,{q:t,apiKey:this.options.apiKey,limit:this.options.maxResults});if(!e.at&&!e.in)throw Error("at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.");return this.getJSON(this.options.serviceUrl+"/discover",e)}reverse(t,e){const s=r(this.options,{at:t.lat+","+t.lng,limit:this.options.reverseGeocodeProxRadius,apiKey:this.options.apiKey});return this.getJSON(this.options.serviceUrl+"/revgeocode",s)}async getJSON(t,e){const s=await d(t,e),o=[];if(s.items&&s.items.length)for(let t=0;t<=s.items.length-1;t++){const e=s.items[t],i=n.latLng(e.position.lat,e.position.lng);let r;r=e.mapView?n.latLngBounds(n.latLng(e.mapView.south,e.mapView.west),n.latLng(e.mapView.north,e.mapView.east)):n.latLngBounds(n.latLng(e.position.lat,e.position.lng),n.latLng(e.position.lat,e.position.lng)),o[t]={name:e.address.label,properties:e.address,bbox:r,center:i}}return o}}function y(t){let e;return(e=t.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?n.latLng((/N/i.test(e[1])?1:-1)*+e[2],(/E/i.test(e[3])?1:-1)*+e[4]):(e=t.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?n.latLng((/N/i.test(e[2])?1:-1)*+e[1],(/E/i.test(e[4])?1:-1)*+e[3]):(e=t.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?$/))?n.latLng((/N/i.test(e[1])?1:-1)*(+e[2]+ +e[3]/60),(/E/i.test(e[4])?1:-1)*(+e[5]+ +e[6]/60)):(e=t.match(/^(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([NS])\W*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([EW])$/))?n.latLng((/N/i.test(e[3])?1:-1)*(+e[1]+ +e[2]/60),(/E/i.test(e[6])?1:-1)*(+e[4]+ +e[5]/60)):(e=t.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?$/))?n.latLng((/N/i.test(e[1])?1:-1)*(+e[2]+ +e[3]/60+ +e[4]/3600),(/E/i.test(e[5])?1:-1)*(+e[6]+ +e[7]/60+ +e[8]/3600)):(e=t.match(/^(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]\s*([NS])\W*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\s*([EW])$/))?n.latLng((/N/i.test(e[4])?1:-1)*(+e[1]+ +e[2]/60+ +e[3]/3600),(/E/i.test(e[8])?1:-1)*(+e[5]+ +e[6]/60+ +e[7]/3600)):(e=t.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))?n.latLng(+e[1],+e[2]):void 0}class b{constructor(t){o(this,"options",{next:void 0,sizeInMeters:1e4}),n.Util.setOptions(this,t)}async geocode(t){const e=y(t);return e?[{name:t,center:e,bbox:e.toBounds(this.options.sizeInMeters)}]:this.options.next?this.options.next.geocode(t):[]}}class L{constructor(t){o(this,"options",{serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/"}),n.Util.setOptions(this,t)}_getProperties(t){const e={text:t.text,address:t.address};for(let s=0;s<(t.context||[]).length;s++){e[t.context[s].id.split(".")[0]]=t.context[s].text,t.context[s].short_code&&(e.countryShortCode=t.context[s].short_code)}return e}async geocode(t){const e=this.options.serviceUrl+encodeURIComponent(t)+".json",s=i(this.options,{access_token:this.options.apiKey});void 0!==s.proximity&&void 0!==s.proximity.lat&&void 0!==s.proximity.lng&&(s.proximity=s.proximity.lng+","+s.proximity.lat);const o=await d(e,s);return this._parseResults(o)}suggest(t){return this.geocode(t)}async reverse(t,e){const s=this.options.serviceUrl+t.lng+","+t.lat+".json",o=r(this.options,{access_token:this.options.apiKey}),n=await d(s,o);return this._parseResults(n)}_parseResults(t){var e;if(null==(e=t.features)||!e.length)return[];const s=[];for(let e=0;e<=t.features.length-1;e++){const o=t.features[e],i=n.latLng(o.center.reverse());let r;r=o.bbox?n.latLngBounds(n.latLng(o.bbox.slice(0,2).reverse()),n.latLng(o.bbox.slice(2,4).reverse())):n.latLngBounds(i,i),s[e]={name:o.place_name,bbox:r,center:i,properties:this._getProperties(o)}}return s}}class w{constructor(t){o(this,"options",{serviceUrl:"https://www.mapquestapi.com/geocoding/v1"}),n.Util.setOptions(this,t),this.options.apiKey=decodeURIComponent(this.options.apiKey)}_formatName(...t){return t.filter((t=>!!t)).join(", ")}async geocode(t){const e=i(this.options,{key:this.options.apiKey,location:t,limit:5,outFormat:"json"}),s=await d(this.options.serviceUrl+"/address",e);return this._parseResults(s)}async reverse(t,e){const s=r(this.options,{key:this.options.apiKey,location:t.lat+","+t.lng,outputFormat:"json"}),o=await d(this.options.serviceUrl+"/reverse",s);return this._parseResults(o)}_parseResults(t){const e=[];if(t.results&&t.results[0].locations)for(let s=t.results[0].locations.length-1;s>=0;s--){const o=t.results[0].locations[s],i=n.latLng(o.latLng);e[s]={name:this._formatName(o.street,o.adminArea4,o.adminArea3,o.adminArea1),bbox:n.latLngBounds(i,i),center:i}}return e}}class x{constructor(t){o(this,"options",{userId:"",apiKey:"",serviceUrl:"https://neutrinoapi.com/"}),n.Util.setOptions(this,t)}async geocode(t){const e=i(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,address:t.split(/\s+/).join(".")}),s=await d(this.options.serviceUrl+"geocode-address",e),o=[];if(s.locations){s.geometry=s.locations[0];const t=n.latLng(s.geometry.latitude,s.geometry.longitude),e=n.latLngBounds(t,t);o[0]={name:s.geometry.address,bbox:e,center:t}}return o}suggest(t){return this.geocode(t)}async reverse(t,e){const s=r(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,latitude:t.lat,longitude:t.lng}),o=await d(this.options.serviceUrl+"geocode-reverse",s),i=[];if(200==o.status.status&&o.found){const e=n.latLng(t.lat,t.lng),s=n.latLngBounds(e,e);i[0]={name:o.address,bbox:s,center:e}}return i}}class U{constructor(t){o(this,"options",{serviceUrl:"https://nominatim.openstreetmap.org/",htmlTemplate(t){const e=t.address;let s;const o=[];return(e.road||e.building)&&o.push("{building} {road} {house_number}"),(e.city||e.town||e.village||e.hamlet)&&(s=o.length>0?"leaflet-control-geocoder-address-detail":"",o.push('<span class="'+s+'">{postcode} {city} {town} {village} {hamlet}</span>')),(e.state||e.country)&&(s=o.length>0?"leaflet-control-geocoder-address-context":"",o.push('<span class="'+s+'">{state} {country}</span>')),h(o.join("<br/>"),e)}}),n.Util.setOptions(this,t||{})}async geocode(t){const e=i(this.options,{q:t,limit:5,format:"json",addressdetails:1}),s=await d(this.options.serviceUrl+"search",e),o=[];for(let t=s.length-1;t>=0;t--){const e=s[t].boundingbox;o[t]={icon:s[t].icon,name:s[t].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(s[t]):void 0,bbox:n.latLngBounds([+e[0],+e[2]],[+e[1],+e[3]]),center:n.latLng(+s[t].lat,+s[t].lon),properties:s[t]}}return o}async reverse(t,e){const s=r(this.options,{lat:t.lat,lon:t.lng,zoom:Math.round(Math.log(e/256)/Math.log(2)),addressdetails:1,format:"json"}),o=await d(this.options.serviceUrl+"reverse",s),i=[];if(o&&o.lat&&o.lon){const t=n.latLng(+o.lat,+o.lon),e=n.latLngBounds(t,t);i.push({name:o.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(o):void 0,center:t,bbox:e,properties:o})}return i}}class C{constructor(t){o(this,"options",{}),n.Util.setOptions(this,t)}async geocode(t){try{const e=this.options.OpenLocationCode.decode(t);return[{name:t,center:n.latLng(e.latitudeCenter,e.longitudeCenter),bbox:n.latLngBounds(n.latLng(e.latitudeLo,e.longitudeLo),n.latLng(e.latitudeHi,e.longitudeHi))}]}catch(t){return console.warn(t),[]}}async reverse(t,e){try{return[{name:this.options.OpenLocationCode.encode(t.lat,t.lng,this.options.codeLength),center:n.latLng(t.lat,t.lng),bbox:n.latLngBounds(n.latLng(t.lat,t.lng),n.latLng(t.lat,t.lng))}]}catch(t){return console.warn(t),[]}}}class R{constructor(t){o(this,"options",{serviceUrl:"https://api.opencagedata.com/geocode/v1/json"}),n.Util.setOptions(this,t)}async geocode(t){const e=i(this.options,{key:this.options.apiKey,q:t}),s=await d(this.options.serviceUrl,e);return this._parseResults(s)}suggest(t){return this.geocode(t)}async reverse(t,e){const s=r(this.options,{key:this.options.apiKey,q:[t.lat,t.lng].join(",")}),o=await d(this.options.serviceUrl,s);return this._parseResults(o)}_parseResults(t){const e=[];if(t.results&&t.results.length)for(let s=0;s<t.results.length;s++){const o=t.results[s],i=n.latLng(o.geometry);let r;r=o.annotations&&o.annotations.bounds?n.latLngBounds(n.latLng(o.annotations.bounds.northeast),n.latLng(o.annotations.bounds.southwest)):n.latLngBounds(i,i),e.push({name:o.formatted,bbox:r,center:i})}return e}}class k{constructor(t){o(this,"options",{serviceUrl:"https://api.geocode.earth/v1"}),n.Util.setOptions(this,t)}async geocode(t){const e=i(this.options,{api_key:this.options.apiKey,text:t}),s=await d(this.options.serviceUrl+"/search",e);return this._parseResults(s,"bbox")}async suggest(t){const e=i(this.options,{api_key:this.options.apiKey,text:t}),s=await d(this.options.serviceUrl+"/autocomplete",e);return this._parseResults(s,"bbox")}async reverse(t,e){const s=r(this.options,{api_key:this.options.apiKey,"point.lat":t.lat,"point.lon":t.lng}),o=await d(this.options.serviceUrl+"/reverse",s);return this._parseResults(o,"bounds")}_parseResults(t,e){const s=[];return n.geoJSON(t,{pointToLayer:(t,e)=>n.circleMarker(e),onEachFeature(t,o){const i={};let r,a;o.getBounds?(r=o.getBounds(),a=r.getCenter()):o.feature.bbox?(a=o.getLatLng(),r=n.latLngBounds(n.GeoJSON.coordsToLatLng(o.feature.bbox.slice(0,2)),n.GeoJSON.coordsToLatLng(o.feature.bbox.slice(2,4)))):(a=o.getLatLng(),r=n.latLngBounds(a,a)),i.name=o.feature.properties.label,i.center=a,i[e]=r,i.properties=o.feature.properties,s.push(i)}}),s}}function E(t){return new k(t)}const D=k,O=E,S=k,B=E;class P extends k{constructor(t){super(n.Util.extend({serviceUrl:"https://api.openrouteservice.org/geocode"},t))}}class K{constructor(t){o(this,"options",{serviceUrl:"https://photon.komoot.io/api/",reverseUrl:"https://photon.komoot.io/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]}),n.Util.setOptions(this,t)}async geocode(t){const e=i(this.options,{q:t}),s=await d(this.options.serviceUrl,e);return this._parseResults(s)}suggest(t){return this.geocode(t)}async reverse(t,e){const s=r(this.options,{lat:t.lat,lon:t.lng}),o=await d(this.options.reverseUrl,s);return this._parseResults(o)}_parseResults(t){var e;const s=[];if(t&&t.features)for(let o=0;o<t.features.length;o++){const i=t.features[o],r=i.geometry.coordinates,a=n.latLng(r[1],r[0]),l=null==(e=i.properties)?void 0:e.extent,c=l?n.latLngBounds([l[1],l[0]],[l[3],l[2]]):n.latLngBounds(a,a);s.push({name:this._decodeFeatureName(i),html:this.options.htmlTemplate?this.options.htmlTemplate(i):void 0,center:a,bbox:c,properties:i.properties})}return s}_decodeFeatureName(t){return(this.options.nameProperties||[]).map((e=>{var s;return null==(s=t.properties)?void 0:s[e]})).filter((t=>!!t)).join(", ")}}class T{constructor(t){o(this,"options",{serviceUrl:"https://api.what3words.com/v2/"}),n.Util.setOptions(this,t)}async geocode(t){const e=await d(this.options.serviceUrl+"forward",i(this.options,{key:this.options.apiKey,addr:t.split(/\s+/).join(".")})),s=[];if(e.geometry){const t=n.latLng(e.geometry.lat,e.geometry.lng),o=n.latLngBounds(t,t);s[0]={name:e.words,bbox:o,center:t}}return s}suggest(t){return this.geocode(t)}async reverse(t,e){const s=await d(this.options.serviceUrl+"reverse",r(this.options,{key:this.options.apiKey,coords:[t.lat,t.lng].join(",")})),o=[];if(200==s.status.status){const t=n.latLng(s.geometry.lat,s.geometry.lng),e=n.latLngBounds(t,t);o[0]={name:s.words,bbox:e,center:t}}return o}}const j=Object.freeze(Object.defineProperty({__proto__:null,ArcGis:u,AzureMaps:m,Bing:g,GeocodeEarth:D,Google:v,HERE:f,HEREv2:_,LatLng:b,MapQuest:w,Mapbox:L,Mapzen:S,Neutrino:x,Nominatim:U,OpenCage:R,OpenLocationCode:C,Openrouteservice:P,Pelias:k,Photon:K,What3Words:T,arcgis:function(t){return new u(t)},azure:function(t){return new m(t)},bing:function(t){return new g(t)},geocodeEarth:O,geocodingParams:i,google:function(t){return new v(t)},here:function(t){return null!=t&&t.apiKey?new _(t):new f(t)},latLng:function(t){return new b(t)},mapQuest:function(t){return new w(t)},mapbox:function(t){return new L(t)},mapzen:B,neutrino:function(t){return new x(t)},nominatim:function(t){return new U(t)},openLocationCode:function(t){return new C(t)},opencage:function(t){return new R(t)},openrouteservice:function(t){return new P(t)},parseLatLng:y,pelias:E,photon:function(t){return new K(t)},reverseParams:r,what3words:function(t){return new T(t)}},Symbol.toStringTag,{value:"Module"}));class M{constructor(...t){}}n.Util.extend(M.prototype,n.Control.prototype),n.Util.extend(M.prototype,n.Evented.prototype);class N extends M{constructor(t){super(t),o(this,"options",{showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",iconLabel:"Initiate a new search",query:"",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0}),o(this,"_alts"),o(this,"_container"),o(this,"_errorElement"),o(this,"_geocodeMarker"),o(this,"_input"),o(this,"_lastGeocode"),o(this,"_map"),o(this,"_preventBlurCollapse"),o(this,"_requestCount",0),o(this,"_results"),o(this,"_selection"),o(this,"_suggestTimeout"),n.Util.setOptions(this,t),this.options.geocoder||(this.options.geocoder=new U)}addThrobberClass(){n.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")}removeThrobberClass(){n.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")}onAdd(t){var e;const s="leaflet-control-geocoder",o=n.DomUtil.create("div",s+" leaflet-bar"),i=n.DomUtil.create("button",s+"-icon",o),r=n.DomUtil.create("div",s+"-form",o);this._map=t,this._container=o,i.innerHTML="&nbsp;",i.type="button",i.setAttribute("aria-label",this.options.iconLabel);const a=this._input=n.DomUtil.create("input","",r);return a.type="search",a.value=this.options.query,a.placeholder=this.options.placeholder,n.DomEvent.disableClickPropagation(a),this._errorElement=n.DomUtil.create("div",s+"-form-no-error",o),this._errorElement.innerHTML=this.options.errorMessage,this._alts=n.DomUtil.create("ul",s+"-alternatives leaflet-control-geocoder-alternatives-minimized",o),n.DomEvent.disableClickPropagation(this._alts),n.DomEvent.addListener(a,"keydown",this._keydown,this),null!=(e=this.options.geocoder)&&e.suggest&&n.DomEvent.addListener(a,"input",this._change,this),n.DomEvent.addListener(a,"blur",(()=>{this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1})),this.options.collapsed?"click"===this.options.expand?n.DomEvent.addListener(o,"click",(t=>{0===t.button&&2!==t.detail&&this._toggle()})):"touch"===this.options.expand?n.DomEvent.addListener(o,n.Browser.touch?"touchstart mousedown":"mousedown",(t=>{this._toggle(),t.preventDefault(),t.stopPropagation()}),this):(n.DomEvent.addListener(o,"mouseover",this._expand,this),n.DomEvent.addListener(o,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),n.Browser.touch?n.DomEvent.addListener(o,"touchstart",(()=>this._geocode())):n.DomEvent.addListener(o,"click",(()=>this._geocode()))),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),n.DomEvent.disableClickPropagation(o),o}setQuery(t){return this._input.value=t,this}_geocodeResult(t,e){if(!e&&this.options.showUniqueResult&&1===t.length)this._geocodeResultSelected(t[0]);else if(t.length>0){this._alts.innerHTML="",this._results=t,n.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),n.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-open");for(let e=0;e<t.length;e++)this._alts.appendChild(this._createAlt(t[e],e))}else n.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-error"),n.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")}markGeocode(t){const e=t.geocode;return this._map.fitBounds(e.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new n.Marker(e.center).bindPopup(e.html||e.name).addTo(this._map).openPopup(),this}async _geocode(t=!1){const e=this._input.value;if(!t&&e.length<this.options.queryMinLength)return;const s=++this._requestCount;this._lastGeocode=e,t||this._clearResults();const o={input:e};this.fire(t?"startsuggest":"startgeocode",o);const n=t?await this.options.geocoder.suggest(e):await this.options.geocoder.geocode(e);if(s===this._requestCount){const s={input:e,results:n};this.fire(t?"finishsuggest":"finishgeocode",s),this._geocodeResult(n,t)}}_geocodeResultSelected(t){const e={geocode:t};this.fire("markgeocode",e)}_toggle(){n.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()}_expand(){n.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")}_collapse(){n.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),n.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),n.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),n.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),n.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")}_clearResults(){n.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,n.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),n.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),n.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error")}_createAlt(t,e){const s=n.DomUtil.create("li",""),o=n.DomUtil.create("a","",s),i=this.options.showResultIcons&&t.icon?n.DomUtil.create("img","",o):null,r=t.html?void 0:document.createTextNode(t.name);return i&&(i.src=t.icon),s.setAttribute("data-result-index",String(e)),t.html?o.innerHTML=o.innerHTML+t.html:r&&o.appendChild(r),n.DomEvent.addListener(s,"mousedown touchstart",(e=>{this._preventBlurCollapse=!0,n.DomEvent.stop(e),this._geocodeResultSelected(t),n.DomEvent.on(s,"click touchend",(()=>{this.options.collapsed?this._collapse():this._clearResults()}))}),this),s}_keydown(t){const e=t=>{this._selection&&(n.DomUtil.removeClass(this._selection,"leaflet-control-geocoder-selected"),this._selection=this._selection[t>0?"nextSibling":"previousSibling"]),this._selection||(this._selection=this._alts[t>0?"firstChild":"lastChild"]),this._selection&&n.DomUtil.addClass(this._selection,"leaflet-control-geocoder-selected")};switch(t.keyCode){case 27:this.options.collapsed?this._collapse():this._clearResults();break;case 38:e(-1);break;case 40:e(1);break;case 13:if(this._selection){const t=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[t]),this._clearResults()}else this._geocode();break;default:return}n.DomEvent.preventDefault(t)}_change(){const t=this._input.value;t!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),t.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout((()=>this._geocode(!0)),this.options.suggestTimeout):this._clearResults())}}function q(t){return new N(t)}
/* @preserve
 * Leaflet Control Geocoder
 * https://github.com/perliedman/leaflet-control-geocoder
 *
 * Copyright (c) 2012 sa3m (https://github.com/sa3m)
 * Copyright (c) 2018 Per Liedman
 * All rights reserved.
 */n.Util.extend(N,j),n.Util.extend(n.Control,{Geocoder:N,geocoder:q}),t.Geocoder=N,t.default=N,t.geocoder=q,t.geocoders=j,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));