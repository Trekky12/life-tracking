const JSTableDefaultConfig={perPage:5,perPageSelect:[5,10,15,20,25],sortable:!0,searchable:!0,nextPrev:!0,firstLast:!1,prevText:"&lsaquo;",nextText:"&rsaquo;",firstText:"&laquo;",lastText:"&raquo;",ellipsisText:"&hellip;",truncatePager:!0,pagerDelta:2,classes:{top:"dt-top",info:"dt-info",input:"dt-input",table:"dt-table",bottom:"dt-bottom",search:"dt-search",sorter:"dt-sorter",wrapper:"dt-wrapper",dropdown:"dt-dropdown",ellipsis:"dt-ellipsis",selector:"dt-selector",container:"dt-container",pagination:"dt-pagination",loading:"dt-loading",message:"dt-message"},labels:{placeholder:"Search...",perPage:"{select} entries per page",noRows:"No entries found",info:"Showing {start} to {end} of {rows} entries",loading:"Loading...",infoFiltered:"Showing {start} to {end} of {rows} entries (filtered from {rowsTotal} entries)"},layout:{top:"{select}{search}",bottom:"{info}{pager}"},serverSide:!1,deferLoading:null,ajax:null,ajaxParams:{}};class JSTable{constructor(e,t={}){let s=e;"string"==typeof e&&(s=document.querySelector(e)),null!==s&&(this.config=Object.assign({},JSTableDefaultConfig,t),this.table=new JSTableElement(s),this.currentPage=1,this.columnRenderers=[],this.columnsNotSearchable=[],this.searchQuery=null,this.sortColumn=null,this.sortDirection="asc",this.isSearching=!1,this.filteredDataCount=null,this.pager=new JSTablePager(this),this._build(),this._buildColumns(),this.update(!this.config.serverSide),this._bindEvents(),this._emit("init"))}_build(){let e=this.config;this.wrapper=document.createElement("div"),this.wrapper.className=e.classes.wrapper;var t=["<div class='",e.classes.top,"'>",e.layout.top,"</div>","<div class='",e.classes.container,"'>","<div class='",e.classes.loading," hidden'>",e.labels.loading,"</div>","</div>","<div class='",e.classes.bottom,"'>",e.layout.bottom,"</div>"].join("");if(t=t.replace("{info}","<div class='"+e.classes.info+"'></div>"),e.perPageSelect){var s=["<div class='",e.classes.dropdown,"'>","<label>",e.labels.perPage,"</label>","</div>"].join(""),a=document.createElement("select");a.className=e.classes.selector,e.perPageSelect.forEach(function(t){var s=t===e.perPage,r=new Option(t,t,s,s);a.add(r)}),s=s.replace("{select}",a.outerHTML),t=t.replace(/\{select\}/g,s)}else t=t.replace(/\{select\}/g,"");if(e.searchable){var r=["<div class='",e.classes.search,"'>","<input class='",e.classes.input,"' placeholder='",e.labels.placeholder,"' type='text'>","</div>"].join("");t=t.replace(/\{search\}/g,r)}else t=t.replace(/\{search\}/g,"");this.table.element.classList.add(e.classes.table),t=t.replace("{pager}","<div class='"+e.classes.pagination+"'></div>"),this.wrapper.innerHTML=t,this.table.element.parentNode.replaceChild(this.wrapper,this.table.element);this.wrapper.querySelector("."+e.classes.container).appendChild(this.table.element),this._updatePagination(),this._updateInfo()}update(e=!0){var t=this;this.currentPage>this.pager.getPages()&&(this.currentPage=this.pager.getPages());let s=t.wrapper.querySelector(" ."+t.config.classes.loading);s.classList.remove("hidden"),e?this.getPageData(this.currentPage).then(function(e){t.table.element.classList.remove("hidden"),t.table.body.innerHTML="",e.forEach(function(e){t.table.body.appendChild(e.getFormated(t.columnRenderers))}),s.classList.add("hidden")}).then(function(){t.getDataCount()<=0&&(t.wrapper.classList.remove("search-results"),t.setMessage(t.config.labels.noRows)),t._emit("update")}).then(function(){t._updatePagination(),t._updateInfo()}):(t.table.element.classList.remove("hidden"),t.table.body.innerHTML="",this.getDataCount()<=0&&(t.wrapper.classList.remove("search-results"),t.setMessage(t.config.labels.noRows)),this._getData().forEach(function(e){t.table.body.appendChild(e.getFormated(t.columnRenderers))}),s.classList.add("hidden"))}_updatePagination(){let e=this.wrapper.querySelector(" ."+this.config.classes.pagination);e.innerHTML="",e.appendChild(this.pager.render(this.currentPage))}_updateInfo(){let e=this.wrapper.querySelector(" ."+this.config.classes.info),t=this.isSearching?this.config.labels.infoFiltered:this.config.labels.info;if(e&&t.length){var s=t.replace("{start}",this.getDataCount()>0?this._getPageStartIndex()+1:0).replace("{end}",this._getPageEndIndex()+1).replace("{page}",this.currentPage).replace("{pages}",this.pager.getPages()).replace("{rows}",this.getDataCount()).replace("{rowsTotal}",this.getDataCountTotal());e.innerHTML=s}}_getPageStartIndex(){return(this.currentPage-1)*this.config.perPage}_getPageEndIndex(){let e=this.currentPage*this.config.perPage-1;return e>this.getDataCount()-1?this.getDataCount()-1:e}_getData(){return this._emit("getData",this.table.dataRows),this.table.dataRows.filter(function(e){return e.visible})}_fetchData(){var e=this;let t={searchQuery:this.searchQuery,sortColumn:this.sortColumn,sortDirection:this.sortDirection,start:this._getPageStartIndex(),length:this.config.perPage,datatable:1};t=Object.assign({},this.config.ajaxParams,t);let s=this.config.ajax+"?"+this._queryParams(t);return fetch(s,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){return e._emit("fetchData",t),e.filteredDataCount=t.recordsFiltered,t.data}).then(function(e){let t=[];return e.forEach(function(e){t.push(JSTableRow.createFromData(e))}),t}).catch(function(e){console.error(e)})}_queryParams(e){return Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&")}getDataCount(){return this.isSearching?this.getDataCountFiltered():this.getDataCountTotal()}getDataCountFiltered(){return this.config.serverSide?this.filteredDataCount:this._getData().length}getDataCountTotal(){return this.config.serverSide?this.config.deferLoading:this.table.dataRows.length}getPageData(){if(this.config.serverSide)return this._fetchData();let e=this._getPageStartIndex();var t=this._getPageEndIndex();return Promise.resolve(this._getData()).then(function(s){return s.filter(function(s,a){return a>=e&&a<=t})})}search(e){var t=this;if(this.searchQuery=e.toLowerCase(),this.currentPage=1,this.isSearching=!0,!this.searchQuery.length)return this.table.dataRows.forEach(function(e){e.visible=!0}),this.isSearching=!1,t.wrapper.classList.remove("search-results"),t.update(),!1;this.config.serverSide||this.table.dataRows.forEach(function(e){e.visible=!1;t.searchQuery.split(" ").reduce(function(s,a){var r=!1;let i=e.getCells();return i=i.filter(function(e,s){if(t.columnsNotSearchable.indexOf(s)<0)return!0}),r=i.some(function(e,t){if(e.innerHTML.toLowerCase().indexOf(a)>=0)return!0}),s&&r},!0)&&(e.visible=!0)}),this.wrapper.classList.add("search-results"),this.update(),this._emit("search",e)}sort(e,t,s=!1){var a=this;if(this.sortColumn=e||0,this.sortDirection=t,this.sortColumn<0||this.sortColumn>this.table.getColumnCount()-1)return!1;var r=this.table.header.getCell(this.sortColumn),i=this.table.dataRows;Array.from(this.table.header.getCells()).forEach(function(e){e.classList.remove("asc"),e.classList.remove("desc")}),r.classList.add(this.sortDirection),this.config.serverSide||(i=i.sort(function(e,t){var s=e.getCellContent(a.sortColumn).toLowerCase(),r=t.getCellContent(a.sortColumn).toLowerCase();return s=s.replace(/(\$|\,|\s|%)/g,""),r=r.replace(/(\$|\,|\s|%)/g,""),s=isNaN(s)||""===s?s:parseFloat(s),r=isNaN(r)||""===r?r:parseFloat(r),""===s&&""!==r?"asc"===a.sortDirection?1:-1:""!==s&&""===r?"asc"===a.sortDirection?-1:1:"asc"===a.sortDirection?s===r?0:s>r?1:-1:s===r?0:s<r?1:-1}),this.table.dataRows=i),this.config.serverSide&&s||this.update(),this._emit("sort",this.sortColumn,this.sortDirection)}_bindEvents(){var e=this;this.wrapper.addEventListener("click",function(t){var s=t.target;if(s.hasAttribute("data-page")){t.preventDefault();let a=parseInt(s.getAttribute("data-page"),10);e.currentPage=a,e.update()}if("TH"===s.nodeName&&s.hasAttribute("data-sortable")){if("false"===s.getAttribute("data-sortable"))return!1;t.preventDefault(),e.sort(s.cellIndex,s.classList.contains("asc")?"desc":"asc")}}),this.config.perPageSelect&&this.wrapper.addEventListener("change",function(t){var s=t.target;if("SELECT"===s.nodeName&&s.classList.contains(e.config.classes.selector)){t.preventDefault();let a=parseInt(s.value,10);e.config.perPage=a,e.update()}}),this.config.searchable&&this.wrapper.addEventListener("keyup",function(t){"INPUT"===t.target.nodeName&&t.target.classList.contains(e.config.classes.input)&&(t.preventDefault(),e.search(t.target.value))})}on(e,t){this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events=this.events||{},e in this.events!=!1&&this.events[e].splice(this.events[e].indexOf(t),1)}_emit(e){if(this.events=this.events||{},e in this.events!=!1)for(var t=0;t<this.events[e].length;t++)this.events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}setMessage(e){var t=this.table.getColumnCount(),s=document.createElement("tr");s.innerHTML='<td class="'+this.config.classes.message+'" colspan="'+t+'">'+e+"</td>",this.table.body.innerHTML="",this.table.body.appendChild(s)}_buildColumns(){var e=this;let t=null,s=null;this.config.columns&&this.config.columns.forEach(function(a){isNaN(a.select)||(a.select=[a.select]),a.select.forEach(function(r){var i=e.table.header.getCell(r);if(a.hasOwnProperty("render")&&"function"==typeof a.render&&(e.columnRenderers[r]=a.render),a.hasOwnProperty("sortable")){let r=!1;i.hasAttribute("data-sortable")?r="true"===i.getAttribute("data-sortable"):(r=a.sortable,i.setAttribute("data-sortable",r)),r&&(i.classList.add(e.config.classes.sorter),a.hasOwnProperty("sort")&&1===a.select.length&&(t=a.select[0],s=a.sort))}a.hasOwnProperty("searchable")&&(i.setAttribute("data-searchable",a.searchable),!1===a.searchable&&e.columnsNotSearchable.push(r))})}),this.table.header.getCells().forEach(function(a,r){let i=!1;a.hasAttribute("data-sortable")?i="true"===a.getAttribute("data-sortable"):(i=e.config.sortable,a.setAttribute("data-sortable",i)),i&&(a.classList.add(e.config.classes.sorter),a.hasAttribute("data-sort")&&(t=r,s=a.getAttribute("data-sort")))}),null!==t&&e.sort(t,s,!0)}}class JSTableElement{constructor(e){this.element=e,this.body=this.element.tBodies[0],this.rows=Array.from(this.element.rows).map(function(e){return new JSTableRow(e,e.parentNode.nodeName)}),this.dataRows=this._getBodyRows(),this.header=this._getHeaderRow()}_getBodyRows(){return this.rows.filter(function(e){return!e.isHeader&&!e.isFooter})}_getHeaderRow(){return this.rows.find(function(e){return e.isHeader})}getColumnCount(){return this.header.getColumnCount()}getFooterRow(){return this.rows.find(function(e){return e.isFooter})}}class JSTableRow{constructor(e,t){this.cells=e.cells,this.d=this.cells.length,this.isHeader="THEAD"===t,this.isFooter="TFOOT"===t,this.visible=!0}getCells(){return Array.from(this.cells)}getColumnCount(){return this.cells.length}getCell(e){return this.cells[e]}getCellContent(e){return this.getCell(e).innerHTML}static createFromData(e){let t=document.createElement("tr");return e.forEach(function(e){let s=document.createElement("td");s.innerHTML=e,t.appendChild(s)}),new JSTableRow(t)}getFormated(e){let t=document.createElement("tr");var s=this;return this.getCells().forEach(function(a,r){var i=document.createElement("td");i.innerHTML=a.innerHTML,e.hasOwnProperty(r)&&(i.innerHTML=e[r].call(s,a,r)),t.appendChild(i)}),t}setCellContent(e,t){this.cells[e].innerHTML=t}setCellClass(e,t){this.cells[e].className=t}}class JSTablePager{constructor(e){this.instance=e}getPages(){let e=Math.ceil(this.instance.getDataCount()/this.instance.config.perPage);return 0===e?1:e}render(){var e=this.instance.config;let t=this.getPages(),s=document.createElement("ul");if(t>1){let a=1===this.instance.currentPage?1:this.instance.currentPage-1,r=this.instance.currentPage===t?t:this.instance.currentPage+1;e.firstLast&&s.appendChild(this.createItem("pager",1,e.firstText)),e.nextPrev&&s.appendChild(this.createItem("pager",a,e.prevText));this.truncate().forEach(function(e){s.appendChild(e)}),e.nextPrev&&s.appendChild(this.createItem("pager",r,e.nextText)),e.firstLast&&s.appendChild(this.createItem("pager",t,e.lastText))}return s}createItem(e,t,s,a){let r=document.createElement("li");return r.className=e,r.innerHTML=a?"<span>"+s+"</span>":'<a href="#" data-page="'+t+'">'+s+"</a>",r}isValidPage(e){return e>0&&e<=this.getPages()}truncate(){var e,t=this,s=t.instance.config,a=2*s.pagerDelta,r=t.instance.currentPage,i=r-s.pagerDelta,n=r+s.pagerDelta,l=this.getPages(),o=[],c=[];if(this.instance.config.truncatePager){r<4-s.pagerDelta+a?n=3+a:r>this.getPages()-(3-s.pagerDelta+a)&&(i=this.getPages()-(2+a));for(var h=1;h<=l;h++)(1===h||h===l||h>=i&&h<=n)&&o.push(h);o.forEach(function(a){e&&(a-e==2?c.push(t.createItem("",e+1,e+1)):a-e!=1&&c.push(t.createItem(s.classes.ellipsis,0,s.ellipsisText,!0))),c.push(t.createItem(a==r?"active":"",a,a)),e=a})}else for(let e=1;e<=this.getPages();e++)c.push(this.createItem(e===r?"active":"",e,e));return c}}