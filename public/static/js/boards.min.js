
(function(a){a(document).ready(function(){var h,j,d,f,b,e;function g(l,k){var m=l.find('input[name="id"]').val();a.ajax({url:k+m,method:"POST",data:l.find("form").serialize(),success:function(n){window.location.reload()},error:function(n){alert(n)}})}h=a("#stack-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"stack-add-btn",click:function(){g(h,jsObject.stack_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(k,l){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#stack-add-btn").button("option","label",lang.add);j[0].reset();j.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("")}});j=h.find("form").on("submit",function(k){k.preventDefault();g(h,jsObject.stack_save)});a("a.create-stack").on("click",function(){h.dialog("open")});a(".stack-header").on("click",function(){var k=a(this).data("stack");a.ajax({url:jsObject.stack_get_url+k,method:"GET",success:function(l){h.find('input[name="id"]').val(l.entry.id);h.find('input[name="name"]').val(l.entry.name);h.find('input[name="position"]').val(l.entry.position);a("#stack-add-btn").button("option","label",lang.update);var m="<a href='#' data-url='"+jsObject.stack_archive+l.entry.id+"' data-archive='"+l.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.stack_delete+l.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";h.parent().find(".ui-dialog-titlebar .edit-bar").html(m);h.dialog("open")}})});d=a("#card-form").dialog({autoOpen:false,autoResize:true,width:550,modal:true,buttons:[{text:lang.add,id:"card-add-btn",click:function(){g(d,jsObject.card_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],open:function(){var k=d.find('textarea[name="description"]');if(k.val()!==""){k.height(k[0].scrollHeight)}else{k.height("auto")}if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},close:function(){a("#card-add-btn").button("option","label",lang.add);f[0].reset();f.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");f.find(".show-sibling").removeClass("hidden");f.find(".hidden-field").addClass("hidden");d.find('textarea[name="description"]').height("auto");d.find("#createdBy").html("");d.find("#createdOn").html("");d.find("#changedBy").html("");d.find("#changedOn").html("")}});f=d.find("form").on("submit",function(k){k.preventDefault();g(d,jsObject.card_save)});a("a.create-card").on("click",function(){var k=a(this).data("stack");f.find('input[name="stack"]').val(k);d.dialog("open")});a(".board-card").on("click",function(){var k=a(this).data("card");a.ajax({url:jsObject.card_get_url+k,method:"GET",success:function(n){d.find('input[name="id"]').val(n.entry.id);d.find('input[name="title"]').val(n.entry.title);d.find('input[name="position"]').val(n.entry.position);d.find('input[name="stack"]').val(n.entry.stack);d.find('input[name="archive"]').val(n.entry.archive);if(n.entry.date){var q=d.find('input[name="date"]');q.val(n.entry.date);d.find("input.date-display").datepicker("setDate",moment(n.entry.date).toDate());q.parent().siblings(".show-sibling").addClass("hidden");q.parent().removeClass("hidden")}if(n.entry.time){var l=d.find('input[name="time"]');l.val(n.entry.time);l.parent().siblings(".show-sibling").addClass("hidden");l.parent().removeClass("hidden")}if(n.entry.description){var m=d.find('textarea[name="description"]');m.val(n.entry.description);m.parent().siblings(".show-sibling").addClass("hidden");m.parent().removeClass("hidden")}d.find('select[name="users[]"]').val(n.entry.users);d.find("#createdBy").html(n.entry.createdBy);d.find("#createdOn").html(moment(n.entry.createdOn).format(i18n.dateformatJSFull));d.find("#changedBy").html(n.entry.changedBy);d.find("#changedOn").html(moment(n.entry.changedOn).format(i18n.dateformatJSFull));var p=d.find(".avatar-small, .avatar-small");a.each(p,function(r,t){var s=a(t).data("user");if(jQuery.inArray(s,n.entry.users)!==-1){a(t).addClass("selected")}else{a(t).removeClass("selected")}});d.find('select[name="labels[]"]').val(n.entry.labels);a("#card-add-btn").button("option","label",lang.update);var o="<a href='#' data-url='"+jsObject.card_archive+n.entry.id+"' data-archive='"+n.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.card_delete+n.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";d.parent().find(".ui-dialog-titlebar .edit-bar").html(o);a("select#card-label-list").trigger("chosen:updated");d.dialog("open")}})});a(".show-sibling").on("click",function(k){a(this).addClass("hidden");a(this).siblings(".hidden-field").removeClass("hidden").find("input, textarea").focus()});b=a("#label-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"label-add-btn",click:function(){g(b,jsObject.label_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(k,l){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#label-add-btn").button("option","label",lang.add);e[0].reset();e.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");a(this).find(".color-wrapper").css("background-color","black")}});e=b.find("form").on("submit",function(k){k.preventDefault();g(b,jsObject.label_save)});a("a.create-label").on("click",function(){b.dialog("open")});a("a.edit-label").on("click",function(){var k=a(this).data("label");a.ajax({url:jsObject.label_get_url+k,method:"GET",success:function(l){b.find('input[name="id"]').val(l.entry.id);b.find('input[name="name"]').val(l.entry.name);b.find('input[name="background_color"]').val(l.entry.background_color);b.find('input[name="background_color"]').parent(".color-wrapper").css("background-color",l.entry.background_color);b.find('input[name="text_color"]').val(l.entry.text_color);b.find('input[name="text_color"]').parent(".color-wrapper").css("background-color",l.entry.text_color);a("#label-add-btn").button("option","label",lang.update);var m="<a href='#' data-url='"+jsObject.label_delete+l.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";b.parent().find(".ui-dialog-titlebar .edit-bar").html(m);b.dialog("open")}})});a(".stack-wrapper").sortable({items:".stack",axis:"x",tolerance:"pointer",helper:"clone",handle:".stack-header",cursor:"move",containment:"parent",start:function(k,l){l.helper.removeClass("stack-border")},stop:function(k,l){},update:function(k,m){var l=a(this).sortable("serialize");a.ajax({data:l,type:"POST",url:jsObject.stack_position_url})}}).disableSelection();a(".card-wrapper").sortable({connectWith:".card-wrapper",dropOnEmpty:true,helper:"clone",placeholder:"card-placeholder",update:function(k,m){var l=a(this).sortable("serialize");a.ajax({data:l,type:"POST",url:jsObject.card_position_url})},receive:function(m,n){var k=a(this).data("stack");var l=n.item.data("card");a.ajax({data:{card:l,stack:k},type:"POST",url:jsObject.card_movestack_url})}}).disableSelection();a("body").on("click",".btn-archive",function(l){l.preventDefault();var k=a(this).data("url");var m=a(this).data("archive");if(m===1){if(!confirm(lang.undo_archive)){return false}}else{if(!confirm(lang.really_archive)){return false}}a.ajax({url:k,method:"POST",data:{archive:m?0:1},success:function(n){window.location.reload()},error:function(n){alert(n)}})});a("#card-form .avatar").on("click",function(m){var k=a(this).data("user");var l=a("#card-form select#users option[value='"+k+"']");if(l.prop("selected")){l.prop("selected",false);a(this).removeClass("selected")}else{l.prop("selected",true);a(this).addClass("selected")}});a(".avatar").disableSelection();a("textarea").on("input change",function(){a(this).height("auto").height(a(this)[0].scrollHeight)});c();a(window).resize(function(){c()});a("#sidebar-toggle").on("click",function(){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().toggleClass("mobile-visible");a(this).parent().removeClass("desktop-hidden")}else{a(this).parent().toggleClass("desktop-hidden");a(this).parent().removeClass("mobile-visible")}});a(document).on("change",'input[type="color"]',function(){a(this).parent(".color-wrapper").css("background-color",""+a(this).val())});function c(){d.dialog({width:a(window).width()>550?550:"auto"});if(a(".menu-toggle").css("display")!=="none"){a(".stack-wrapper").sortable({axis:false})}else{a(".stack-wrapper").sortable({axis:"x"})}}a("select#card-label-list").chosen({width:"100%",disable_search:true,placeholder_text_multiple:lang.labels});function i(){var k=a(".sidebar");if(a(window).scrollTop()<a("#masthead").outerHeight()){k.css("padding-top",a("#masthead").outerHeight()-a(window).scrollTop())}else{k.css("padding-top",0)}}i();a(window).scroll(function(){i()});a("#checkboxArchivedItems").on("click",function(k){a.ajax({url:jsObject.set_archive,method:"POST",data:{state:a(this).is(":checked")?1:0},success:function(l){window.location.reload()},error:function(l){alert(l)}})});a(".avatar-small").tooltip();setInterval(function(){var k=h.dialog("isOpen");var m=d.dialog("isOpen");var l=b.dialog("isOpen");if(!k===true&&!m===true&&!l===true){window.location.reload()}},30000)})})(jQuery);