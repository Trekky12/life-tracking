
(function(a){a(document).ready(function(){var n,q,f,k,c,j;var g=null;function m(s,r){a("#loading-overlay").removeClass("hidden");h();var t=s.find('input[name="id"]').val();a.ajax({url:r+t,method:"POST",data:s.find("form").serialize(),success:function(u){allowedReload=true;window.location.reload()},error:function(u){alert(u)}})}n=a("#stack-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"stack-add-btn",click:function(){m(n,jsObject.stack_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(r,s){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#stack-add-btn").button("option","label",lang.add);q[0].reset();q.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("")}});q=n.find("form").on("submit",function(r){r.preventDefault();m(n,jsObject.stack_save)});a("a.create-stack").on("click",function(r){r.preventDefault();n.dialog("open")});a(".stack-header").on("click",function(s){s.preventDefault();a("#loading-overlay").removeClass("hidden");var r=a(this).data("stack");a.ajax({url:jsObject.stack_get_url+r,method:"GET",success:function(t){if(t.status!=="error"){n.find('input[name="id"]').val(t.entry.id);n.find('input[name="name"]').val(t.entry.name);n.find('input[name="position"]').val(t.entry.position);a("#stack-add-btn").button("option","label",lang.update);var u="<a href='#' data-url='"+jsObject.stack_archive+t.entry.id+"' data-archive='"+t.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.stack_delete+t.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";n.parent().find(".ui-dialog-titlebar .edit-bar").html(u);n.dialog("open")}}}).done(function(){a("#loading-overlay").addClass("hidden")})});f=a("#card-form").dialog({autoOpen:false,autoResize:true,width:550,modal:true,buttons:[{text:lang.add,id:"card-add-btn",click:function(){m(f,jsObject.card_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],open:function(){var r=f.find('textarea[name="description"]');g=new SimpleMDE({element:r[0],autosave:{enabled:false},forceSync:true,spellChecker:false,promptURLs:true,status:false,styleSelectedText:a(".menu-toggle").css("display")!=="none"?false:true,minHeight:"50px",});if(r.val()!==""){g.togglePreview()}else{}if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},close:function(){a("#card-add-btn").button("option","label",lang.add);if(g){g.toTextArea();g=null}k[0].reset();k.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");k.find(".show-sibling").removeClass("hidden");k.find(".hidden-field").addClass("hidden");f.find('textarea[name="description"]').height("auto");f.find("#createdBy").html("");f.find("#createdOn").html("");f.find("#changedBy").html("");f.find("#changedOn").html("");f.find(".form-group.card-dates").addClass("hidden");f.find('select[name="labels[]"]').val("");a("select#card-label-list").trigger("chosen:updated");f.find('select[name="users[]"]').val("");f.find(".avatar-small, .avatar-small").removeClass("selected");h()}});k=f.find("form").on("submit",function(r){r.preventDefault();m(f,jsObject.card_save)});a("a.create-card").on("click",function(s){s.preventDefault();var r=a(this).data("stack");k.find('input[name="stack"]').val(r);f.dialog("open")});a(".board-card").on("click",function(s){s.preventDefault();var r=a(this).data("card");b(r)});function b(r){a("#loading-overlay").removeClass("hidden");a.ajax({url:jsObject.card_get_url+r,method:"GET",success:function(u){if(u.status!=="error"){f.find('input[name="id"]').val(u.entry.id);f.find('input[name="title"]').val(u.entry.title);f.find('input[name="position"]').val(u.entry.position);f.find('input[name="stack"]').val(u.entry.stack);f.find('input[name="archive"]').val(u.entry.archive);if(u.entry.date){var x=f.find('input[name="date"]');x.val(u.entry.date);f.find("input.date-display").datepicker("setDate",moment(u.entry.date).toDate());x.parent().siblings(".show-sibling").addClass("hidden");x.parent().removeClass("hidden")}if(u.entry.time){var s=f.find('input[name="time"]');s.val(u.entry.time);s.parent().siblings(".show-sibling").addClass("hidden");s.parent().removeClass("hidden")}var t=f.find('textarea[name="description"]');if(u.entry.description){t.val(u.entry.description);t.parent().siblings(".show-sibling").addClass("hidden");t.parent().removeClass("hidden")}f.find("#createdBy").html(u.entry.createdBy);f.find("#createdOn").html(moment(u.entry.createdOn).format(i18n.dateformatJSFull));f.find("#changedBy").html(u.entry.changedBy);f.find("#changedOn").html(moment(u.entry.changedOn).format(i18n.dateformatJSFull));f.find(".form-group.card-dates").removeClass("hidden");f.find('select[name="users[]"]').val(u.entry.users);var w=f.find(".avatar-small, .avatar-small");a.each(w,function(y,A){var z=a(A).data("user");if(jQuery.inArray(z,u.entry.users)!==-1){a(A).addClass("selected")}else{a(A).removeClass("selected")}});f.find('select[name="labels[]"]').val(u.entry.labels);a("#card-add-btn").button("option","label",lang.update);var v="<a href='#' data-url='"+jsObject.card_archive+u.entry.id+"' data-archive='"+u.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.card_delete+u.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";f.parent().find(".ui-dialog-titlebar .edit-bar").html(v);a("select#card-label-list").trigger("chosen:updated");f.dialog("open")}else{h()}}}).done(function(){a("#loading-overlay").addClass("hidden")})}a(".show-sibling").on("click",function(r){r.preventDefault();a(this).addClass("hidden");a(this).siblings(".hidden-field").removeClass("hidden").find("input, textarea").focus();if(g){g.codemirror.refresh()}return false});c=a("#label-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"label-add-btn",click:function(){m(c,jsObject.label_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(r,s){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#label-add-btn").button("option","label",lang.add);j[0].reset();j.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");a(this).find(".color-wrapper").css("background-color","black")}});j=c.find("form").on("submit",function(r){r.preventDefault();m(c,jsObject.label_save)});a("a.create-label").on("click",function(r){r.preventDefault();c.dialog("open")});a("a.edit-label").on("click",function(s){s.preventDefault();a("#loading-overlay").removeClass("hidden");var r=a(this).data("label");a.ajax({url:jsObject.label_get_url+r,method:"GET",success:function(t){if(t.status!=="error"){c.find('input[name="id"]').val(t.entry.id);c.find('input[name="name"]').val(t.entry.name);c.find('input[name="background_color"]').val(t.entry.background_color);c.find('input[name="background_color"]').parent(".color-wrapper").css("background-color",t.entry.background_color);c.find('input[name="text_color"]').val(t.entry.text_color);c.find('input[name="text_color"]').parent(".color-wrapper").css("background-color",t.entry.text_color);a("#label-add-btn").button("option","label",lang.update);var u="<a href='#' data-url='"+jsObject.label_delete+t.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";c.parent().find(".ui-dialog-titlebar .edit-bar").html(u);c.dialog("open")}}}).done(function(){a("#loading-overlay").addClass("hidden")})});a(".stack-wrapper").sortable({items:".stack",axis:"x",tolerance:"pointer",helper:"clone",handle:".stack-header",cursor:"move",containment:"parent",start:function(r,s){s.helper.removeClass("stack-border")},stop:function(r,s){},update:function(r,t){var s=a(this).sortable("serialize");a.ajax({data:s,type:"POST",url:jsObject.stack_position_url})}}).disableSelection();a(".card-wrapper").sortable({connectWith:".card-wrapper",dropOnEmpty:true,helper:"clone",placeholder:"card-placeholder",update:function(r,t){var s=a(this).sortable("serialize");a.ajax({data:s,type:"POST",url:jsObject.card_position_url})},receive:function(t,u){var r=a(this).data("stack");var s=u.item.data("card");a.ajax({data:{card:s,stack:r},type:"POST",url:jsObject.card_movestack_url})}}).disableSelection();a("body").on("click",".btn-archive",function(s){s.preventDefault();var r=a(this).data("url");var t=a(this).data("archive");if(t===1){if(!confirm(lang.undo_archive)){return false}}else{if(!confirm(lang.really_archive)){return false}}a.ajax({url:r,method:"POST",data:{archive:t?0:1},success:function(u){allowedReload=true;window.location.reload()},error:function(u){alert(u)}})});a("#card-form .avatar").on("click",function(t){t.preventDefault();var r=a(this).data("user");var s=a("#card-form select#users option[value='"+r+"']");if(s.prop("selected")){s.prop("selected",false);a(this).removeClass("selected")}else{s.prop("selected",true);a(this).addClass("selected")}});a(".avatar").disableSelection();d();a(window).resize(function(){d()});a("#sidebar-toggle").on("click",function(r){r.preventDefault();if(a(".menu-toggle").css("display")!=="none"){a(this).parent().removeClass("desktop-hidden");a(this).parent().toggleClass("mobile-visible");if(a(this).parent().hasClass("mobile-visible")){p("sidebar_mobilevisible",1);p("sidebar_desktophidden",0)}else{p("sidebar_mobilevisible",0)}}else{a(this).parent().removeClass("mobile-visible");a(this).parent().toggleClass("desktop-hidden");if(a(this).parent().hasClass("desktop-hidden")){p("sidebar_desktophidden",1);p("sidebar_mobilevisible",0)}else{p("sidebar_desktophidden",0)}}});a(document).on("change",'input[type="color"]',function(){a(this).parent(".color-wrapper").css("background-color",""+a(this).val())});function d(){f.dialog({width:a(window).width()>550?550:"auto"});if(a(".menu-toggle").css("display")!=="none"){a(".stack-wrapper").sortable({axis:false})}else{a(".stack-wrapper").sortable({axis:"x"})}}a("select#card-label-list").chosen({width:"100%",disable_search:true,placeholder_text_multiple:lang.labels});function o(){var r=a(".sidebar");if(a(window).scrollTop()<a("#masthead").outerHeight()){r.css("padding-top",a("#masthead").outerHeight()-a(window).scrollTop())}else{r.css("padding-top",0)}}o();a(window).scroll(function(){o()});a("#checkboxArchivedItems").on("click",function(r){a.ajax({url:jsObject.set_archive,method:"POST",data:{state:a(this).is(":checked")?1:0},success:function(s){allowedReload=true;window.location.reload()},error:function(s){alert(s)}});return});a(".avatar-small").tooltip();setInterval(function(){var r=n.dialog("isOpen");var t=f.dialog("isOpen");var s=c.dialog("isOpen");if(!r===true&&!t===true&&!s===true){window.location.reload()}},30000);f.keypress(function(r){if(r.keyCode===13){r.preventDefault();m(f,jsObject.card_save)}});a("#addComment").on("click",function(s){s.preventDefault();var r=f.find('input[name="id"]').val();var t=f.find('textarea[name="comment"]').val();a.ajax({url:jsObject.comment_save,method:"POST",data:{card:r,comment:t},success:function(u){allowedReload=true;window.location.reload()},error:function(u){alert(u)}})});var l=window.location.href.match(/(?:\?card=([0-9]*))/);if(l!==null&&l.length>1){var e=l[1];b(e)}function h(){var s=window.location.toString();if(s.indexOf("?")>0){var r=s.substring(0,s.indexOf("?"));window.history.replaceState({},document.title,r)}}function i(r){var s=window.location.toString();var t=s.indexOf("?")>0?"&":"?";if(s.indexOf("card")<=0){window.history.replaceState({},document.title,s+t+"card="+r)}}a(window).on("beforeunload",function(){var r=n.dialog("isOpen");var t=f.dialog("isOpen");var s=c.dialog("isOpen");if(!allowedReload&&(r===true||t===true||s===true)){return lang.really_close}});function p(r,u,t,w){t=t||365;var v=new Date();v.setDate(v.getDate()+t);var s=[r+"="+u,"expires="+v.toUTCString(),"path="+w||"/"];document.cookie=s.join(";")}})})(jQuery);