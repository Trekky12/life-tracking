
(function(a){a(document).ready(function(){var i,k,d,g,b,f;var e=null;function h(m,l){var n=m.find('input[name="id"]').val();a.ajax({url:l+n,method:"POST",data:m.find("form").serialize(),success:function(o){window.location.reload()},error:function(o){alert(o)}})}i=a("#stack-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"stack-add-btn",click:function(){h(i,jsObject.stack_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(l,m){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#stack-add-btn").button("option","label",lang.add);k[0].reset();k.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("")}});k=i.find("form").on("submit",function(l){l.preventDefault();h(i,jsObject.stack_save)});a("a.create-stack").on("click",function(l){l.preventDefault();i.dialog("open")});a(".stack-header").on("click",function(m){m.preventDefault();var l=a(this).data("stack");a.ajax({url:jsObject.stack_get_url+l,method:"GET",success:function(n){i.find('input[name="id"]').val(n.entry.id);i.find('input[name="name"]').val(n.entry.name);i.find('input[name="position"]').val(n.entry.position);a("#stack-add-btn").button("option","label",lang.update);var o="<a href='#' data-url='"+jsObject.stack_archive+n.entry.id+"' data-archive='"+n.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.stack_delete+n.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";i.parent().find(".ui-dialog-titlebar .edit-bar").html(o);i.dialog("open")}})});d=a("#card-form").dialog({autoOpen:false,autoResize:true,width:550,modal:true,buttons:[{text:lang.add,id:"card-add-btn",click:function(){h(d,jsObject.card_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],open:function(){var l=d.find('textarea[name="description"]');e=new SimpleMDE({element:l[0],autosave:{enabled:false},forceSync:true,spellChecker:false,promptURLs:true,status:false,styleSelectedText:a(".menu-toggle").css("display")!=="none"?false:true,minHeight:"50px",});if(l.val()!==""){e.togglePreview()}else{}if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},close:function(){a("#card-add-btn").button("option","label",lang.add);if(e){e.toTextArea();e=null}g[0].reset();g.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");g.find(".show-sibling").removeClass("hidden");g.find(".hidden-field").addClass("hidden");d.find('textarea[name="description"]').height("auto");d.find("#createdBy").html("");d.find("#createdOn").html("");d.find("#changedBy").html("");d.find("#changedOn").html("");d.find(".form-group.card-dates").addClass("hidden")}});g=d.find("form").on("submit",function(l){l.preventDefault();h(d,jsObject.card_save)});a("a.create-card").on("click",function(m){m.preventDefault();var l=a(this).data("stack");g.find('input[name="stack"]').val(l);d.dialog("open")});a(".board-card").on("click",function(m){m.preventDefault();var l=a(this).data("card");a.ajax({url:jsObject.card_get_url+l,method:"GET",success:function(p){d.find('input[name="id"]').val(p.entry.id);d.find('input[name="title"]').val(p.entry.title);d.find('input[name="position"]').val(p.entry.position);d.find('input[name="stack"]').val(p.entry.stack);d.find('input[name="archive"]').val(p.entry.archive);if(p.entry.date){var s=d.find('input[name="date"]');s.val(p.entry.date);d.find("input.date-display").datepicker("setDate",moment(p.entry.date).toDate());s.parent().siblings(".show-sibling").addClass("hidden");s.parent().removeClass("hidden")}if(p.entry.time){var n=d.find('input[name="time"]');n.val(p.entry.time);n.parent().siblings(".show-sibling").addClass("hidden");n.parent().removeClass("hidden")}var o=d.find('textarea[name="description"]');if(p.entry.description){o.val(p.entry.description);o.parent().siblings(".show-sibling").addClass("hidden");o.parent().removeClass("hidden")}d.find('select[name="users[]"]').val(p.entry.users);d.find("#createdBy").html(p.entry.createdBy);d.find("#createdOn").html(moment(p.entry.createdOn).format(i18n.dateformatJSFull));d.find("#changedBy").html(p.entry.changedBy);d.find("#changedOn").html(moment(p.entry.changedOn).format(i18n.dateformatJSFull));d.find(".form-group.card-dates").removeClass("hidden");var r=d.find(".avatar-small, .avatar-small");a.each(r,function(t,v){var u=a(v).data("user");if(jQuery.inArray(u,p.entry.users)!==-1){a(v).addClass("selected")}else{a(v).removeClass("selected")}});d.find('select[name="labels[]"]').val(p.entry.labels);a("#card-add-btn").button("option","label",lang.update);var q="<a href='#' data-url='"+jsObject.card_archive+p.entry.id+"' data-archive='"+p.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.card_delete+p.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";d.parent().find(".ui-dialog-titlebar .edit-bar").html(q);a("select#card-label-list").trigger("chosen:updated");d.dialog("open")}})});a(".show-sibling").on("click",function(l){l.preventDefault();a(this).addClass("hidden");a(this).siblings(".hidden-field").removeClass("hidden").find("input, textarea").focus();if(e){e.codemirror.refresh()}return false});b=a("#label-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"label-add-btn",click:function(){h(b,jsObject.label_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(l,m){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#label-add-btn").button("option","label",lang.add);f[0].reset();f.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");a(this).find(".color-wrapper").css("background-color","black")}});f=b.find("form").on("submit",function(l){l.preventDefault();h(b,jsObject.label_save)});a("a.create-label").on("click",function(l){l.preventDefault();b.dialog("open")});a("a.edit-label").on("click",function(m){m.preventDefault();var l=a(this).data("label");a.ajax({url:jsObject.label_get_url+l,method:"GET",success:function(n){b.find('input[name="id"]').val(n.entry.id);b.find('input[name="name"]').val(n.entry.name);b.find('input[name="background_color"]').val(n.entry.background_color);b.find('input[name="background_color"]').parent(".color-wrapper").css("background-color",n.entry.background_color);b.find('input[name="text_color"]').val(n.entry.text_color);b.find('input[name="text_color"]').parent(".color-wrapper").css("background-color",n.entry.text_color);a("#label-add-btn").button("option","label",lang.update);var o="<a href='#' data-url='"+jsObject.label_delete+n.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";b.parent().find(".ui-dialog-titlebar .edit-bar").html(o);b.dialog("open")}})});a(".stack-wrapper").sortable({items:".stack",axis:"x",tolerance:"pointer",helper:"clone",handle:".stack-header",cursor:"move",containment:"parent",start:function(l,m){m.helper.removeClass("stack-border")},stop:function(l,m){},update:function(l,n){var m=a(this).sortable("serialize");a.ajax({data:m,type:"POST",url:jsObject.stack_position_url})}}).disableSelection();a(".card-wrapper").sortable({connectWith:".card-wrapper",dropOnEmpty:true,helper:"clone",placeholder:"card-placeholder",update:function(l,n){var m=a(this).sortable("serialize");a.ajax({data:m,type:"POST",url:jsObject.card_position_url})},receive:function(n,o){var l=a(this).data("stack");var m=o.item.data("card");a.ajax({data:{card:m,stack:l},type:"POST",url:jsObject.card_movestack_url})}}).disableSelection();a("body").on("click",".btn-archive",function(m){m.preventDefault();var l=a(this).data("url");var n=a(this).data("archive");if(n===1){if(!confirm(lang.undo_archive)){return false}}else{if(!confirm(lang.really_archive)){return false}}a.ajax({url:l,method:"POST",data:{archive:n?0:1},success:function(o){window.location.reload()},error:function(o){alert(o)}})});a("#card-form .avatar").on("click",function(n){n.preventDefault();var l=a(this).data("user");var m=a("#card-form select#users option[value='"+l+"']");if(m.prop("selected")){m.prop("selected",false);a(this).removeClass("selected")}else{m.prop("selected",true);a(this).addClass("selected")}});a(".avatar").disableSelection();c();a(window).resize(function(){c()});a("#sidebar-toggle").on("click",function(l){l.preventDefault();if(a(".menu-toggle").css("display")!=="none"){a(this).parent().toggleClass("mobile-visible");a(this).parent().removeClass("desktop-hidden")}else{a(this).parent().toggleClass("desktop-hidden");a(this).parent().removeClass("mobile-visible")}});a(document).on("change",'input[type="color"]',function(){a(this).parent(".color-wrapper").css("background-color",""+a(this).val())});function c(){d.dialog({width:a(window).width()>550?550:"auto"});if(a(".menu-toggle").css("display")!=="none"){a(".stack-wrapper").sortable({axis:false})}else{a(".stack-wrapper").sortable({axis:"x"})}}a("select#card-label-list").chosen({width:"100%",disable_search:true,placeholder_text_multiple:lang.labels});function j(){var l=a(".sidebar");if(a(window).scrollTop()<a("#masthead").outerHeight()){l.css("padding-top",a("#masthead").outerHeight()-a(window).scrollTop())}else{l.css("padding-top",0)}}j();a(window).scroll(function(){j()});a("#checkboxArchivedItems").on("click",function(l){l.preventDefault();a.ajax({url:jsObject.set_archive,method:"POST",data:{state:a(this).is(":checked")?1:0},success:function(m){window.location.reload()},error:function(m){alert(m)}})});a(".avatar-small").tooltip();setInterval(function(){var l=i.dialog("isOpen");var n=d.dialog("isOpen");var m=b.dialog("isOpen");if(!l===true&&!n===true&&!m===true){window.location.reload()}},30000);d.keypress(function(l){if(l.keyCode===13){l.preventDefault();h(d,jsObject.card_save)}})})})(jQuery);