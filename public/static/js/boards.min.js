
(function(a){a(document).ready(function(){var o,r,f,k,c,j;var g=null;var l=false;function n(t,s){a("#loading-overlay").removeClass("hidden");h();var u=t.find('input[name="id"]').val();a.ajax({url:s+u,method:"POST",data:t.find("form").serialize(),success:function(v){l=true;window.location.reload()},error:function(v){alert(v)}})}o=a("#stack-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"stack-add-btn",click:function(){n(o,jsObject.stack_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(s,t){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#stack-add-btn").button("option","label",lang.add);r[0].reset();r.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("")}});r=o.find("form").on("submit",function(s){s.preventDefault();n(o,jsObject.stack_save)});a("a.create-stack").on("click",function(s){s.preventDefault();o.dialog("open")});a(".stack-header").on("click",function(t){t.preventDefault();a("#loading-overlay").removeClass("hidden");var s=a(this).data("stack");a.ajax({url:jsObject.stack_get_url+s,method:"GET",success:function(u){if(u.status!=="error"){o.find('input[name="id"]').val(u.entry.id);o.find('input[name="name"]').val(u.entry.name);o.find('input[name="position"]').val(u.entry.position);a("#stack-add-btn").button("option","label",lang.update);var v="<a href='#' data-url='"+jsObject.stack_archive+u.entry.id+"' data-archive='"+u.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.stack_delete+u.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";o.parent().find(".ui-dialog-titlebar .edit-bar").html(v);o.dialog("open")}}}).done(function(){a("#loading-overlay").addClass("hidden")})});f=a("#card-form").dialog({autoOpen:false,autoResize:true,width:550,modal:true,buttons:[{text:lang.add,id:"card-add-btn",click:function(){n(f,jsObject.card_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],open:function(){var s=f.find('textarea[name="description"]');g=new SimpleMDE({element:s[0],autosave:{enabled:false},forceSync:true,spellChecker:false,promptURLs:true,status:false,styleSelectedText:a(".menu-toggle").css("display")!=="none"?false:true,minHeight:"50px",});if(s.val()!==""){g.togglePreview()}else{}if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},close:function(){a("#card-add-btn").button("option","label",lang.add);if(g){g.toTextArea();g=null}k[0].reset();k.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");k.find(".show-sibling").removeClass("hidden");k.find(".hidden-field").addClass("hidden");f.find('textarea[name="description"]').height("auto");f.find("#createdBy").html("");f.find("#createdOn").html("");f.find("#changedBy").html("");f.find("#changedOn").html("");f.find(".form-group.card-dates").addClass("hidden");h()}});k=f.find("form").on("submit",function(s){s.preventDefault();n(f,jsObject.card_save)});a("a.create-card").on("click",function(t){t.preventDefault();var s=a(this).data("stack");k.find('input[name="stack"]').val(s);f.dialog("open")});a(".board-card").on("click",function(t){t.preventDefault();var s=a(this).data("card");b(s)});function b(s){a("#loading-overlay").removeClass("hidden");a.ajax({url:jsObject.card_get_url+s,method:"GET",success:function(v){if(v.status!=="error"){f.find('input[name="id"]').val(v.entry.id);f.find('input[name="title"]').val(v.entry.title);f.find('input[name="position"]').val(v.entry.position);f.find('input[name="stack"]').val(v.entry.stack);f.find('input[name="archive"]').val(v.entry.archive);if(v.entry.date){var y=f.find('input[name="date"]');y.val(v.entry.date);f.find("input.date-display").datepicker("setDate",moment(v.entry.date).toDate());y.parent().siblings(".show-sibling").addClass("hidden");y.parent().removeClass("hidden")}if(v.entry.time){var t=f.find('input[name="time"]');t.val(v.entry.time);t.parent().siblings(".show-sibling").addClass("hidden");t.parent().removeClass("hidden")}var u=f.find('textarea[name="description"]');if(v.entry.description){u.val(v.entry.description);u.parent().siblings(".show-sibling").addClass("hidden");u.parent().removeClass("hidden")}f.find('select[name="users[]"]').val(v.entry.users);f.find("#createdBy").html(v.entry.createdBy);f.find("#createdOn").html(moment(v.entry.createdOn).format(i18n.dateformatJSFull));f.find("#changedBy").html(v.entry.changedBy);f.find("#changedOn").html(moment(v.entry.changedOn).format(i18n.dateformatJSFull));f.find(".form-group.card-dates").removeClass("hidden");var x=f.find(".avatar-small, .avatar-small");a.each(x,function(z,B){var A=a(B).data("user");if(jQuery.inArray(A,v.entry.users)!==-1){a(B).addClass("selected")}else{a(B).removeClass("selected")}});f.find('select[name="labels[]"]').val(v.entry.labels);a("#card-add-btn").button("option","label",lang.update);var w="<a href='#' data-url='"+jsObject.card_archive+v.entry.id+"' data-archive='"+v.entry.archive+"' class='btn-archive'><i class='fa fa-archive' aria-hidden='true'></i></a> \n                                    <a href='#' data-url='"+jsObject.card_delete+v.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";f.parent().find(".ui-dialog-titlebar .edit-bar").html(w);a("select#card-label-list").trigger("chosen:updated");f.dialog("open")}else{h()}}}).done(function(){a("#loading-overlay").addClass("hidden")})}a(".show-sibling").on("click",function(s){s.preventDefault();a(this).addClass("hidden");a(this).siblings(".hidden-field").removeClass("hidden").find("input, textarea").focus();if(g){g.codemirror.refresh()}return false});c=a("#label-form").dialog({autoOpen:false,autoResize:true,width:330,modal:true,buttons:[{text:lang.add,id:"label-add-btn",click:function(){n(c,jsObject.label_save)},"class":"button"},{text:lang.cancel,click:function(){a(this).dialog("close")},"class":"button gray"}],create:function(){a(this).parent().children(".ui-dialog-titlebar").append('<span class="edit-bar"></span>')},open:function(s,t){if(a(".menu-toggle").css("display")!=="none"){a(this).parent().focus()}},close:function(){a("#label-add-btn").button("option","label",lang.add);j[0].reset();j.find('input[type="hidden"].reset-field').val("");a(this).parent().find(".ui-dialog-titlebar .edit-bar").html("");a(this).find(".color-wrapper").css("background-color","black")}});j=c.find("form").on("submit",function(s){s.preventDefault();n(c,jsObject.label_save)});a("a.create-label").on("click",function(s){s.preventDefault();c.dialog("open")});a("a.edit-label").on("click",function(t){t.preventDefault();a("#loading-overlay").removeClass("hidden");var s=a(this).data("label");a.ajax({url:jsObject.label_get_url+s,method:"GET",success:function(u){if(u.status!=="error"){c.find('input[name="id"]').val(u.entry.id);c.find('input[name="name"]').val(u.entry.name);c.find('input[name="background_color"]').val(u.entry.background_color);c.find('input[name="background_color"]').parent(".color-wrapper").css("background-color",u.entry.background_color);c.find('input[name="text_color"]').val(u.entry.text_color);c.find('input[name="text_color"]').parent(".color-wrapper").css("background-color",u.entry.text_color);a("#label-add-btn").button("option","label",lang.update);var v="<a href='#' data-url='"+jsObject.label_delete+u.entry.id+"' class='btn-delete'><i class='fa fa-trash' aria-hidden='true'></i></a>";c.parent().find(".ui-dialog-titlebar .edit-bar").html(v);c.dialog("open")}}}).done(function(){a("#loading-overlay").addClass("hidden")})});a(".stack-wrapper").sortable({items:".stack",axis:"x",tolerance:"pointer",helper:"clone",handle:".stack-header",cursor:"move",containment:"parent",start:function(s,t){t.helper.removeClass("stack-border")},stop:function(s,t){},update:function(s,u){var t=a(this).sortable("serialize");a.ajax({data:t,type:"POST",url:jsObject.stack_position_url})}}).disableSelection();a(".card-wrapper").sortable({connectWith:".card-wrapper",dropOnEmpty:true,helper:"clone",placeholder:"card-placeholder",update:function(s,u){var t=a(this).sortable("serialize");a.ajax({data:t,type:"POST",url:jsObject.card_position_url})},receive:function(u,v){var s=a(this).data("stack");var t=v.item.data("card");a.ajax({data:{card:t,stack:s},type:"POST",url:jsObject.card_movestack_url})}}).disableSelection();a("body").on("click",".btn-archive",function(t){t.preventDefault();var s=a(this).data("url");var u=a(this).data("archive");if(u===1){if(!confirm(lang.undo_archive)){return false}}else{if(!confirm(lang.really_archive)){return false}}a.ajax({url:s,method:"POST",data:{archive:u?0:1},success:function(v){l=true;window.location.reload()},error:function(v){alert(v)}})});a("#card-form .avatar").on("click",function(u){u.preventDefault();var s=a(this).data("user");var t=a("#card-form select#users option[value='"+s+"']");if(t.prop("selected")){t.prop("selected",false);a(this).removeClass("selected")}else{t.prop("selected",true);a(this).addClass("selected")}});a(".avatar").disableSelection();d();a(window).resize(function(){d()});a("#sidebar-toggle").on("click",function(s){s.preventDefault();if(a(".menu-toggle").css("display")!=="none"){a(this).parent().removeClass("desktop-hidden");a(this).parent().toggleClass("mobile-visible");if(a(this).parent().hasClass("mobile-visible")){q("sidebar_mobilevisible",1);q("sidebar_desktophidden",0)}else{q("sidebar_mobilevisible",0)}}else{a(this).parent().removeClass("mobile-visible");a(this).parent().toggleClass("desktop-hidden");if(a(this).parent().hasClass("desktop-hidden")){q("sidebar_desktophidden",1);q("sidebar_mobilevisible",0)}else{q("sidebar_desktophidden",0)}}});a(document).on("change",'input[type="color"]',function(){a(this).parent(".color-wrapper").css("background-color",""+a(this).val())});function d(){f.dialog({width:a(window).width()>550?550:"auto"});if(a(".menu-toggle").css("display")!=="none"){a(".stack-wrapper").sortable({axis:false})}else{a(".stack-wrapper").sortable({axis:"x"})}}a("select#card-label-list").chosen({width:"100%",disable_search:true,placeholder_text_multiple:lang.labels});function p(){var s=a(".sidebar");if(a(window).scrollTop()<a("#masthead").outerHeight()){s.css("padding-top",a("#masthead").outerHeight()-a(window).scrollTop())}else{s.css("padding-top",0)}}p();a(window).scroll(function(){p()});a("#checkboxArchivedItems").on("click",function(s){s.preventDefault();a.ajax({url:jsObject.set_archive,method:"POST",data:{state:a(this).is(":checked")?1:0},success:function(t){l=true;window.location.reload()},error:function(t){alert(t)}})});a(".avatar-small").tooltip();setInterval(function(){var s=o.dialog("isOpen");var u=f.dialog("isOpen");var t=c.dialog("isOpen");if(!s===true&&!u===true&&!t===true){window.location.reload()}},30000);f.keypress(function(s){if(s.keyCode===13){s.preventDefault();n(f,jsObject.card_save)}});a("#addComment").on("click",function(t){t.preventDefault();var s=f.find('input[name="id"]').val();var u=f.find('textarea[name="comment"]').val();a.ajax({url:jsObject.comment_save,method:"POST",data:{card:s,comment:u},success:function(v){},error:function(v){alert(v)}})});var m=window.location.href.match(/(?:\?card=([0-9]*))/);if(m!==null&&m.length>1){var e=m[1];b(e)}function h(){var t=window.location.toString();if(t.indexOf("?")>0){var s=t.substring(0,t.indexOf("?"));window.history.replaceState({},document.title,s)}}function i(s){var t=window.location.toString();var u=t.indexOf("?")>0?"&":"?";if(t.indexOf("card")<=0){window.history.replaceState({},document.title,t+u+"card="+s)}}a(window).on("beforeunload",function(){var s=o.dialog("isOpen");var u=f.dialog("isOpen");var t=c.dialog("isOpen");if(!l&&(s===true||u===true||t===true)){return lang.really_close}});function q(s,v,u,x){u=u||365;var w=new Date();w.setDate(w.getDate()+u);var t=[s+"="+v,"expires="+w.toUTCString(),"path="+x||"/"];document.cookie=t.join(";")}})})(jQuery);