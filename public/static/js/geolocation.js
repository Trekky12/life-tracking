"use strict";function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(locationRetrieved,locationError,geoOptions):console.log("Geolocation is not supported by this browser.")}function locationRetrieved(e){console.log(e),e.coords.accuracy<lastAccuracy&&(latField.value=e.coords.latitude,lngField.value=e.coords.longitude,accField.value=e.coords.accuracy,lastAccuracy=e.coords.accuracy,drawMap()),e.coords.accuracy>50?(console.log("Accuracy not exact"),timeout=setTimeout(function(){getLocation()},5e3)):console.log("Accuracy reached")}function locationError(e){switch(e.code){case e.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case e.TIMEOUT:console.log("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:console.log("An unknown error occurred.")}}function drawMap(){if(null!==map){let e=latField.value,a=lngField.value,o=accField.value;if(0===e.length||0===a.length)return;null===my_map&&(map.style.height="300px",map.classList.add("visible"),deleteLoc.classList.remove("hidden"),my_map=L.map("geo-map").setView([default_location.lat,default_location.lng],default_location.zoom),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(my_map)),null!==my_marker&&my_map.removeLayer(my_marker),(my_marker=L.marker([e,a],{draggable:!0})).on("drag",function(e){let a=e.target.getLatLng();latField.value=a.lat,lngField.value=a.lng,accField.value=0,my_marker._popup.setContent('<a href="#" data-lat="'+a.lat+'" data-lng="'+a.lng+'" class="btn-get-address">'+lang.address+"</a>"),clearTimeout(timeout)}),my_marker.addTo(my_map),my_map.on("click",function(e){my_marker.setLatLng(e.latlng),my_marker.off("mouseover"),my_marker.fire("drag")});let t="";o>0&&(t=lang.accuracy+": "+o+" m<br/>");let l='<a href="#" data-lat="'+e+'" data-lng="'+a+'" class="btn-get-address" id="marker-popup">'+lang.address+"</a>";if(my_marker.bindPopup(t+l),o>0){let e=null;my_marker.off("mouseover"),my_marker.on("mouseover",function(a){e=L.circle(a.target.getLatLng(),{opacity:.5,radius:o}).addTo(my_map)}),my_marker.on("mouseout",function(a){my_map.removeLayer(e)}),my_marker.on("dragstart",function(){my_marker.off("mouseover")})}let c=new L.featureGroup([my_marker]);my_map.fitBounds(c.getBounds())}}function removeMap(){map.style.height="0px",map.classList.remove("visible"),deleteLoc.classList.add("hidden"),my_map.off(),my_map.remove(),my_map=null,latField.value="",lngField.value="",accField.value="",clearTimeout(timeout)}const latField=document.querySelector("input#geoLat"),lngField=document.querySelector("input#geoLng"),accField=document.querySelector("input#geoAcc"),idField=document.querySelector('input[name="id"]'),updateLoc=document.querySelector("#update-location"),deleteLoc=document.querySelector("#delete-location"),map=document.querySelector("#geo-map"),geoOptions={enableHighAccuracy:!0,timeout:6e4,maximumAge:0};let my_map=null,lastAccuracy=9999999,my_marker=null,timeout=null;drawMap(),null===latField||null===lngField||null===accField||null!==idField||null===document.querySelector("#financeForm")&&null===document.querySelector("#gasolineForm")&&null===document.querySelector("#locationForm")||0===latField.value.length&&0===lngField.value.length&&0===accField.value.length&&getLocation(),null!==updateLoc&&updateLoc.addEventListener("click",function(e){e.preventDefault(),clearTimeout(timeout),lastAccuracy=9999999,getLocation()}),null!==deleteLoc&&deleteLoc.addEventListener("click",function(e){e.preventDefault(),removeMap()});