"use strict";function getMarkers(){let t=document.getElementById("inputStart").value,e=document.getElementById("inputEnd").value;fetch(jsObject.marker_url+"?from="+t+"&to="+e,{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.json()}).then(function(t){drawMap(t)}).catch(function(t){alert(t)})}function drawMap(t){var e=[],a=[],n=0;for(n in t){let u=t[n];if(null===u.lat||null===u.lng)return;var r=u.dt,d="";u.acc>0&&(d="<br/>"+lang.accuracy+" : "+u.acc+" m");var l='<br/><a href="#" data-id="'+u.id+'" class="btn-get-address">'+lang.address+"</a>",o='<br/><br/><a href="#" data-url="'+jsObject.delete_marker_url+u.id+'" class="btn-delete">'+lang.delete_text+"</a>",c=L.marker([u.lat,u.lng]).bindPopup(r+d+l+o);if(c.addTo(mymap),e.push([u.lat,u.lng,n]),u.acc>0){var i=null;c.on("mouseover",function(t){i=L.circle([u.lat,u.lng],{opacity:.5,radius:u.acc}).addTo(mymap)}),c.on("mouseout",function(t){mymap.removeLayer(i)})}a.push(c)}L.polyline(e).addTo(mymap);var u=new L.featureGroup(a);return mymap.fitBounds(u.getBounds()),!0}var mymap=L.map("mapid").setView([default_location.lat,default_location.lng],default_location.zoom);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(mymap),getMarkers(),document.addEventListener("click",function(t){let e=t.target.closest(".btn-get-address");if(e){let a=e.dataset.id;a&&(t.preventDefault(),fetch(jsObject.get_address_url+a,{method:"GET",credentials:"same-origin"}).then(function(t){return t.json()}).then(function(t){if("success"===t.status){var e="";t.data.police&&(e+=t.data.police+"\n"),t.data.road&&(e+=t.data.road+" "),t.data.house_number&&(e+=t.data.house_number),(t.data.road||t.data.house_number)&&(e+="\n"),t.data.postcode&&(e+=t.data.postcode+" "),t.data.city&&(e+=t.data.city),alert(e)}}).catch(function(t){alert(t)}))}});let locationFilter=document.getElementById("show-filter");null!==locationFilter&&locationFilter.addEventListener("click",function(t){t.preventDefault();let e=document.getElementById("search-form");e.style.height=e.scrollHeight+"px",e.classList.toggle("collapsed"),locationFilter.classList.toggle("hiddenSearch")});var datepickerRange=document.getElementById("dateRange"),datepickerStart=document.getElementById("inputStart"),datepickerEnd=document.getElementById("inputEnd");datepickerRange&&flatpickr(datepickerRange,{altInput:!0,altFormat:i18n.twig,dateFormat:"Y-m-d",locale:i18n.template,mode:"range",defaultDate:[datepickerStart.value,datepickerEnd.value],onChange:function(t){const e=t.map(t=>this.formatDate(t,"Y-m-d"));e.length>0&&(datepickerStart.value=e[0],datepickerEnd.value=e[0]),e.length>1&&(datepickerEnd.value=e[1])}});