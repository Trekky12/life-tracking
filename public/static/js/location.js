"use strict";function getMarkers(){return fetch(jsObject.marker_url+"?from="+from+"&to="+to,{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return e.json()}).then(function(e){markers=e,drawMarkers(e,!1)}).catch(function(e){console.log(e)})}function drawMarkers(e,a=!1){let r=[],n=[],o=0;for(o in e){let a=e[o],d=a.type;if(null===a.lat||null===a.lng)continue;var l=a.dt+"<br/>",t="";a.acc>0&&(t=lang.accuracy+" : "+a.acc+" m<br/>");var s='<a href="#" data-lat="'+a.lat+'" data-lng="'+a.lng+'" class="btn-get-address">'+lang.address+"</a>",c=a.steps>0?lang.steps+": "+a.steps+"<br/>":"",i='<br/><br/><a href="#" data-url="'+jsObject.delete_marker_url+a.id+'" class="btn-delete">'+lang.delete_text+"</a>";let u=l+t+c+s,m={},p={opacity:.5,radius:a.acc,weight:5,color:"#3388ff"};switch(d){case 0:u+=i;break;case 1:m.icon=greenIcon,p.color="green",u+="<br/><br/><strong>"+a.description+" - "+a.value+" "+i18n.currency+"</strong>";break;case 2:m.icon=yellowIcon,p.color="yellow";u+="<br/><br/><strong>"+(0==a.description?lang.car_refuel:lang.car_service)+"</strong>"}var y=L.marker([a.lat,a.lng],m).bindPopup(u);switch(a.acc>0&&(y.on("mouseover",function(e){let r=L.circle([a.lat,a.lng],p),n={weight:10,color:p.color},o=L.polygon([[a.lat,a.lng]],n);circleLayer.addLayer(r),circleLayer.addLayer(o)}),y.on("mouseout",function(e){removeCircleLayer()})),d){case 0:layerLocationMarkers.addLayer(y),layerLocationClusters.addLayer(y),r.push([a.lat,a.lng,o]);break;case 1:layerFinancesMarkers.addLayer(y),layerFinancesClusters.addLayer(y);break;case 2:layerCarsMarkers.addLayer(y),layerCarsClusters.addLayer(y)}n.push(y)}if(a?(layerLocation.addLayer(layerLocationMarkers),layerFinances.addLayer(layerFinancesMarkers),layerCars.addLayer(layerCarsMarkers)):(layerLocation.addLayer(layerLocationClusters),layerFinances.addLayer(layerFinancesClusters),layerCars.addLayer(layerCarsClusters)),mymap.addLayer(layerLocation),mymap.addLayer(layerFinances),mymap.addLayer(layerCars),n.length>0){var d=new L.featureGroup(n);mymap.fitBounds(d.getBounds())}var u=L.polyline(r);layerDirections.addLayer(u),a||clusterToggleLayer.addTo(mymap),(controlLayer=L.control.layers(null,null,{collapsed:!1})).addOverlay(clusterToggleLayer,"<span id='toggleClustering'></span>"),controlLayer.addOverlay(layerLocation,"<span id='layerLocation'></span>"),controlLayer.addOverlay(layerFinances,"<span id='layerFinances'></span>"),controlLayer.addOverlay(layerCars,"<span id='layerCars'></span>"),controlLayer.addOverlay(layerDirections,"<span id='layerDirections'></span>"),controlLayer.addTo(mymap),circleLayer.addTo(mymap)}function createClusterIcon(e,a){var r=e.getChildCount();return new L.DivIcon({html:"<div><span>"+r+"</span></div>",className:"marker-cluster "+a,iconSize:new L.Point(40,40)})}function removeCircleLayer(){circleLayer.clearLayers()}var mymap=L.map("mapid").setView([default_location.lat,default_location.lng],default_location.zoom);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',subdomains:["a","b","c"]}).addTo(mymap);var greenIcon=new L.Icon({iconUrl:"/static/assets/images/marker-icon-green.png",shadowUrl:"/static/assets/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellowIcon=new L.Icon({iconUrl:"/static/assets/images/marker-icon-yellow.png",shadowUrl:"/static/assets/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});const from=document.getElementById("inputStart").value,to=document.getElementById("inputEnd").value;var controlLayer=null,circleLayer=new L.LayerGroup;let markers=[];var clusterToggleLayer=new L.LayerGroup;let layerLocation=new L.LayerGroup,layerFinances=new L.LayerGroup,layerCars=new L.LayerGroup,layerDirections=new L.LayerGroup,layerLocationMarkers=new L.LayerGroup,layerFinancesMarkers=new L.LayerGroup,layerCarsMarkers=new L.LayerGroup,layerLocationClusters=L.markerClusterGroup({iconCreateFunction:function(e){return createClusterIcon(e,"location")},maxClusterRadius:50}),layerFinancesClusters=L.markerClusterGroup({iconCreateFunction:function(e){return createClusterIcon(e,"finances")},maxClusterRadius:50}),layerCarsClusters=L.markerClusterGroup({iconCreateFunction:function(e){return createClusterIcon(e,"cars")},maxClusterRadius:50});mymap.on("zoom",function(){removeCircleLayer()}),getMarkers(),mymap.on("overlayremove",function(e){e.layer===layerLocation&&(controlLayer.removeLayer(layerDirections),setTimeout(function(){mymap.removeLayer(layerDirections)},10)),e.layer===clusterToggleLayer&&(layerLocation.removeLayer(layerLocationClusters),layerFinances.removeLayer(layerFinancesClusters),layerCars.removeLayer(layerCarsClusters),layerLocation.addLayer(layerLocationMarkers),layerFinances.addLayer(layerFinancesMarkers),layerCars.addLayer(layerCarsMarkers))}),mymap.on("overlayadd",function(e){e.layer!==layerLocation||mymap.hasLayer(layerDirections)||controlLayer.addOverlay(layerDirections,"<span id='layerDirections'></span>"),e.layer===clusterToggleLayer&&(layerLocation.removeLayer(layerLocationMarkers),layerFinances.removeLayer(layerFinancesMarkers),layerCars.removeLayer(layerCarsMarkers),layerLocation.addLayer(layerLocationClusters),layerFinances.addLayer(layerFinancesClusters),layerCars.addLayer(layerCarsClusters))});let locationFilter=document.getElementById("show-filter");null!==locationFilter&&locationFilter.addEventListener("click",function(e){e.preventDefault();let a=document.getElementById("search-form");a.style.height=a.scrollHeight+"px",a.classList.toggle("collapsed"),locationFilter.classList.toggle("hiddenSearch")});