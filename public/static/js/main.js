"use strict";window.onunload=function(){},moment.locale(i18n.template),initialize();const loadingWindowOverlay=document.getElementById("loading-overlay");function getCSRFToken(){return tokens.length>1?new Promise((function(e,t){e(tokens.pop())})):getNewTokens(tokens.pop())}function getNewTokens(e){return fetchWithTimeout(jsObject.csrf_tokens_url,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({csrf_name:e.csrf_name,csrf_value:e.csrf_value})}).then((function(e){return e.json()})).then((function(e){tokens=e})).then((function(){return tokens.pop()})).catch((function(t){throw tokens.push(e),console.log(t),"No CRSF Tokens available"}))}function createConfirmDialog(e,t){var n=document.createElement("div");n.id="confirm-modal",n.classList.add("modal");var a=document.createElement("div");a.classList.add("modal-inner");var o=document.createElement("form"),i=document.createElement("div");i.classList.add("modal-content");var l=document.createElement("p");l.textContent=e,i.appendChild(l);var c=document.createElement("div");c.classList.add("modal-footer");var r=document.createElement("div");r.classList.add("buttons");var d=document.createElement("button");d.type="button",d.classList.add("button"),d.textContent=lang.yes;var s=document.createElement("button");s.classList.add("button","button-text","cancel"),s.type="button",s.textContent=lang.no,r.appendChild(d),r.appendChild(s),c.appendChild(r),o.appendChild(i),o.appendChild(c),a.appendChild(o),n.appendChild(a),document.body.appendChild(n),n.style.display="block",d.onclick=function(){n.remove(),t(!0)},s.onclick=function(){n.remove(),t(!1)}}function confirmDialog(e){return new Promise(((t,n)=>{createConfirmDialog(e,t)}))}async function deleteObject(e,t){let n=lang.really_delete;if("default"!==t&&(n=t),!await confirmDialog(n))return loadingWindowOverlay.classList.add("hidden"),!1;getCSRFToken(!0).then((function(t){return fetch(e,{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})})).then((function(e){return e.json()})).then((function(e){allowedReload=!0,"redirect"in e?window.location.href=e.redirect:window.location.reload(!0)})).catch((function(t){console.log(t),loadingWindowOverlay.classList.add("hidden"),document.body.classList.contains("offline")&&saveDataWhenOffline(e,"DELETE")}))}function setCookie(e,t,n,a){n=n||365;var o=new Date;o.setDate(o.getDate()+n);var i=[e+"="+t,"expires="+o.toUTCString(),"path="+(a||"/"),"SameSite=Lax"];document.cookie=i.join(";")}function getCookie(e,t){for(var n=e+"=",a=decodeURIComponent(document.cookie).split(";"),o=0;o<a.length;o++){for(var i=a[o];""==i.charAt(0);)i=i.substring(1);if(i.indexOf(n)>=0)return i.substring(i.indexOf(n)+n.length,i.length)}return t||""}function initialize(){isTouchEnabled()?document.body.classList.add("is-touch-enabled"):document.body.classList.add("no-touch-enabled");let e=document.querySelector("#go-back-btn");null!==e&&e.addEventListener("click",(function(){loadingWindowOverlay.classList.remove("hidden"),window.history.back()}));let t=document.querySelector("#cancel");if(null!==t&&t.addEventListener("click",(function(e){e.preventDefault(),loadingWindowOverlay.classList.remove("hidden"),window.history.back()})),document.body.classList.contains("login")){if(!("indexedDB"in window))return;window.indexedDB.deleteDatabase("lifeTrackingData")}document.addEventListener("click",(async function(e){let t=e.target.closest("a"),n=e.target.closest('[type="submit"]'),a=t&&t.getAttribute("href")&&!t.getAttribute("href").startsWith("#")&&"_blank"!=t.getAttribute("target")&&!t.classList.contains("no-loading")&&t.href.includes(window.location.hostname);if((a||n&&!n.classList.contains("no-loading"))&&loadingWindowOverlay.classList.remove("hidden"),a&&(e.preventDefault(),await storeQueryParams(),window.location.href=t.getAttribute("href")),n)for(const e of n.closest("form").querySelectorAll("[required]"))e.reportValidity()||loadingWindowOverlay.classList.add("hidden");let o=e.target.closest(".btn-delete");if(o){e.preventDefault();let t=o.dataset.url;if(t){deleteObject(t,o.dataset.confirm?o.dataset.confirm:"default")}else o.parentNode.remove()}else;}));let n=document.querySelector("#financesRecurringForm #dateSelect");null!==n&&n.addEventListener("change",(function(e){document.querySelector("#financesRecurringForm input[name=last_run]").value=""}));let a=document.querySelector("#checkboxCommon");a&&a.addEventListener("change",(function(e){document.querySelector("#commonValue").classList.toggle("hidden");var t=document.querySelector("#inputValue").value;t&&(e.target.checked?(document.querySelector("#inputCommonValue").value=t,document.querySelector("#inputValue").value=t/2):(document.querySelector("#inputValue").value=document.querySelector("#inputCommonValue").value,document.querySelector("#inputCommonValue").value=""))}))}function fetchWithTimeout(e,t,n=3e3){if(document.body.classList.contains("offline"))return new Promise((function(e,t){t("Offline")}));const a=new AbortController,o=a.signal;var i,l=[],c=new Promise((function(e,t){i=setTimeout((function(){a.abort(),t("Timeout")}),n)}));l.push(c);var r=fetch(e,{signal:o,...t}).then((function(e){return clearTimeout(i),e}));return l.push(r),Promise.race(l)}function freeze(){window.scrollY;document.body.style.overflow="hidden"}function unfreeze(){document.body.style.overflow="",window.onscroll=null}function isMobile(){return isVisible(document.getElementById("mobile-header-icons"))}function isTouchEnabled(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function isVisible(e){return"none"!==getDisplay(e)}function isVisibleOnPage(e){let t=Array.from(document.querySelectorAll(e));for(const e of t)if(isVisible(e))return!0;return!1}function getDisplay(e){return e.currentStyle?e.currentStyle.display:getComputedStyle(e,null).display}async function storeQueryParams(){try{var e=await getCSRFToken(!0);e.path=window.location.pathname,e.params=window.location.search;const t=await fetchWithTimeout(jsObject.store_query_params,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}}function addRipple(e){let t=e.target.closest(".button");t&&createRipple(t,e);let n=e.target.closest("a.tabbar-tab");n&&createRipple(n,e)}function createRipple(e,t){const n=e.getBoundingClientRect(),a=document.createElement("span"),o=Math.max(e.clientWidth,e.clientHeight),i=o/2;a.style.width=a.style.height=`${o}px`,t?(a.style.left=t.clientX-n.left-i+"px",a.style.top=t.clientY-n.top-i+"px"):(a.style.left=n.left/2-i+"px",a.style.top=n.top/2-i+"px"),a.classList.add("ripple-circle");const l=e.getElementsByClassName("ripple-circle")[0];l&&l.remove(),e.appendChild(a)}flatpickr("#dateSelect",{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.date,altInputClass:"datepicker dateSelect",dateFormat:"Y-m-d",locale:i18n.template,onReady:function(e,t,n){n.altInput&&(n.__defaultValue=n.input.defaultValue,n.altInput.defaultValue=n.altInput.value,n.input.form.addEventListener("reset",(function(e){n.setDate(n.__defaultValue)})))}}),flatpickr("#dateSelectEnd",{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.date,altInputClass:"datepicker dateSelectEnd",dateFormat:"Y-m-d",locale:i18n.template,onReady:function(e,t,n){n.altInput&&(n.__defaultValue=n.input.defaultValue,n.altInput.defaultValue=n.altInput.value,n.input.form.addEventListener("reset",(function(e){n.setDate(n.__defaultValue)})))}}),document.addEventListener("click",(function(e){let t=e.target.closest(".btn-get-address");if(t){let n=t.dataset.lat,a=t.dataset.lng;n&&a&&(e.preventDefault(),fetch(jsObject.get_address_url+"?lat="+n+"&lng="+a,{method:"GET",credentials:"same-origin"}).then((function(e){return e.json()})).then((function(e){if("success"===e.status){var t="";e.data.police&&(t+=e.data.police+"\n"),e.data.road&&(t+=e.data.road+" "),e.data.house_number&&(t+=e.data.house_number),(e.data.road||e.data.house_number)&&(t+="\n"),e.data.postcode&&(t+=e.data.postcode+" "),e.data.city&&(t+=e.data.city),alert(t)}})).catch((function(e){console.log(e)})))}e.target.closest("span.closebtn")&&(e.preventDefault(),e.target.parentElement.classList.add("hidden"))})),isTouchEnabled()?document.addEventListener("touchstart",(async function(e){addRipple(e.touches[0])})):document.addEventListener("mousedown",(async function(e){addRipple(e)}));