"use strict";window.onunload=function(){},moment.locale(i18n.template),initialize();const loadingWindowOverlay=document.getElementById("loading-overlay");function getCSRFToken(){return 0==tokens.length?new Promise((e=>{setTimeout((()=>e(getCSRFToken())),1e3)})):tokens.length>1?new Promise((function(e,t){e(tokens.pop())})):getNewTokens(tokens.pop())}function getNewTokens(e){return fetchWithTimeout(jsObject.csrf_tokens_url,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({csrf_name:e.csrf_name,csrf_value:e.csrf_value})}).then((function(e){return e.json()})).then((function(e){tokens=e})).then((function(){return tokens.pop()})).catch((function(t){throw tokens.push(e),console.log(t),"No CRSF Tokens available"}))}function createConfirmDialog(e,t,n){var o=document.createElement("dialog");o.id="confirm-modal",o.classList.add("vertical-centered");var a=document.createElement("form"),l=document.createElement("div");l.classList.add("modal-content");var i=document.createElement("p");if(i.textContent=e,l.appendChild(i),t&&""!=t){var c=document.createElement("p");c.classList.add("alert","danger"),c.textContent=t,l.appendChild(c)}var r=document.createElement("div");r.classList.add("modal-footer");var d=document.createElement("div");d.classList.add("buttons");var s=document.createElement("button");s.type="button",s.classList.add("button"),s.textContent=lang.yes;var u=document.createElement("button");function m(e){"Enter"===e.key?(e.preventDefault(),o.close(),o.remove(),n(!0),document.removeEventListener("keydown",m)):"Escape"!==e.key&&27!==e.keyCode||(e.preventDefault(),o.close(),o.remove(),n(!1),document.removeEventListener("keydown",m))}u.classList.add("button","button-text","cancel"),u.type="button",u.textContent=lang.no,d.appendChild(s),d.appendChild(u),r.appendChild(d),a.appendChild(l),a.appendChild(r),o.appendChild(a),document.body.appendChild(o),o.showModal(),s.onclick=function(){o.close(),o.remove(),n(!0)},u.onclick=function(){o.close(),o.remove(),n(!1),document.removeEventListener("keydown",m)},document.addEventListener("keydown",m)}function confirmDialog(e,t=""){return new Promise(((n,o)=>{createConfirmDialog(e,t,n)}))}function createInputDialog(e,t,n){var o=document.createElement("dialog");o.id="input-modal",o.classList.add("vertical-centered");var a=document.createElement("form"),l=document.createElement("div");l.classList.add("modal-content");var i=document.createElement("p");i.textContent=e,l.appendChild(i);let c=document.createElement("div");c.classList.add("form-group");var r=document.createElement("input");if(r.type=n?"password":"text",r.classList.add("form-control"),c.appendChild(r),l.appendChild(c),n){let e=document.createElement("div");e.classList.add("form-group");let t=document.createElement("label");t.classList.add("form-control");var d=document.createElement("input");d.type="checkbox",d.onclick=function(){"password"===r.type?r.type="text":r.type="password"},t.appendChild(d),t.appendChild(document.createTextNode(" "+lang.show_password)),e.appendChild(t),l.appendChild(e)}var s=document.createElement("div");s.classList.add("modal-footer");var u=document.createElement("div");u.classList.add("buttons");var m=document.createElement("button");m.type="button",m.classList.add("button"),m.textContent=lang.ok;var p=document.createElement("button");function f(e){"Enter"===e.key?(e.preventDefault(),o.close(),o.remove(),t(r.value),document.removeEventListener("keydown",f)):"Escape"!==e.key&&27!==e.keyCode||(e.preventDefault(),o.close(),o.remove(),t(!1),document.removeEventListener("keydown",f))}p.classList.add("button","button-text","cancel"),p.type="button",p.textContent=lang.cancel,u.appendChild(m),u.appendChild(p),s.appendChild(u),a.appendChild(l),a.appendChild(s),o.appendChild(a),document.body.appendChild(o),o.showModal(),r.focus(),m.onclick=function(){o.close(),o.remove(),t(r.value)},p.onclick=function(){o.close(),o.remove(),t(!1),document.removeEventListener("keydown",f)},document.addEventListener("keydown",f)}function inputDialog(e,t){return new Promise(((n,o)=>{createInputDialog(e,n,t)}))}async function deleteObject(e){let t=e.url,n=e.confirm?e.confirm:"default",o=lang.really_delete;"default"!==n&&(o=n);let a=e.warning?e.warning:null;if(!await confirmDialog(o,a))return loadingWindowOverlay.classList.add("hidden"),!1;let l=e;getCSRFToken(!0).then((function(e){return l.csrf_name=e.csrf_name,l.csrf_value=e.csrf_value,fetch(t,{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})})).then((function(e){return e.json()})).then((function(e){allowedReload=!0,"redirect"in e?window.location.href=e.redirect:window.location.reload(!0)})).catch((function(e){console.log(e),loadingWindowOverlay.classList.add("hidden"),document.body.classList.contains("offline")&&saveDataWhenOffline(t,"DELETE")}))}function setCookie(e,t,n,o){n=n||365;var a=new Date;a.setDate(a.getDate()+n);var l=[e+"="+t,"expires="+a.toUTCString(),"path="+(o||"/"),"SameSite=Lax"];document.cookie=l.join(";")}function getCookie(e,t){for(var n=e+"=",o=decodeURIComponent(document.cookie).split(";"),a=0;a<o.length;a++){for(var l=o[a];""==l.charAt(0);)l=l.substring(1);if(l.indexOf(n)>=0)return l.substring(l.indexOf(n)+n.length,l.length)}return t||""}function initialize(){isTouchEnabled()?document.body.classList.add("is-touch-enabled"):document.body.classList.add("no-touch-enabled");let e=document.querySelector("#go-back-btn");null!==e&&e.addEventListener("click",(function(){loadingWindowOverlay.classList.remove("hidden"),window.history.back()}));let t=document.querySelector("#cancel");null!==t&&t.addEventListener("click",(function(e){e.preventDefault(),loadingWindowOverlay.classList.remove("hidden"),window.history.back()}));let n=document.querySelector("#reload");null!==n&&n.addEventListener("click",(function(e){e.preventDefault(),loadingWindowOverlay.classList.remove("hidden"),setTimeout((function(){window.location.reload()}),20)})),document.addEventListener("click",(async function(e){let t=e.target.closest("a"),n=e.target.closest('[type="submit"]'),o=t&&t.getAttribute("href")&&!t.getAttribute("href").startsWith("#")&&"_blank"!=t.getAttribute("target")&&!t.classList.contains("no-loading")&&t.href.includes(window.location.hostname);if((o||n&&!n.classList.contains("no-loading"))&&loadingWindowOverlay.classList.remove("hidden"),o&&(e.preventDefault(),await storeQueryParams(),setTimeout((function(){window.location.href=t.getAttribute("href")}),20)),n)for(const e of n.closest("form").querySelectorAll("[required]"))e.reportValidity()||loadingWindowOverlay.classList.add("hidden");let a=e.target.closest(".btn-delete");if(a){return e.preventDefault(),void(a.dataset.url?deleteObject(a.dataset):a.parentNode.remove())}}));let o=document.querySelector("#financesRecurringForm #dateSelect");null!==o&&o.addEventListener("change",(function(e){document.querySelector("#financesRecurringForm input[name=last_run]").value=""}));let a=document.querySelector("#checkboxCommon");a&&a.addEventListener("change",(function(e){document.querySelector("#commonValue").classList.toggle("hidden");var t=document.querySelector("#inputValue").value;t&&(e.target.checked?(document.querySelector("#inputCommonValue").value=t,document.querySelector("#inputValue").value=t/2):(document.querySelector("#inputValue").value=document.querySelector("#inputCommonValue").value,document.querySelector("#inputCommonValue").value=""))}))}function fetchWithTimeout(e,t,n=3e3){if(document.body.classList.contains("offline"))return new Promise((function(e,t){t("Offline")}));const o=new AbortController,a=o.signal;var l,i=[],c=new Promise((function(e,t){l=setTimeout((function(){o.abort(),t("Timeout")}),n)}));i.push(c);var r=fetch(e,{signal:a,...t}).then((function(e){return clearTimeout(l),e}));return i.push(r),Promise.race(i)}function freeze(){document.body.style.overflow="hidden"}function unfreeze(){document.body.style.overflow=""}function isMobile(){return isVisible(document.getElementById("mobile-header-icons"))}function isTouchEnabled(){return"ontouchstart"in window||navigator.msMaxTouchPoints>0}function isVisible(e){return"none"!==getDisplay(e)}function isVisibleOnPage(e){let t=Array.from(document.querySelectorAll(e));for(const e of t)if(isVisible(e))return!0;return!1}function getDisplay(e){return e.currentStyle?e.currentStyle.display:getComputedStyle(e,null).display}function isOffline(e){return e instanceof TypeError&&e.message.startsWith("NetworkError")&&setOffline(!0),document.body.classList.contains("offline")}async function storeQueryParams(){try{var e=await getCSRFToken(!0);e.path=window.location.pathname,e.params=window.location.search;const t=await fetchWithTimeout(jsObject.store_query_params,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}}function addRipple(e){let t=e.target.closest(".button");t&&createRipple(t,e);let n=e.target.closest("a.tabbar-tab");n&&createRipple(n,e)}function createRipple(e,t){const n=e.getBoundingClientRect(),o=document.createElement("span"),a=Math.max(e.clientWidth,e.clientHeight),l=a/2;o.style.width=o.style.height=`${a}px`,t?(o.style.left=t.clientX-n.left-l+"px",o.style.top=t.clientY-n.top-l+"px"):(o.style.left=n.left/2-l+"px",o.style.top=n.top/2-l+"px"),o.classList.add("ripple-circle");const i=e.getElementsByClassName("ripple-circle")[0];i&&i.remove(),e.appendChild(o)}function splitDateInterval(e,t){if(null==e)return"";var n=e<0?"-":"",o=(e=Math.abs(e))/60,a=Math.floor(o/60),l=Math.floor(o-60*a),i=Math.floor(e-60*o);function c(e){return e<10?"0"+e:""+e}return n+(t?c(a)+":"+c(l):c(a)+":"+c(l)+":"+c(i))}flatpickr("#dateSelect",{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.date,altInputClass:"datepicker dateSelect",dateFormat:"Y-m-d",locale:i18n.template,onReady:function(e,t,n){n.altInput&&(n.__defaultValue=n.input.defaultValue,n.altInput.defaultValue=n.altInput.value,n.input.form.addEventListener("reset",(function(e){n.setDate(n.__defaultValue)})))}}),flatpickr("#dateSelectEnd",{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.date,altInputClass:"datepicker dateSelectEnd",dateFormat:"Y-m-d",locale:i18n.template,onReady:function(e,t,n){n.altInput&&(n.__defaultValue=n.input.defaultValue,n.altInput.defaultValue=n.altInput.value,n.input.form.addEventListener("reset",(function(e){n.setDate(n.__defaultValue)})))}}),document.addEventListener("click",(function(e){let t=e.target.closest(".btn-get-address");if(t){let n=t.dataset.lat,o=t.dataset.lng;n&&o&&(e.preventDefault(),fetch(jsObject.get_address_url+"?lat="+n+"&lng="+o,{method:"GET",credentials:"same-origin"}).then((function(e){return e.json()})).then((function(e){if("success"===e.status){var t="";e.data.police&&(t+=e.data.police+"\n"),e.data.road&&(t+=e.data.road+" "),e.data.house_number&&(t+=e.data.house_number),(e.data.road||e.data.house_number)&&(t+="\n"),e.data.postcode&&(t+=e.data.postcode+" "),e.data.city&&(t+=e.data.city),alert(t)}})).catch((function(e){console.log(e)})))}e.target.closest("span.closebtn")&&(e.preventDefault(),e.target.parentElement.classList.add("hidden")),e.target.closest(".details-wrapper .details-headline")&&(e.preventDefault(),e.target.closest(".details-wrapper").classList.toggle("active"))})),isTouchEnabled()?document.addEventListener("touchstart",(async function(e){addRipple(e.touches[0])})):document.addEventListener("mousedown",(async function(e){addRipple(e)}));