"use strict";window.onunload=function(){},moment.locale(i18n.template),initialize();const loadingWindowOverlay=document.getElementById("loading-overlay");function getCSRFToken(){return 0==tokens.length?new Promise((e=>{setTimeout((()=>e(getCSRFToken())),1e3)})):tokens.length>1?new Promise((function(e,t){e(tokens.pop())})):getNewTokens(tokens.pop())}function getNewTokens(e){return fetchWithTimeout(jsObject.csrf_tokens_url,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({csrf_name:e.csrf_name,csrf_value:e.csrf_value})}).then((function(e){return e.json()})).then((function(e){tokens=e})).then((function(){return tokens.pop()})).catch((function(t){throw tokens.push(e),console.log(t),"No CRSF Tokens available"}))}function createConfirmDialog(e,t,n){var a=document.createElement("div");a.id="confirm-modal",a.classList.add("modal"),a.classList.add("vertical-centered"),a.classList.add("small");var o=document.createElement("div");o.classList.add("modal-inner");var i=document.createElement("form"),l=document.createElement("div");l.classList.add("modal-content");var d=document.createElement("p");if(d.textContent=e,l.appendChild(d),t&&""!=t){var c=document.createElement("p");c.classList.add("alert","danger"),c.textContent=t,l.appendChild(c)}var r=document.createElement("div");r.classList.add("modal-footer");var s=document.createElement("div");s.classList.add("buttons");var u=document.createElement("button");u.type="button",u.classList.add("button"),u.textContent=lang.yes;var m=document.createElement("button");function p(e){"Enter"===e.key?(e.preventDefault(),a.remove(),n(!0),document.removeEventListener("keydown",p)):"Escape"!==e.key&&27!==e.keyCode||(e.preventDefault(),a.remove(),n(!1),document.removeEventListener("keydown",p))}m.classList.add("button","button-text","cancel"),m.type="button",m.textContent=lang.no,s.appendChild(u),s.appendChild(m),r.appendChild(s),i.appendChild(l),i.appendChild(r),o.appendChild(i),a.appendChild(o),document.body.appendChild(a),a.classList.add("visible"),u.onclick=function(){a.remove(),n(!0)},m.onclick=function(){a.remove(),n(!1),document.removeEventListener("keydown",p)},document.addEventListener("keydown",p)}function confirmDialog(e,t=""){return new Promise(((n,a)=>{createConfirmDialog(e,t,n)}))}function createInputDialog(e,t,n){var a=document.createElement("div");a.id="input-modal",a.classList.add("modal"),a.classList.add("vertical-centered");var o=document.createElement("div");o.classList.add("modal-inner");var i=document.createElement("form"),l=document.createElement("div");l.classList.add("modal-content");var d=document.createElement("p");d.textContent=e,l.appendChild(d);let c=document.createElement("div");c.classList.add("form-group");var r=document.createElement("input");if(r.type=n?"password":"text",r.classList.add("form-control"),c.appendChild(r),l.appendChild(c),n){let e=document.createElement("div");e.classList.add("form-group");let t=document.createElement("label");t.classList.add("form-control");var s=document.createElement("input");s.type="checkbox",s.onclick=function(){"password"===r.type?r.type="text":r.type="password"},t.appendChild(s),t.appendChild(document.createTextNode(" Show password")),e.appendChild(t),l.appendChild(e)}var u=document.createElement("div");u.classList.add("modal-footer");var m=document.createElement("div");m.classList.add("buttons");var p=document.createElement("button");p.type="button",p.classList.add("button"),p.textContent=lang.ok;var f=document.createElement("button");function v(e){"Enter"===e.key?(e.preventDefault(),a.remove(),t(r.value),document.removeEventListener("keydown",v)):"Escape"!==e.key&&27!==e.keyCode||(e.preventDefault(),a.remove(),t(!1),document.removeEventListener("keydown",v))}f.classList.add("button","button-text","cancel"),f.type="button",f.textContent=lang.cancel,m.appendChild(p),m.appendChild(f),u.appendChild(m),i.appendChild(l),i.appendChild(u),o.appendChild(i),a.appendChild(o),document.body.appendChild(a),a.style.display="block",r.focus(),p.onclick=function(){a.remove(),t(r.value)},f.onclick=function(){a.remove(),t(!1),document.removeEventListener("keydown",v)},document.addEventListener("keydown",v)}function inputDialog(e,t){return new Promise(((n,a)=>{createInputDialog(e,n,t)}))}async function deleteObject(e){let t=e.url,n=e.confirm?e.confirm:"default",a=lang.really_delete;"default"!==n&&(a=n);let o=e.warning?e.warning:null;if(!await confirmDialog(a,o))return loadingWindowOverlay.classList.add("hidden"),!1;let i=e;getCSRFToken(!0).then((function(e){return i.csrf_name=e.csrf_name,i.csrf_value=e.csrf_value,fetch(t,{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})})).then((function(e){return e.json()})).then((function(e){allowedReload=!0,"redirect"in e?window.location.href=e.redirect:window.location.reload(!0)})).catch((function(e){console.log(e),loadingWindowOverlay.classList.add("hidden"),document.body.classList.contains("offline")&&saveDataWhenOffline(t,"DELETE")}))}function setCookie(e,t,n,a){n=n||365;var o=new Date;o.setDate(o.getDate()+n);var i=[e+"="+t,"expires="+o.toUTCString(),"path="+(a||"/"),"SameSite=Lax"];document.cookie=i.join(";")}function getCookie(e,t){for(var n=e+"=",a=decodeURIComponent(document.cookie).split(";"),o=0;o<a.length;o++){for(var i=a[o];""==i.charAt(0);)i=i.substring(1);if(i.indexOf(n)>=0)return i.substring(i.indexOf(n)+n.length,i.length)}return t||""}function initialize(){isTouchEnabled()?document.body.classList.add("is-touch-enabled"):document.body.classList.add("no-touch-enabled");let e=document.querySelector("#go-back-btn");null!==e&&e.addEventListener("click",(function(){loadingWindowOverlay.classList.remove("hidden"),window.history.back()}));let t=document.querySelector("#cancel");null!==t&&t.addEventListener("click",(function(e){e.preventDefault(),loadingWindowOverlay.classList.remove("hidden"),window.history.back()}));let n=document.querySelector("#reload");if(null!==n&&n.addEventListener("click",(function(e){e.preventDefault(),loadingWindowOverlay.classList.remove("hidden"),window.location.reload()})),document.body.classList.contains("login")){if(!("indexedDB"in window))return;console.log("delete database"),window.indexedDB.deleteDatabase("lifeTrackingData")}document.addEventListener("click",(async function(e){let t=e.target.closest("a"),n=e.target.closest('[type="submit"]'),a=t&&t.getAttribute("href")&&!t.getAttribute("href").startsWith("#")&&"_blank"!=t.getAttribute("target")&&!t.classList.contains("no-loading")&&t.href.includes(window.location.hostname);if((a||n&&!n.classList.contains("no-loading"))&&loadingWindowOverlay.classList.remove("hidden"),a&&(e.preventDefault(),await storeQueryParams(),window.location.href=t.getAttribute("href")),n)for(const e of n.closest("form").querySelectorAll("[required]"))e.reportValidity()||loadingWindowOverlay.classList.add("hidden");let o=e.target.closest(".btn-delete");if(o){return e.preventDefault(),void(o.dataset.url?deleteObject(o.dataset):o.parentNode.remove())}}));let a=document.querySelector("#financesRecurringForm #dateSelect");null!==a&&a.addEventListener("change",(function(e){document.querySelector("#financesRecurringForm input[name=last_run]").value=""}));let o=document.querySelector("#checkboxCommon");o&&o.addEventListener("change",(function(e){document.querySelector("#commonValue").classList.toggle("hidden");var t=document.querySelector("#inputValue").value;t&&(e.target.checked?(document.querySelector("#inputCommonValue").value=t,document.querySelector("#inputValue").value=t/2):(document.querySelector("#inputValue").value=document.querySelector("#inputCommonValue").value,document.querySelector("#inputCommonValue").value=""))}))}function fetchWithTimeout(e,t,n=3e3){if(document.body.classList.contains("offline"))return new Promise((function(e,t){t("Offline")}));const a=new AbortController,o=a.signal;var i,l=[],d=new Promise((function(e,t){i=setTimeout((function(){a.abort(),t("Timeout")}),n)}));l.push(d);var c=fetch(e,{signal:o,...t}).then((function(e){return clearTimeout(i),e}));return l.push(c),Promise.race(l)}function freeze(){document.body.style.overflow="hidden"}function unfreeze(){document.body.style.overflow=""}function isMobile(){return isVisible(document.getElementById("mobile-header-icons"))}function isTouchEnabled(){return"ontouchstart"in window||navigator.msMaxTouchPoints>0}function isVisible(e){return"none"!==getDisplay(e)}function isVisibleOnPage(e){let t=Array.from(document.querySelectorAll(e));for(const e of t)if(isVisible(e))return!0;return!1}function getDisplay(e){return e.currentStyle?e.currentStyle.display:getComputedStyle(e,null).display}async function storeQueryParams(){try{var e=await getCSRFToken(!0);e.path=window.location.pathname,e.params=window.location.search;const t=await fetchWithTimeout(jsObject.store_query_params,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}}function addRipple(e){let t=e.target.closest(".button");t&&createRipple(t,e);let n=e.target.closest("a.tabbar-tab");n&&createRipple(n,e)}function createRipple(e,t){const n=e.getBoundingClientRect(),a=document.createElement("span"),o=Math.max(e.clientWidth,e.clientHeight),i=o/2;a.style.width=a.style.height=`${o}px`,t?(a.style.left=t.clientX-n.left-i+"px",a.style.top=t.clientY-n.top-i+"px"):(a.style.left=n.left/2-i+"px",a.style.top=n.top/2-i+"px"),a.classList.add("ripple-circle");const l=e.getElementsByClassName("ripple-circle")[0];l&&l.remove(),e.appendChild(a)}flatpickr("#dateSelect",{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.date,altInputClass:"datepicker dateSelect",dateFormat:"Y-m-d",locale:i18n.template,onReady:function(e,t,n){n.altInput&&(n.__defaultValue=n.input.defaultValue,n.altInput.defaultValue=n.altInput.value,n.input.form.addEventListener("reset",(function(e){n.setDate(n.__defaultValue)})))}}),flatpickr("#dateSelectEnd",{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.date,altInputClass:"datepicker dateSelectEnd",dateFormat:"Y-m-d",locale:i18n.template,onReady:function(e,t,n){n.altInput&&(n.__defaultValue=n.input.defaultValue,n.altInput.defaultValue=n.altInput.value,n.input.form.addEventListener("reset",(function(e){n.setDate(n.__defaultValue)})))}}),document.addEventListener("click",(function(e){let t=e.target.closest(".btn-get-address");if(t){let n=t.dataset.lat,a=t.dataset.lng;n&&a&&(e.preventDefault(),fetch(jsObject.get_address_url+"?lat="+n+"&lng="+a,{method:"GET",credentials:"same-origin"}).then((function(e){return e.json()})).then((function(e){if("success"===e.status){var t="";e.data.police&&(t+=e.data.police+"\n"),e.data.road&&(t+=e.data.road+" "),e.data.house_number&&(t+=e.data.house_number),(e.data.road||e.data.house_number)&&(t+="\n"),e.data.postcode&&(t+=e.data.postcode+" "),e.data.city&&(t+=e.data.city),alert(t)}})).catch((function(e){console.log(e)})))}e.target.closest("span.closebtn")&&(e.preventDefault(),e.target.parentElement.classList.add("hidden"))})),isTouchEnabled()?document.addEventListener("touchstart",(async function(e){addRipple(e.touches[0])})):document.addEventListener("mousedown",(async function(e){addRipple(e)}));