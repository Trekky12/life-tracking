"use strict";const categoriesUserElements=document.querySelectorAll("#notifications_categories_list_user input.set_notifications_category_user"),notificationsList=document.querySelector("#notifications"),loadingIcon=document.querySelector("#loadingIconNotifications"),loadMore=document.querySelector("#loadMoreNotifications");function setCategoryUser(e,t){let n={type:e,category:t};return getCSRFToken().then((function(e){return n.csrf_name=e.csrf_name,n.csrf_value=e.csrf_value,fetch(jsObject.notifications_clients_set_category_user,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})})).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log(e)}))}function getNotifications(){if(null!==notificationsList){let e=notificationsList.childElementCount,t=10;loadingIcon.classList.remove("hidden"),loadMore.classList.add("hidden");let n={count:t,start:e};return getCSRFToken().then((function(e){return n.csrf_name=e.csrf_name,n.csrf_value=e.csrf_value,fetch(jsObject.notifications_get,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})})).then((function(e){return e.json()})).then((function(n){if("error"!==n.status){loadingIcon.classList.add("hidden");let o=parseInt(n.count);e+t<o&&loadMore.classList.remove("hidden"),setNotificationCount(n.unseen),setAppBadge(),n.data.forEach((function(e,t){let o=document.createElement("div");o.classList="notification",o.innerHtml=e.message,o.dataset.id=e.id,e.seen&&(o.classList=o.classList+" seen");let i=document.createElement("div");i.classList="notification-header";let c=document.createElement("h2");if(e.link){let t=document.createElement("a");t.href=e.link,t.innerHTML=e.title,c.appendChild(t)}else c.innerHTML=e.title;if(i.appendChild(c),e.category&&1!==n.categories[e.category].internal){let t=document.createElement("span");t.innerHTML=lang.category+": "+n.categories[e.category].name,i.appendChild(t)}let s=document.createElement("div");s.classList="notification-content";let a=document.createElement("p");if(e.link){let t=document.createElement("a");t.href=e.link,t.innerHTML=e.message,a.appendChild(t)}else a.innerHTML=e.message;let l=document.createElement("div");l.classList="createdOn",l.innerHTML=moment(e.createdOn).format(i18n.dateformatJS.datetime),s.appendChild(a),s.appendChild(l),o.appendChild(i),o.appendChild(s),notificationsList.appendChild(o)}))}})).catch((function(e){console.log(e)}))}return emptyPromise()}function loadMoreFunctions(){null!==loadMore&&(loadMore.addEventListener("click",(function(e){getNotifications()})),document.addEventListener("scroll",(function(){let e=document.body,t=document.documentElement;(t.scrollTop>0&&t.scrollTop+t.clientHeight+100>=t.scrollHeight||e.scrollTop>0&&e.scrollTop+e.clientHeight+100>=e.scrollHeight)&&(loadMore.classList.contains("hidden")||getNotifications())})))}document.addEventListener("DOMContentLoaded",(function(){categoriesUserElements.forEach((function(e,t){e.addEventListener("click",(function(){let t=e.value;return e.checked?setCategoryUser(1,t).then((function(e){console.log(e)})):setCategoryUser(0,t).then((function(e){console.log(e)}))}))})),loadMoreFunctions(),getNotifications()}));