"use strict";const stepsList=document.querySelector("#recipes_steps"),addStepBtn=document.querySelector("#add-step-btn"),step_dummy=document.querySelector("#templates .step-dummy"),ingredient_dummy=document.querySelector("#templates .step-ingredient-dummy");function updateStepFields(){stepsList.querySelectorAll(".step:not(.step-dummy)").forEach((function(e,t){e.dataset.position=t,e.querySelectorAll("input, textarea, select").forEach((function(e){e.setAttribute("name",e.name.replace(/steps\[[^\]]*\]/,"steps["+t+"]"))}))}))}function createSortableSteps(e){new Sortable(e,{scroll:!0,draggable:".step",swapThreshold:.9,fallbackOnBody:!0,handle:".step-handle",ghostClass:"step-drag",onUpdate:function(e){updateStepFields()},onStart:function(e){document.body.classList.add("sortable-select")},onEnd:function(e){document.body.classList.remove("sortable-select"),e.item.scrollIntoView()}})}function updateIngredientFields(e){e.querySelectorAll(".step-ingredient").forEach((function(e,t){e.querySelectorAll("input, textarea, select").forEach((function(e){e.setAttribute("name",e.name.replace(/\[ingredients\]\[[^\]]*\]/,"[ingredients]["+t+"]"))}))}))}addStepBtn.addEventListener("click",(function(e){e.preventDefault();let t=stepsList.querySelectorAll(".step").length,n=step_dummy.cloneNode(!0);n.classList.remove("hidden"),n.classList.remove("step-dummy"),n.dataset.idx=t,n.querySelector(".step_name").value="Schritt "+(t+1),n.querySelectorAll("input, textarea, select").forEach((function(e,n){e.setAttribute("name",e.name.replace("dummy",t)),e.removeAttribute("disabled")})),createSortableIngredients(n.querySelector(".step-ingredients")),stepsList.appendChild(n)})),document.addEventListener("click",(function(e){let t=e.target.closest(".add-ingredient-btn"),n=e.target.closest(".step-minus"),s=e.target.closest(".remove-ingredient"),r=e.target.closest(".step");if(t){e.preventDefault(),console.log("add ingredient");let t=r.dataset.idx,n=r.querySelector(".step-ingredients"),s=n.querySelectorAll(".step-ingredient").length,l=ingredient_dummy.cloneNode(!0);l.classList.remove("step-ingredient-dummy"),l.querySelectorAll("input, textarea, select").forEach((function(e,n){e.setAttribute("name",e.name.replace("dummy_step",t).replace("dummy_ingredient",s)),e.removeAttribute("disabled")})),createChoiceIngredients(l.querySelector(".step-ingredient-select")),n.appendChild(l)}n&&(e.preventDefault(),n.parentElement.parentElement.remove(),updateStepFields()),s&&(e.preventDefault(),s.parentElement.remove(),updateIngredientFields(r))})),createSortableSteps(stepsList);const stepsIngredients=stepsList.querySelectorAll(".step .step-ingredients");function createSortableIngredients(e){new Sortable(e,{draggable:".step-ingredient",swapThreshold:.9,fallbackOnBody:!0,handle:".ingredient-handle",ghostClass:"ingredient-drag",onUpdate:function(t){updateIngredientFields(e.closest(".step"))}})}function createChoiceIngredients(e){let t=e.dataset.selected?e.dataset.selected:"",n=new Selectr(e,{searchable:!0,placeholder:lang.ingredient,messages:{noResults:lang.nothing_found,noOptions:lang.no_options}});return fetch(jsObject.ingredients_get).then((function(e){return e.json()})).then((function(e){n.add(e),n.setValue(t)}))}stepsIngredients.forEach((function(e,t){createSortableIngredients(e);e.querySelectorAll(".step-ingredient-select").forEach((function(e,t){createChoiceIngredients(e)}))}));