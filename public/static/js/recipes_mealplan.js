"use strict";const recipesList=document.querySelector("#recipes_list"),loadingIconRecipes=document.querySelector("#loadingIconRecipes"),filterSearchRecipes=document.getElementById("filterSearchRecipes");document.addEventListener("click",(function(e){let t=e.target.closest(".minus");if(t){e.preventDefault();let n=t.parentElement.parentElement,i={mealplan_recipe_id:n.dataset.id};getCSRFToken(!0).then((function(e){return i.csrf_name=e.csrf_name,i.csrf_value=e.csrf_value,fetch(jsObject.recipes_mealplan_remove_recipe,{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})})).then((function(e){return e.json()})).then((function(e){e.is_deleted&&n.remove()})).catch((function(e){console.log(e)}))}}));const recipesTargets=document.querySelectorAll(".recipes-target");function createSortable(e,t){if(document.querySelector(".mealplan-list-settings")){let n={group:{name:"recipes"},swapThreshold:.5,fallbackOnBody:!0,handle:".handle",dataIdAttr:"data-id",onUpdate:function(e){move_recipe(e)},onAdd:function(e){move_recipe(e)}};t&&(n.group.pull="clone",n.group.put=!1),new Sortable(e,n)}}function move_recipe(e){let t=e.to.dataset.date,n=e.item.dataset.recipe,i=e.item.dataset.id;var c={recipe:n,date:t,position:e.newDraggableIndex,id:i};getCSRFToken().then((function(e){return c.csrf_name=e.csrf_name,c.csrf_value=e.csrf_value,fetch(jsObject.recipes_mealplan_move_recipe,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})})).then((function(e){return e.json()})).then((function(t){if("success"===t.status){let n=t.id;e.item.dataset.id=n,e.item.querySelector(".minus").classList.remove("hidden")}else e.item.remove()})).catch((function(e){console.log(e)}))}function getRecipes(){let e=filterSearchRecipes?filterSearchRecipes.value:"",t=jsObject.recipes_get_mealplan+"?type=mealplan&count=5&start=0&query="+e;return loadingIconRecipes.classList.remove("hidden"),fetch(t,{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(recipesList.innerHTML="","error"!==e.status){if(loadingIconRecipes.classList.add("hidden"),parseInt(e.count)>0)recipesList.insertAdjacentHTML("beforeend",e.data),createSortable(recipesList,!0);else{let e=document.createElement("p");e.innerHTML=lang.nothing_found,recipesList.innerHTML="",recipesList.appendChild(e)}}})).catch((function(e){console.log(e)}))}recipesTargets.forEach((function(e,t){createSortable(e,!1)})),getRecipes(),filterSearchRecipes&&filterSearchRecipes.addEventListener("keyup",(function(e){e.preventDefault(),getRecipes()}));