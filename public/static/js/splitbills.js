"use strict";const splitbillsForm=document.getElementById("splitbillsBillsForm"),buttons=document.querySelectorAll(".splitbill_btn"),calcButton=document.getElementById("calculateExchangeRate");if(splitbillsForm){let e=splitbillsForm.querySelectorAll("input.balance_paid"),t=splitbillsForm.querySelectorAll("input.balance_spend"),l=splitbillsForm.querySelector("#inputValue"),n=splitbillsForm.querySelector("#remaining_paid"),a=splitbillsForm.querySelector("#remaining_spend"),i=splitbillsForm.querySelectorAll("input.balance_paid_foreign"),u=splitbillsForm.querySelectorAll("input.balance_spend_foreign"),c=splitbillsForm.querySelector("#inputValueForeign"),o=splitbillsForm.querySelector("#inputRate"),r=splitbillsForm.querySelector("#inputFee");function getSum(e){let t=0;return e.forEach((function(e){let l=Number.parseFloat(e.value);l&&(t+=l)})),t.toFixed(2)}function getTotal(){return""==l.value?0:parseFloat(l.value).toFixed(2)}function calculateRemaining(e,t){let l=getSum(e),n=getTotal();t.innerHTML=(n-l).toFixed(2)}function getValueInLocalCurrency(){let e=c.value/o.value;return e+=e*(parseFloat(r.value)/100),e.toFixed(2)}function getExchangeRateWithFee(){return parseFloat(c.value)/parseFloat(l.value)}function calculateValueInLocalCurrency(){l.value=getValueInLocalCurrency(),i.forEach((function(e,t){e.value=0})),u.forEach((function(e,t){e.value=0})),e.forEach((function(e,t){e.value=0})),t.forEach((function(e,t){e.value=0})),calculateRemaining(e,n),calculateRemaining(t,a)}l.addEventListener("input",(function(l){e.forEach((function(e){e.value=0})),t.forEach((function(e){e.value=0})),calculateRemaining(e,n),calculateRemaining(t,a),buttons.forEach((function(e){e.classList.add("gray")}))})),buttons.forEach((function(o,r){o.addEventListener("click",(function(r){r.preventDefault();let s=o.dataset.category,p=o.dataset.type,d=o.dataset.id,f=parseFloat(l.value),g=c?parseFloat(c.value):f;if(f>0){let l=o.parentNode.nextElementSibling;if(l.classList.add("hidden"),buttons.forEach((function(e){e.dataset.category==s&&e.classList.add("gray")})),o.classList.remove("gray"),"paid"==s&&(splitbillsForm.querySelector('input[name="paid_by"]').value="person"==p?d:p),"spend"==s&&(splitbillsForm.querySelector('input[name="spend_by"]').value="person"==p?d:p),"same"==p)"paid"==s?(equal_splitting(e,f),e.forEach((function(e,t){i[t]&&(i[t].value=(e.value*getExchangeRateWithFee()).toFixed(2))}))):"spend"==s&&(equal_splitting(t,f),t.forEach((function(e,t){u[t]&&(u[t].value=(e.value*getExchangeRateWithFee()).toFixed(2))})));else if("person"==p){if("paid"==s){e.forEach((function(e){e.value=0})),splitbillsForm.querySelector('input[name="balance['+d+'][paid]"]').value=f,i.forEach((function(e){e.value=0}));let t=splitbillsForm.querySelector('input[name="balance['+d+'][paid_foreign]"]');t&&(t.value=g)}else if("spend"==s){t.forEach((function(e){e.value=0})),splitbillsForm.querySelector('input[name="balance['+d+'][spend]"]').value=f,u.forEach((function(e){e.value=0}));let e=splitbillsForm.querySelector('input[name="balance['+d+'][spend_foreign]"]');e&&(e.value=g)}}else"individual"==p&&l.classList.remove("hidden");calculateRemaining(e,n),calculateRemaining(t,a)}}))})),splitbillsForm.addEventListener("submit",(function(l){let n=getSum(e),a=getSum(t),i=getTotal();i===n&&i===a||(l.preventDefault(),console.log(i),console.log(n),console.log(a),document.getElementById("loading-overlay").classList.add("hidden"),alert(lang.splitbills_numbers_wrong))})),e.forEach((function(t,l){t.addEventListener("input",(function(t){calculateRemaining(e,n)}))})),t.forEach((function(e,l){e.addEventListener("input",(function(e){calculateRemaining(t,a)}))})),o&&o.addEventListener("input",(function(e){calculateValueInLocalCurrency()})),r&&r.addEventListener("input",(function(e){calculateValueInLocalCurrency()})),c&&(c.addEventListener("input",(function(i){l.value=getValueInLocalCurrency(),calculateRemaining(e,n),calculateRemaining(t,a)})),i.forEach((function(l,i){l.addEventListener("input",(function(u){e[i].value=(l.value/getExchangeRateWithFee()).toFixed(2),calculateRemaining(e,n),calculateRemaining(t,a)}))})),u.forEach((function(l,i){l.addEventListener("input",(function(u){t[i].value=(l.value/getExchangeRateWithFee()).toFixed(2),calculateRemaining(e,n),calculateRemaining(t,a)}))})))}function equal_splitting(e,t){let l=[].slice.call(e).sort((function(){return.5-Math.random()})),n=l.length;l.forEach((function(e){let l=(t/n).toFixed(2);e.value=l,n--,t-=l}))}