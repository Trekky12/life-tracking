"use strict";const splitbillsForm=document.getElementById("splitbillsBillsForm"),splittbillsButtons=document.querySelectorAll(".splitbill_btn"),calcButton=document.getElementById("calculateExchangeRate");if(splitbillsForm){let e=splitbillsForm.querySelectorAll("input.balance_paid"),t=splitbillsForm.querySelectorAll("input.balance_spend"),l=splitbillsForm.querySelector("#inputValue"),n=splitbillsForm.querySelector("#remaining_paid"),i=splitbillsForm.querySelector("#remaining_spend"),a=splitbillsForm.querySelectorAll("input.balance_paid_foreign"),o=splitbillsForm.querySelectorAll("input.balance_spend_foreign"),u=splitbillsForm.querySelector("#inputValueForeign"),s=splitbillsForm.querySelector("#inputRate"),r=splitbillsForm.querySelector("#inputFee");function c(e){let t=0;return e.forEach((function(e){let l=Number.parseFloat(e.value);l&&(t+=l)})),t.toFixed(2)}function f(){return""==l.value?0:parseFloat(l.value).toFixed(2)}function d(e,t){let l=c(e),n=f();t&&(t.innerHTML=(n-l).toFixed(2))}function p(e){let t=e.value*s.value;return t+=t*(parseFloat(r.value)/100),t.toFixed(2)}function v(){return parseFloat(u.value)/parseFloat(l.value)}function b(){l.value=p(u),a.forEach((function(l,a){e[a].value=p(l),d(e,n),d(t,i)})),o.forEach((function(l,a){t[a].value=p(l),d(e,n),d(t,i)})),d(e,n),d(t,i)}l.addEventListener("input",(function(a){e.length>1&&e.length>1?(e.forEach((function(e){e.value=0})),t.forEach((function(e){e.value=0})),d(e,n),d(t,i),splittbillsButtons.forEach((function(e){e.classList.add("button-outlined")}))):(e.forEach((function(e){e.value=l.value})),t.forEach((function(e){e.value=l.value})))})),splittbillsButtons.forEach((function(s,r){s.addEventListener("click",(function(r){r.preventDefault();let c=s.dataset.category,f=s.dataset.type,p=s.dataset.id,b=parseFloat(l.value),E=u?parseFloat(u.value):b;if(b>0){let l=s.parentNode.nextElementSibling;if(l.classList.add("hidden"),splittbillsButtons.forEach((function(e){e.dataset.category==c&&e.classList.add("button-outlined")})),s.classList.remove("button-outlined"),"paid"==c&&(splitbillsForm.querySelector('input[name="paid_by"]').value="person"==f?p:f),"spend"==c&&(splitbillsForm.querySelector('input[name="spend_by"]').value="person"==f?p:f),"same"==f)"paid"==c?(equal_splitting(e,b),e.forEach((function(e,t){a[t]&&(a[t].value=(e.value*v()).toFixed(2))}))):"spend"==c&&(equal_splitting(t,b),t.forEach((function(e,t){o[t]&&(o[t].value=(e.value*v()).toFixed(2))})));else if("person"==f){if("paid"==c){e.forEach((function(e){e.value=0})),splitbillsForm.querySelector('input[name="balance['+p+'][paid]"]').value=b,a.forEach((function(e){e.value=0}));let t=splitbillsForm.querySelector('input[name="balance['+p+'][paid_foreign]"]');t&&(t.value=E)}else if("spend"==c){t.forEach((function(e){e.value=0})),splitbillsForm.querySelector('input[name="balance['+p+'][spend]"]').value=b,o.forEach((function(e){e.value=0}));let e=splitbillsForm.querySelector('input[name="balance['+p+'][spend_foreign]"]');e&&(e.value=E)}}else"individual"==f&&l.classList.remove("hidden");d(e,n),d(t,i)}}))})),splitbillsForm.addEventListener("submit",(function(l){let n=c(e),i=c(t),a=f();a===n&&a===i||(l.preventDefault(),console.log(a),console.log(n),console.log(i),document.getElementById("loading-overlay").classList.add("hidden"),alert(lang.splitbills_numbers_wrong))})),e.forEach((function(t,l){t.addEventListener("input",(function(t){d(e,n)}))})),t.forEach((function(e,l){e.addEventListener("input",(function(e){d(t,i)}))})),s&&s.addEventListener("input",(function(e){b(),splittbillsButtons.forEach((function(e){e.classList.add("button-outlined")}))})),r&&r.addEventListener("input",(function(e){b(),splittbillsButtons.forEach((function(e){e.classList.add("button-outlined")}))})),u&&(u.addEventListener("input",(function(s){l.value=p(u),a.length>1&&o.length>1?(a.forEach((function(e){e.value=0})),o.forEach((function(e){e.value=0})),e.forEach((function(e){e.value=0})),t.forEach((function(e){e.value=0})),d(e,n),d(t,i),splittbillsButtons.forEach((function(e){e.classList.add("button-outlined")}))):(a.forEach((function(t,l){t.value=u.value,e[l].value=p(t)})),o.forEach((function(e,l){e.value=u.value,t[l].value=p(e)})))})),a.forEach((function(l,a){l.addEventListener("input",(function(o){e[a].value=p(l),d(e,n),d(t,i)}))})),o.forEach((function(l,a){l.addEventListener("input",(function(o){t[a].value=p(l),d(e,n),d(t,i)}))})))}function equal_splitting(e,t){let l=[].slice.call(e).sort((function(){return.5-Math.random()})),n=l.length;l.forEach((function(e){let l=(t/n).toFixed(2);e.value=l,n--,t-=l}))}