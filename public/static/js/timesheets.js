"use strict";const selectedItems=document.querySelector("#selected_items"),projectCategorySelects=document.querySelectorAll("select.category");projectCategorySelects.forEach((function(e,t){new Selectr(e,{searchable:!0,placeholder:lang.categories,messages:{noResults:lang.nothing_found,noOptions:lang.no_options}})}));const projectNoticefieldsSelects=document.querySelectorAll("select.noticefield");projectNoticefieldsSelects.forEach((function(e,t){new Selectr(e,{searchable:!0,placeholder:lang.timesheets_noticefield,messages:{noResults:lang.nothing_found,noOptions:lang.no_options}})}));const dateTimePickerStart=document.querySelector("#datetimePickerStart"),dateTimePickerEnd=document.querySelector("#datetimePickerEnd"),dateTimePickerEndField=document.querySelector("#datetimePickerEndField");function setEndDate(){let e=dateTimePickerEndField.dataset.defaultDuration,t=dateTimePickerStart._flatpickr.selectedDates[0];e>0&&t.setSeconds(t.getSeconds()+e),dateTimePickerEnd._flatpickr.setDate(t)}dateTimePickerStart&&dateTimePickerEnd&&(flatpickr(dateTimePickerStart,{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.datetimeShort,altInputClass:"datepicker datetimePickerStart",dateFormat:"Y-m-d H:i",locale:i18n.template,enableTime:!0,time_24hr:!0,minuteIncrement:1,onChange:function(e){setEndDate()}}),flatpickr(dateTimePickerEnd,{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.datetimeShort,altInputClass:"datepicker datetimePickerEnd",dateFormat:"Y-m-d H:i",locale:i18n.template,enableTime:!0,time_24hr:!0,minuteIncrement:1}),"1"!=dateTimePickerEndField.dataset.saved&&setEndDate());const radioDurationCustomModification=document.getElementById("radioDurationCustom"),radioDurationNoModification=document.getElementById("radioDurationReal"),radioDurationRateModification=document.getElementById("radioDurationProjectRate"),inputDurationModificationWrapper=document.getElementById("inputDurationModificationWrapper");radioDurationCustomModification&&radioDurationNoModification&&radioDurationRateModification&&inputDurationModificationWrapper&&(radioDurationCustomModification.addEventListener("click",(function(e){if(radioDurationCustomModification.checked){inputDurationModificationWrapper.classList.remove("hidden");let e=inputDurationModificationWrapper.querySelector("input");e.disabled=!1,e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()}else inputDurationModificationWrapper.classList.add("hidden"),inputDurationModificationWrapper.querySelector("input").disabled=!0})),radioDurationNoModification.addEventListener("click",(function(e){inputDurationModificationWrapper.classList.add("hidden"),inputDurationModificationWrapper.querySelector("input").disabled=!0})),radioDurationRateModification.addEventListener("click",(function(e){inputDurationModificationWrapper.classList.add("hidden"),inputDurationModificationWrapper.querySelector("input").disabled=!0})));const assignCategoriesSelector=document.getElementById("assignCategoriesSelector"),assignCategoriesBtn=document.getElementById("assign_categories"),removeCategoriesBtn=document.getElementById("remove_categories");if(assignCategoriesSelector&&assignCategoriesBtn&&removeCategoriesBtn){let e=new Selectr(assignCategoriesSelector,{searchable:!0,placeholder:lang.categories,messages:{noResults:lang.nothing_found,noOptions:lang.no_options}});assignCategoriesBtn.addEventListener("click",(function(t){let n=e.getValue();setCategories({sheets:getSelectedSheets(),categories:n,type:"assign"})})),removeCategoriesBtn.addEventListener("click",(function(t){let n=e.getValue();setCategories({sheets:getSelectedSheets(),categories:n,type:"remove"})}))}function getSelectedSheets(){let e=[];return document.querySelectorAll('#timesheets_sheets_table tbody input[type="checkbox"]:checked').forEach((function(t){e.push(t.dataset.id)})),e}function setCategories(e){return loadingWindowOverlay.classList.remove("hidden"),getCSRFToken().then((function(t){return e.csrf_name=t.csrf_name,e.csrf_value=t.csrf_value,fetch(jsObject.timesheets_sheets_set_categories,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})})).then((function(e){return e.json()})).then((function(e){console.log(e),allowedReload=!0,window.location.reload(!0)})).catch((function(t){if(console.log(t),document.body.classList.contains("offline")){let t=new URLSearchParams(e).toString();saveDataWhenOffline(jsObject.timesheets_sheets_set_categories,"POST",t)}loadingWindowOverlay.classList.add("hidden")}))}const radioBudgetCount=document.getElementById("radioCategorization1"),radioBudgetDuration=document.getElementById("radioCategorization2"),radioBudgetDurationModified=document.getElementById("radioCategorization3");radioBudgetDuration&&radioBudgetDurationModified&&radioBudgetCount&&(radioBudgetDuration.addEventListener("click",(function(e){document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.remove("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled"),e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)}))})),radioBudgetDurationModified.addEventListener("click",(function(e){document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.remove("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled"),e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)}))})),radioBudgetCount.addEventListener("click",(function(e){radioBudgetCount.checked?(document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.add("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled")}))):(document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.remove("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled"),e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)})))})));const applyOptionsBtn=document.querySelector("#apply_options"),optionsSelector=document.querySelector("select#applyOptions");applyOptionsBtn&&applyOptionsBtn.addEventListener("click",(function(e){let t=optionsSelector.value,n={sheets:getSelectedSheets(),option:t};return loadingWindowOverlay.classList.remove("hidden"),getCSRFToken().then((function(e){return n.csrf_name=e.csrf_name,n.csrf_value=e.csrf_value,fetch(jsObject.timesheets_sheets_set_options,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})})).then((function(e){return e.json()})).then((function(e){console.log(e),allowedReload=!0,window.location.reload(!0)})).catch((function(e){if(console.log(e),document.body.classList.contains("offline")){let e=new URLSearchParams(n).toString();saveDataWhenOffline(jsObject.timesheets_sheets_set_categories,"POST",e)}loadingWindowOverlay.classList.add("hidden")}))}));var calendarEl=document.getElementById("timesheets_calendar");const eventModal=document.getElementById("event-modal");if(calendarEl){let t=calendarEl.dataset.min,n=calendarEl.dataset.max,i=calendarEl.dataset.hiddendays,o=calendarEl.dataset.project,d=calendarEl.dataset.edit,a=localStorage.getItem("calendarView_"+o)||"timeGridWeek",r=localStorage.getItem("calendarDate_"+o)||new Date;var calendar=new FullCalendar.Calendar(calendarEl,{initialView:a,initialDate:r,locale:i18n.template,events:{url:jsObject.timesheets_calendar_events},headerToolbar:{left:"dayGridMonth,timeGridWeek,timeGridDay,listWeek",center:"title",right:"today prev,next"},views:{timeGridWeek:{allDaySlot:!1,nowIndicator:!0,slotMinTime:t,slotMaxTime:n,hiddenDays:i},timeGridDay:{allDaySlot:!1,nowIndicator:!0,slotMinTime:t,slotMaxTime:n,hiddenDays:i}},datesSet:function(e){localStorage.setItem("calendarView_"+o,e.view.type),localStorage.setItem("calendarDate_"+o,e.startStr),"dayGridMonth"!==e.view.type?calendar.setOption("eventContent",(function(e){let t=document.createElement("div");t.classList.add("fc-event-time"),t.innerText=e.timeText;let n=document.createElement("div");n.classList.add("fc-event-title-container");let i=document.createElement("div");i.classList.add("fc-event-title");let o=e.event.title;return o=e.event.extendedProps.has_sheet_notice?document.getElementById("iconNotice").innerHTML+e.event.title:e.event.title,e.event.extendedProps.categories&&(e.event.title&&(o+=" | "),o+=e.event.extendedProps.categories),i.innerHTML=o,n.appendChild(i),{domNodes:[t,n]}})):calendar.setOption("eventContent",null)},contentHeight:"auto",selectable:!0,select:function(e){loadingWindowOverlay.classList.remove("hidden"),window.location.href=`${d}&start=${encodeURIComponent(e.startStr)}`},eventClick:function(e){console.log(e.event.extendedProps),eventModal.querySelector(".date").textContent=e.event.extendedProps.date;let t=eventModal.querySelector(".customer"),n=t.querySelector(".customerName");e.event.extendedProps.customer?(n.textContent=e.event.extendedProps.customer,t.classList.remove("hidden")):(n.textContent="",t.classList.add("hidden"));let i=t.querySelector(".customer-notice-btn");e.event.extendedProps.customer_notice?(i.href=e.event.extendedProps.customer_notice,i.classList.remove("hidden")):i.classList.add("hidden");let o=eventModal.querySelector(".categories"),d=o.querySelector(".categoriesName");e.event.extendedProps.categories?d.textContent=e.event.extendedProps.categories:(d.textContent="",o.classList.add("hidden"));let a=null!=e.event.extendedProps.reference_sheet||e.event.extendedProps.series.length>0,r=eventModal.querySelector(".state");if(0!=e.event.extendedProps.is_billed||0!=e.event.extendedProps.is_payed||0!=e.event.extendedProps.is_planned||a){r.classList.remove("hidden");let t=eventModal.querySelector(".billed");1==e.event.extendedProps.is_billed?t.classList.remove("hidden"):t.classList.add("hidden");let n=eventModal.querySelector(".payed");1==e.event.extendedProps.is_payed?n.classList.remove("hidden"):n.classList.add("hidden");let i=eventModal.querySelector(".planned");1==e.event.extendedProps.is_planned?i.classList.remove("hidden"):i.classList.add("hidden");let o=eventModal.querySelector(".series"),d=eventModal.querySelector(".following"),s=d.querySelector("ul");s.innerHTML="";let c=eventModal.querySelector(".btn-deletefollowing");a?(o.classList.remove("hidden"),o.querySelector(".count").innerHTML=e.event.extendedProps.series.length,e.event.extendedProps.remaining.length>0?(d.classList.remove("hidden"),e.event.extendedProps.remaining.forEach((e=>{const t=document.createElement("li");t.textContent=e,s.appendChild(t)})),c.classList.remove("hidden")):(d.classList.add("hidden"),c.classList.add("hidden"))):(o.classList.add("hidden"),o.querySelector(".count").innerHTML="",d.classList.add("hidden"),c.classList.add("hidden"))}else r.classList.add("hidden");let s=eventModal.querySelector(".sheet-notice-btn");e.event.extendedProps.sheet_notice?(s.href=e.event.extendedProps.sheet_notice,s.classList.remove("hidden")):s.classList.add("hidden"),eventModal.querySelector(".btn-edit").href=e.event.extendedProps.edit,eventModal.querySelectorAll(".btn-delete").forEach((t=>{t.dataset.url=e.event.extendedProps.delete,e.event.extendedProps.has_sheet_notice?t.dataset.warning=lang.timesheets_sheets_delete_warning_notice:t.dataset.warning=""})),freeze(),eventModal.classList.add("visible")}});calendar.render(),document.getElementById("modal-close-btn").addEventListener("click",(function(e){hideEventModal()})),eventModal.addEventListener("click",(function(e){e.target===eventModal&&hideEventModal()}))}const checkBoxRepeat=document.querySelector("#checkBoxRepeat"),repeatsContent=document.querySelector(".repeats-content");function hideEventModal(){unfreeze(),eventModal&&eventModal.classList.remove("visible")}checkBoxRepeat&&repeatsContent&&checkBoxRepeat.addEventListener("click",(function(e){checkBoxRepeat.checked?repeatsContent.classList.remove("hidden"):repeatsContent.classList.add("hidden")})),document.addEventListener("click",(function(e){let t=e.target.closest("#checkAllRows");if(t){document.querySelectorAll('#timesheets_sheets_table tbody input[type="checkbox"]').forEach((function(e){t.checked?e.checked=!0:e.checked=!1})),selectedItems.innerHTML=getSelectedSheets().length}e.target.closest('#timesheets_sheets_table tbody input[type="checkbox"]')&&(selectedItems.innerHTML=getSelectedSheets().length),e.target.closest("#event-modal a")&&hideEventModal()})),document.addEventListener("keydown",(function(e){"Escape"!==e.key&&27!==e.keyCode||hideEventModal()}));const noticeFieldsFilter=document.getElementById("noticefieldsfilter");if(noticeFieldsFilter){function s(e){e.checked&&"html-overview"===e.value?noticeFieldsFilter.classList.remove("hidden"):noticeFieldsFilter.classList.add("hidden")}document.querySelectorAll('.search-filter input[name="type"]').forEach((function(e){s(e),e.addEventListener("click",(function(t){s(e)}))}))}