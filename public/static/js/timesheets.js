"use strict";const selectedItems=document.querySelector("#selected_items"),projectCategorySelects=document.querySelectorAll("select.category");projectCategorySelects.forEach((function(e,t){new Selectr(e,{searchable:!0,placeholder:lang.categories,messages:{noResults:lang.nothing_found,noOptions:lang.no_options}})}));const projectNoticefieldsSelects=document.querySelectorAll("select.noticefield");projectNoticefieldsSelects.forEach((function(e,t){new Selectr(e,{searchable:!0,placeholder:lang.timesheets_noticefield,messages:{noResults:lang.nothing_found,noOptions:lang.no_options}})}));const dateTimePickerStart=document.querySelector("#datetimePickerStart"),dateTimePickerEnd=document.querySelector("#datetimePickerEnd"),dateTimePickerEndField=document.querySelector("#datetimePickerEndField");function setEndDate(){if(!dateTimePickerStart||!dateTimePickerEnd)return;let e=dateTimePickerEndField.dataset.defaultDuration,t=dateTimePickerStart._flatpickr.selectedDates[0];e>0&&t.setSeconds(t.getSeconds()+e),dateTimePickerEnd._flatpickr.setDate(t)}dateTimePickerStart&&flatpickr(dateTimePickerStart,{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.datetimeShort,altInputClass:"datepicker datetimePickerStart",dateFormat:"Y-m-d H:i",locale:i18n.template,enableTime:!0,time_24hr:!0,minuteIncrement:1,onChange:function(e){setEndDate()}}),dateTimePickerEnd&&(flatpickr(dateTimePickerEnd,{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.datetimeShort,altInputClass:"datepicker datetimePickerEnd",dateFormat:"Y-m-d H:i",locale:i18n.template,enableTime:!0,time_24hr:!0,minuteIncrement:1}),"1"!=dateTimePickerEndField.dataset.saved&&setEndDate());const radioDurationCustomModification=document.getElementById("radioDurationCustom"),radioDurationNoModification=document.getElementById("radioDurationReal"),radioDurationRateModification=document.getElementById("radioDurationProjectRate"),inputDurationModificationWrapper=document.getElementById("inputDurationModificationWrapper");radioDurationCustomModification&&radioDurationNoModification&&radioDurationRateModification&&inputDurationModificationWrapper&&(radioDurationCustomModification.addEventListener("click",(function(e){if(radioDurationCustomModification.checked){inputDurationModificationWrapper.classList.remove("hidden");let e=inputDurationModificationWrapper.querySelector("input");e.disabled=!1,e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()}else inputDurationModificationWrapper.classList.add("hidden"),inputDurationModificationWrapper.querySelector("input").disabled=!0})),radioDurationNoModification.addEventListener("click",(function(e){inputDurationModificationWrapper.classList.add("hidden"),inputDurationModificationWrapper.querySelector("input").disabled=!0})),radioDurationRateModification.addEventListener("click",(function(e){inputDurationModificationWrapper.classList.add("hidden"),inputDurationModificationWrapper.querySelector("input").disabled=!0})));const assignCategoriesSelector=document.getElementById("assignCategoriesSelector"),assignCategoriesBtn=document.getElementById("assign_categories"),removeCategoriesBtn=document.getElementById("remove_categories");if(assignCategoriesSelector&&assignCategoriesBtn&&removeCategoriesBtn){let e=new Selectr(assignCategoriesSelector,{searchable:!0,placeholder:lang.categories,messages:{noResults:lang.nothing_found,noOptions:lang.no_options}});assignCategoriesBtn.addEventListener("click",(function(t){let n=e.getValue();setCategories({sheets:getSelectedSheets(),categories:n,type:"assign"})})),removeCategoriesBtn.addEventListener("click",(function(t){let n=e.getValue();setCategories({sheets:getSelectedSheets(),categories:n,type:"remove"})}))}function getSelectedSheets(){let e=[];return document.querySelectorAll('#timesheets_sheets_table tbody input[type="checkbox"]:checked').forEach((function(t){e.push(t.dataset.id)})),e}function setCategories(e){return loadingWindowOverlay.classList.remove("hidden"),getCSRFToken().then((function(t){return e.csrf_name=t.csrf_name,e.csrf_value=t.csrf_value,fetch(jsObject.timesheets_sheets_set_categories,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})})).then((function(e){return e.json()})).then((function(e){console.log(e),allowedReload=!0,window.location.reload(!0)})).catch((function(t){if(console.log(t),document.body.classList.contains("offline")){let t=new URLSearchParams(e).toString();saveDataWhenOffline(jsObject.timesheets_sheets_set_categories,"POST",t)}loadingWindowOverlay.classList.add("hidden")}))}const radioBudgetCount=document.getElementById("radioCategorization1"),radioBudgetDuration=document.getElementById("radioCategorization2"),radioBudgetDurationModified=document.getElementById("radioCategorization3");radioBudgetDuration&&radioBudgetDurationModified&&radioBudgetCount&&(radioBudgetDuration.addEventListener("click",(function(e){document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.remove("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled"),e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)}))})),radioBudgetDurationModified.addEventListener("click",(function(e){document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.remove("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled"),e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)}))})),radioBudgetCount.addEventListener("click",(function(e){radioBudgetCount.checked?(document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.add("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled")}))):(document.querySelectorAll(".html-duration-picker-input-controls-wrapper").forEach((function(e){e.classList.remove("hidden")})),document.querySelectorAll("input.duration-input").forEach((function(e){e.classList.remove("hidden"),e.removeAttribute("disabled"),e.classList.contains("html-duration-picker")||e.classList.add("html-duration-picker"),HtmlDurationPicker.refresh()})),document.querySelectorAll("input.count-input").forEach((function(e){e.classList.add("hidden"),e.setAttribute("disabled",!0)})))})));const applyOptionsBtn=document.querySelector("#apply_options"),optionsSelector=document.querySelector("select#applyOptions");applyOptionsBtn&&applyOptionsBtn.addEventListener("click",(function(e){let t=optionsSelector.value,n={sheets:getSelectedSheets(),option:t};return loadingWindowOverlay.classList.remove("hidden"),getCSRFToken().then((function(e){return n.csrf_name=e.csrf_name,n.csrf_value=e.csrf_value,fetch(jsObject.timesheets_sheets_set_options,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})})).then((function(e){return e.json()})).then((function(e){console.log(e),allowedReload=!0,window.location.reload(!0)})).catch((function(e){if(console.log(e),document.body.classList.contains("offline")){let e=new URLSearchParams(n).toString();saveDataWhenOffline(jsObject.timesheets_sheets_set_categories,"POST",e)}loadingWindowOverlay.classList.add("hidden")}))}));var calendarEl=document.getElementById("timesheets_calendar");const eventModal=document.getElementById("event-modal");if(calendarEl){let t=calendarEl.dataset.min,n=calendarEl.dataset.max,i=calendarEl.dataset.hiddendays,a=calendarEl.dataset.project,d=calendarEl.dataset.edit,o=calendarEl.dataset.from,r=(calendarEl.dataset.to,localStorage.getItem("calendarView_"+a)||"timeGridWeek"),s=localStorage.getItem("calendarDate_"+a),c=s?new Date(s):o?new Date(o):new Date;var calendar=new FullCalendar.Calendar(calendarEl,{initialView:r,initialDate:c,locale:i18n.template,events:{url:jsObject.timesheets_calendar_events},headerToolbar:{left:"dayGridMonth,timeGridWeek,timeGridDay,listWeek",center:"title",right:"today prev,next"},views:{timeGridWeek:{allDaySlot:!1,nowIndicator:!0,slotMinTime:t,slotMaxTime:n,hiddenDays:i},timeGridDay:{allDaySlot:!1,nowIndicator:!0,slotMinTime:t,slotMaxTime:n,hiddenDays:i}},datesSet:function(e){localStorage.setItem("calendarView_"+a,e.view.type),localStorage.setItem("calendarDate_"+a,e.view.currentStart),"dayGridMonth"!==e.view.type?calendar.setOption("eventContent",(function(e){let t=document.createElement("div");t.classList.add("fc-event-time");let n=e.timeText;n="1"==e.event.extendedProps.is_happened?document.getElementById("iconCheck").innerHTML+e.timeText:e.timeText,t.innerHTML=n;let i=document.createElement("div");i.classList.add("fc-event-title-container");let a=document.createElement("div");a.classList.add("fc-event-title");let d=e.event.title;return d=e.event.extendedProps.has_sheet_notice?document.getElementById("iconNotice").innerHTML+e.event.title:e.event.title,a.innerHTML=d,i.appendChild(a),{domNodes:[t,i]}})):calendar.setOption("eventContent",null)},contentHeight:"auto",selectable:!0,select:function(e){loadingWindowOverlay.classList.remove("hidden"),window.location.href=`${d}&start=${encodeURIComponent(e.startStr)}`},eventClick:function(e){console.log(e.event.extendedProps),eventModal.querySelector(".date").textContent=e.event.extendedProps.date;let t=eventModal.querySelector(".customer"),n=t.querySelector(".customer-name");e.event.extendedProps.customer?(n.textContent=e.event.extendedProps.customer,t.classList.remove("hidden")):(n.textContent="",t.classList.add("hidden"));let i=t.querySelector(".customer-notice-btn");e.event.extendedProps.customer_notice?(i.href=e.event.extendedProps.customer_notice,i.classList.remove("hidden")):i.classList.add("hidden");let a=eventModal.querySelector(".categories"),d=a.querySelector(".categoriesName");e.event.extendedProps.categories?(d.textContent=e.event.extendedProps.categories,a.classList.remove("hidden")):(d.textContent="",a.classList.add("hidden"));let o=eventModal.querySelector(".state");if(0==e.event.extendedProps.is_invoiced&&0==e.event.extendedProps.is_billed&&0==e.event.extendedProps.is_payed&&0==e.event.extendedProps.is_happened)o.classList.add("hidden");else{o.classList.remove("hidden");let t=eventModal.querySelector(".invoiced");1==e.event.extendedProps.is_invoiced?t.classList.remove("hidden"):t.classList.add("hidden");let n=eventModal.querySelector(".billed");1==e.event.extendedProps.is_billed?n.classList.remove("hidden"):n.classList.add("hidden");let i=eventModal.querySelector(".payed");1==e.event.extendedProps.is_payed?i.classList.remove("hidden"):i.classList.add("hidden");let a=eventModal.querySelector(".happened");1==e.event.extendedProps.is_happened?a.classList.remove("hidden"):a.classList.add("hidden")}let r=eventModal.querySelector(".series"),s=eventModal.querySelector(".previous"),c=eventModal.querySelector(".following"),l=eventModal.querySelector(".following-last"),u=eventModal.querySelector(".btn-deletefollowing"),m=s.querySelector("ul");m.innerHTML="";let p=c.querySelector("ul");p.innerHTML="",null!=e.event.extendedProps.reference_sheet||e.event.extendedProps.series.length>0?(r.classList.remove("hidden"),r.querySelector(".count").innerHTML=e.event.extendedProps.series.length,e.event.extendedProps.previous.length>0?(s.classList.remove("hidden"),e.event.extendedProps.previous.forEach((e=>{const t=document.createElement("li");t.textContent=e,m.appendChild(t)}))):s.classList.add("hidden"),e.event.extendedProps.remaining.length>0?(l.classList.add("hidden"),c.classList.remove("hidden"),e.event.extendedProps.remaining.forEach((e=>{const t=document.createElement("li");t.textContent=e,p.appendChild(t)})),u.classList.remove("hidden")):(l.classList.remove("hidden"),c.classList.add("hidden"),u.classList.add("hidden"))):(r.classList.add("hidden"),r.querySelector(".count").innerHTML="",s.classList.add("hidden"),c.classList.add("hidden"),u.classList.add("hidden"));let h=eventModal.querySelector(".sheet-category-budgets-wrapper"),v=h.querySelector(".sheet-category-budgets");v.innerHTML="";const f=e.event.extendedProps.categorybudgets;f&&f.length>0?(h.classList.remove("hidden"),f.forEach((e=>{const t=document.createElement("div");t.classList.add("budget-entry");var n=document.createElement("h4"),i=e.name?e.name:"";e.start&&e.end&&(i+=" ("+moment(e.start).format(i18n.dateformatJS.date)+" - "+moment(e.en).format(i18n.dateformatJS.date)+")"),n.innerHTML=i,t.appendChild(n);var a=document.createElement("div");if(a.className="categories-list",e.category_names&&e.category_names.length>0?(a.innerHTML=lang.categories+": "+e.category_names,1==e.no_category&&(a.innerHTML=lang.categories+": "+e.category_names+", "+lang.timesheets_project_category_budget_entries_without_category)):1==e.no_category&&(a.innerHTML=lang.timesheets_project_category_budget_entries_without_category),t.appendChild(a),e.notice){var d=document.createElement("small");d.innerHTML=e.notice,t.appendChild(d)}var o=document.createElement("div");o.className="values";var r=document.createElement("span");r.innerHTML="0",o.appendChild(r);var s=document.createElement("span");s.innerHTML="count"!==e.categorization?splitDateInterval(e.sum,!0):e.sum,o.appendChild(s);var c=document.createElement("span");c.innerHTML="count"!==e.categorization?splitDateInterval(e.value,!0):e.value,o.appendChild(c),t.appendChild(o);var l=document.createElement("div");l.className="progress-bar";var u="green";e.warning3>0&&e.sum>=e.warning3?u="red":e.warning2>0&&e.sum>=e.warning2?u="orange":e.warning1>0&&e.sum>=e.warning1&&(u="yellow");var m=document.createElement("div");if(m.className="progress "+u,m.style.width=e.percent+"%",parseFloat(e.percent)>=25&&(m.innerHTML=e.percent+"%"),l.appendChild(m),e.percent&&parseFloat(e.percent)<25){var p=document.createElement("div");p.className="progress progress-text",p.innerHTML=e.percent+"%",l.appendChild(p)}if(t.appendChild(l),null!==e.diff&&void 0!==e.diff){var h=document.createElement("div");h.className="remaining",h.innerHTML=lang.remaining+": "+("count"!==e.categorization?splitDateInterval(e.diff,!0):e.diff),t.appendChild(h)}v.appendChild(t)}))):h.classList.add("hidden");let g=eventModal.querySelector(".requirements-wrapper"),y=g.querySelector(".requirements");y.innerHTML="";const L=e.event.extendedProps.customer_requirements;L?(g.classList.remove("hidden"),L.forEach((e=>{const t=document.createElement("div");t.classList.add("requirement-entry");var n=document.createElement("span");if(e.is_valid?(t.classList.add("valid"),n.innerHTML=e.requirement_type_name+": "+lang.timesheets_requirements_done):(t.classList.add("invalid"),n.innerHTML=e.requirement_type_name+": "+lang.timesheets_requirements_open),t.appendChild(n),!e.is_valid){let n=document.createElement("a");n.href=e.url;let i=document.createElement("button");i.type="button",i.classList.add("button","small","button-text"),i.textContent=lang.add,n.appendChild(i),t.appendChild(n)}y.appendChild(t)}))):g.classList.add("hidden");let S=eventModal.querySelector(".sheet-notice-btn a");e.event.extendedProps.sheet_notice?(S.href=e.event.extendedProps.sheet_notice,S.classList.remove("hidden")):S.classList.add("hidden"),eventModal.querySelector(".btn-edit").href=e.event.extendedProps.edit,eventModal.querySelectorAll(".btn-delete").forEach((t=>{t.dataset.url=e.event.extendedProps.delete,e.event.extendedProps.has_sheet_notice?t.dataset.warning=lang.timesheets_sheets_delete_warning_notice:t.dataset.warning=""})),freeze(),eventModal.classList.add("visible")}});calendar.render(),document.getElementById("modal-close-btn").addEventListener("click",(function(e){hideEventModal()})),eventModal.addEventListener("click",(function(e){e.target===eventModal&&hideEventModal()}))}const checkBoxRepeat=document.querySelector("#checkBoxRepeat"),repeatsContent=document.querySelector(".repeats-content");checkBoxRepeat&&repeatsContent&&checkBoxRepeat.addEventListener("click",(function(e){checkBoxRepeat.checked?repeatsContent.classList.remove("hidden"):repeatsContent.classList.add("hidden")}));const dateTimePickerStartModified=document.querySelector("#datetimePickerStartModified");dateTimePickerStartModified&&flatpickr(dateTimePickerStartModified,{wrap:!0,altInput:!0,altFormat:i18n.dateformatTwig.datetimeShort,altInputClass:"datepicker dateTimePickerStartModified",dateFormat:"Y-m-d H:i",locale:i18n.template,enableTime:!0,time_24hr:!0,minuteIncrement:1});const checkBoxDateModified=document.querySelector("#checkBoxDateModified"),dateModifiedContent=document.querySelector(".date-modified-content");function hideEventModal(){unfreeze(),eventModal&&eventModal.classList.remove("visible")}checkBoxDateModified&&dateModifiedContent&&checkBoxDateModified.addEventListener("click",(function(e){checkBoxDateModified.checked?dateModifiedContent.classList.remove("hidden"):(dateModifiedContent.classList.add("hidden"),dateTimePickerStartModified._flatpickr.clear())})),document.addEventListener("click",(function(e){let t=e.target.closest(".checkAllRows");if(t){document.querySelectorAll('#timesheets_sheets_table input[type="checkbox"]').forEach((function(e){t.checked?e.checked=!0:e.checked=!1})),selectedItems.innerHTML=getSelectedSheets().length}e.target.closest('#timesheets_sheets_table tbody input[type="checkbox"]')&&(selectedItems.innerHTML=getSelectedSheets().length),e.target.closest("#event-modal a")&&hideEventModal()})),document.addEventListener("keydown",(function(e){"Escape"!==e.key&&27!==e.keyCode||hideEventModal()}));const timesheetsExportOverviewFilter=document.getElementById("timesheets-export-overview-filter");if(timesheetsExportOverviewFilter){function l(e){e.checked&&"html-overview"===e.value?timesheetsExportOverviewFilter.classList.remove("hidden"):timesheetsExportOverviewFilter.classList.add("hidden")}document.querySelectorAll('.search-filter input[name="type"]').forEach((function(e){l(e),e.addEventListener("click",(function(t){l(e)}))}))}