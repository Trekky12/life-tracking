"use strict";const exercisesSession=document.querySelector("#workoutExercises .workout-selection-content"),workoutElements=exercisesSession.querySelectorAll('[data-type="workout-element"]'),selectWorkoutDay=document.querySelector("#workoutsDaySelect"),addExerciseBtn=document.querySelector("#addExercise");let exercises=Array.from(workoutElements);function setFields(e,t){t?e.classList.add("hidden"):e.classList.remove("hidden"),e.querySelectorAll("input, textarea, select").forEach((function(e,s){t?e.setAttribute("disabled",!0):-1===e.name.indexOf("dummy")&&e.removeAttribute("disabled")}))}function setNextUnfinishedWorkoutElementActive(e=null){let t;null!==e&&(t=exercises.find((t=>Number(t.dataset.idx)>e&&"0"==t.dataset.finished))),t||(t=exercises.find((e=>"0"==e.dataset.finished))),t&&(t.querySelectorAll(".view-exercise").forEach((function(e){e.classList.add("active")})),t.scrollIntoView({block:"start",smooth:"smooth"}))}async function saveExercise(e){let t=e.closest("form"),s=new FormData(t),o=await getCSRFToken();s.append("csrf_name",o.csrf_name),s.append("csrf_value",o.csrf_value);let i=await fetch(jsObject.workouts_sessions_exercise_save,{method:"POST",credentials:"same-origin",body:s}),r=await i.json();if("success"!==r.status)throw console.error("Unable to save exercise"),"Error saving exercise";return r}addExerciseBtn.addEventListener("click",(function(e){let t=document.querySelector("#addExerciseToSession select").value,s=document.querySelector("#setCount").value,o=document.querySelector("#setRepeat").value,i=document.querySelector("#setWeight").value,r=exercisesSession.dataset.view,c=exercisesSession.querySelectorAll('[data-type="workout-element"]').length;return fetch(jsObject.workouts_exercises_data+"?exercise="+t+"&sets="+s+"&repeat="+o+"&weight="+i+"&count="+c+"&view="+r,{method:"GET",credentials:"same-origin",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if("error"!==e.status){exercisesSession.insertAdjacentHTML("beforeend",e.data);let t=exercisesSession.lastElementChild.querySelector('[data-type="workout-element"]');exercises.push(t),showToast(lang.workouts_exercise_added,"blue")}})).catch((function(e){console.log(e)}))})),selectWorkoutDay?selectWorkoutDay.addEventListener("change",(async function(e){let t=selectWorkoutDay.value,s=!1;if(exercises=[],workoutElements.forEach((function(e,o){s?(setFields(e,!1),exercises.push(e)):setFields(e,!0),"day"==e.dataset.category&&(e.dataset.id==t?(s=!0,setFields(e,!1)):(s=!1,setFields(e,!0)))})),"create"==exercisesSession.dataset.view){selectWorkoutDay.setAttribute("disabled",!0),setNextUnfinishedWorkoutElementActive();let e=exercisesSession.querySelector(".workout_day_split:not(.hidden)");await saveExercise(e)}})):"create"==exercisesSession.dataset.view&&setNextUnfinishedWorkoutElementActive(),document.addEventListener("click",(async function(e){let t=e.target.closest("button.save_exercise"),s=e.target.closest("button.skip_exercise"),o=e.target.closest('[data-type="workout-element"][data-finished="0"]');if(t){let e=t.closest('[data-type="workout-element"]'),s=Number(e.dataset.idx);return await saveExercise(e),e.dataset.finished=1,e.querySelectorAll(".view-exercise").forEach((function(e){e.classList.remove("active")})),void setNextUnfinishedWorkoutElementActive(s)}if(s){let e=s.closest('[data-type="workout-element"]'),t=Number(e.dataset.idx);return e.querySelectorAll(".view-exercise").forEach((function(e){e.classList.remove("active")})),void setNextUnfinishedWorkoutElementActive(t)}if(o&&"create"==exercisesSession.dataset.view)return exercises.forEach((function(e){e.querySelectorAll(".view-exercise").forEach((function(e){e.classList.remove("active")}))})),o.querySelectorAll(".view-exercise").forEach((function(e){e.classList.add("active")})),void o.scrollIntoView({block:"start",smooth:"smooth"})}));