{% extends "base.twig" %}

{% set active = 'crawlers' %}

{% block style %}

{% endblock %}

{% block javascript %}
    <script src="{{base_url()}}/static/js/datefilter.js?ver=20190306"></script>
    <script src="{{base_url()}}/static/js/crawler.js?ver=20190306"></script>
{% endblock %}

{% block body %}
    <div class="inner-content">
        <div class="page-header"><h2>{{crawler.name|raw}}</div>
        <div class="page-content">
            <form method="GET" id="crawler-filter" class="">

                <div class="date-filter">
                    <div class="date-element">
                        <input type="text" id="dateRange" value="{{from}} to {{to}}" />

                        <input type="hidden" id="inputStart" name="from" value="{{from}}"/>
                        <input type="hidden" id="inputEnd" name="to" value="{{to}}"/>
                    </div>
                    <div class="btn-element">
                        <input type="submit" value="{{lang["SHOW"]}}"/>
                    </div>
                </div>
                <div class="filter-element">
                    <select class="form-control" id="filterCrawlerDatasets" >
                        <option value="createdOn" {% if filter =="createdOn" %}selected{% endif %}>{{lang["SHOW_ONLY_NEW_ENTRIES"]}}</option>
                        <option value="changedOn" {% if filter =="changedOn" %}selected{% endif %}>{{lang["SHOW_NEW_UPDATED_ENTRIES"]}}</option>
                    </select>
                </div>

            </form>   

            <table id="crawlers_data_table" class="table table-hover small">
                <thead>
                    <tr>
                        <th>{{lang["DATE_CRAWL"]}}</th>
                            {% for header in headers %}
                            <th>{{header.headline}}</th>
                            {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for dataset in datasets %}
                        <tr>
                            <th>{% if filter == "createdOn" %}{{dataset.createdOn}}{% else %}{{dataset.changedOn}}{% endif %}</th>
                                {% for header in headers %}
                                <td>
                                    {% if not header.field_link is empty %}
                                        <a href="{{dataset.getDataValue(header.field_link)}}" target="_blank">
                                        {% endif %}

                                        {% if not header.field_content is empty %}
                                            {{header.getFieldContent()|raw}}
                                        {% else %}
                                            {{dataset.getDataValue(header.field_name)}}
                                        {% endif %}

                                        {% if not header.field_link is empty %}
                                        </a>
                                    {% endif %}
                                </td>
                            {% endfor %}    
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
    </div>

{% endblock %}        
