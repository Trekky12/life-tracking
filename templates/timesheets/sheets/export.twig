{% extends "base.twig" %}

{% set active = 'timesheets' %}

{% block style %}
	<link rel="stylesheet" type="text/css" href="{{baseURL}}/static/assets/css/selectr.min.css?ver={{CACHEMISS}}"/>
{% endblock %}

{% block javascript %}
	<script src="{{baseURL}}/static/js/datefilter.js?ver={{CACHEMISS}}"></script>
	<script src="{{baseURL}}/static/assets/js/selectr.min.js?ver={{CACHEMISS}}"></script>
	<script src="{{baseURL}}/static/js/timesheets.js?ver={{CACHEMISS}}"></script>
{% endblock %}

{% block pageheader %}
	<div class="page-header">
		<div class="page-headline">
			<a href="{{ url_for_with_last_query_params('timesheets')}}">
				<div tabindex="-1" class="icon-ripple-wrapper back-arrow">{{ fontawesome('fas fa-arrow-left') }}</div>
			</a>
			<h2>{{"TIMESHEETS"|trans}}
				|
				{{project.name|raw}}</h2>
		</div>
	</div>
{% endblock %}

{% block tabbar %}
	{% include "timesheets/timesheet-sheets-tabs.twig" with {'active':'timesheets_export'} %}
{% endblock %}

{% block body %}
	<div class="inner-content">
		<div class="page-content">

			<form method="GET" action="{{ url_for('timesheets_sheets_export', {'project' : project.hash}) }}" class="search-filter">

				<input type="hidden" id="inputStart" name="from" value="{{from}}"/>
				<input type="hidden" id="inputEnd" name="to" value="{{to}}"/>
				<div class="filter-row space-between">
					<div class="filter-element">
						<div class="flatpickr-group" id="dateRange">
							<input type="text" value="{{from}} to {{to}}" data-input/>

							<a class="flatpickr-input-button" title="toggle" data-toggle>
								{{ fontawesome('fas fa-calendar-days') }}
							</a>

							<a class="flatpickr-input-button" title="clear" data-clear>
								{{ fontawesome('fas fa-xmark') }}
							</a>
						</div>
					</div>
					{% if project.show_quarters_buttons == 1 %}
						<div class="filter-group">
							<div class="filter-element">
								<button type="button" class="button button-outlined small daterange-filter-btn" data-from="{{ quarters["last"]["start"] }}" data-to="{{ quarters["last"]["end"] }}">{{ quarters["last"]["name"] }}</button>
							</div>
							<div class="filter-element">
								<button type="button" class="button button-outlined small daterange-filter-btn" data-from="{{ quarters["current"]["start"] }}" data-to="{{ quarters["current"]["end"] }}">{{ quarters["current"]["name"] }}</button>
							</div>
							<div class="filter-element">
								<button type="button" class="button button-outlined small daterange-filter-btn" data-from="{{ quarters["next"]["start"] }}" data-to="{{ quarters["next"]["end"] }}">{{ quarters["next"]["name"] }}</button>
							</div>
						</div>
					{% endif %}
					<div class="filter-group">
						{% if project.show_week_button == 1 %}
							<div class="filter-element">
								<button type="button" class="button button-outlined small daterange-filter-btn" data-from="{{ min["week"] }}" data-to="{{ max["week"] }}">{{ "SHOW_THIS_WEEK"|trans }}</button>
							</div>
						{% endif %}
						{% if project.show_month_button == 1 %}
							<div class="filter-element">
								<button type="button" class="button button-outlined small daterange-filter-btn" data-from="{{ min["month"] }}" data-to="{{ max["month"] }}">{{ "SHOW_THIS_MONTH"|trans }}</button>
							</div>
						{% endif %}
						<div class="filter-element">
							<button type="button" class="button button-outlined small daterange-filter-btn" data-from="{{ min["total"] }}" data-to="{{ max["total"] }}">{{ "SHOW_COMPLETE_RANGE"|trans }}</button>
						</div>
					</div>
				</div>

				{% if categories %}
					<div class="filter-row">
						<div class="categories-filter filter-element">
							<select id="category-filter" multiple name="categories[]" class="category" autocomplete="off">
								{% for cat in categories %}
									<option value="{{ cat.id }}" {% if cat.id in categories_selected %} selected {% endif %}>{{ cat.name }}</option>
								{% endfor %}
							</select>
						</div>
					</div>
				{% endif %}
				<div class="filter-grid">
					{% if customers %}
						<label for="timesheet_view_customer">
							{% if project.customers_name_singular %}
								{{project.customers_name_singular}}
							{% else %}
								{{"TIMESHEETS_CUSTOMER"|trans}}
							{% endif %}:</label>
						<div class="select-wrapper">
							<select class="regular" id="timesheet_view_customer" name="customer">
								<option value="" {% if customer is null %} selected {% endif %}>{{ "ALL"|trans }}</option>
								{% for c in customers %}
									<option value="{{c.id}}" {% if c.id == customer %} selected {% endif %}>{{c.name|raw}}</option>
								{% endfor %}
							</select>
						</div>
					{% endif %}
					{% if project.has_billing %}
						<label for="timesheet_view_happened">{{"TIMESHEETS_HAPPENED"|trans}}:</label>
						<div class="select-wrapper">
							<select name="happened" id="timesheet_view_happened" class="regular">
								<option value="" {% if happened is null or happened is same as("") %} selected {% endif %}>{{"TIMESHEETS_PLANNED_AND_HAPPENED"|trans}}</option>
								<option value="0" {% if happened is same as(0) %} selected {% endif %}>{{"TIMESHEETS_PLANNED"|trans}}</option>
								<option value="1" {% if happened is same as(1) %} selected {% endif %}>{{"TIMESHEETS_HAPPENED"|trans}}</option>
							</select>
						</div>
						<label for="timesheet_view_invoiced">{{"TIMESHEETS_INVOICED"|trans}}:</label>
						<div class="select-wrapper">
							<select name="invoiced" id="timesheet_view_invoiced" class="regular">
								<option value="" {% if invoiced is null or invoiced is same as("") %} selected {% endif %}>{{"TIMESHEETS_INVOICED_AND_NOT_INVOICED"|trans}}</option>
								<option value="1" {% if invoiced is same as(1) %} selected {% endif %}>{{"TIMESHEETS_INVOICED"|trans}}</option>
								<option value="0" {% if invoiced is same as(0) %} selected {% endif %}>{{"TIMESHEETS_NOT_INVOICED"|trans}}</option>
							</select>
						</div>
						<label for="timesheet_view_billed">{{"TIMESHEETS_BILLED"|trans}}:</label>
						<div class="select-wrapper">
							<select name="billed" id="timesheet_view_billed" class="regular">
								<option value="" {% if billed is null or billed is same as("") %} selected {% endif %}>{{"TIMESHEETS_BILLED_AND_NOT_BILLED"|trans}}</option>
								<option value="1" {% if billed is same as(1) %} selected {% endif %}>{{"TIMESHEETS_BILLED"|trans}}</option>
								<option value="0" {% if billed is same as(0) %} selected {% endif %}>{{"TIMESHEETS_NOT_BILLED"|trans}}</option>
							</select>
						</div>
						<label for="timesheet_view_payed">{{"TIMESHEETS_PAYED"|trans}}:</label>
						<div class="select-wrapper">
							<select name="payed" id="timesheet_view_payed" class="regular">
								<option value="" {% if payed is null or payed is same as("") %} selected {% endif %}>{{"TIMESHEETS_PAYED_AND_NOT_PAYED"|trans}}</option>
								<option value="1" {% if payed is same as(1) %} selected {% endif %}>{{"TIMESHEETS_PAYED"|trans}}</option>
								<option value="0" {% if payed is same as(0) %} selected {% endif %}>{{"TIMESHEETS_NOT_PAYED"|trans}}</option>
							</select>
						</div>
					{% endif %}
				</div>

				<div class="form-group">
					<div>
						<label class="radio" for="radioExcel">
							<input name="type" type="radio" value="excel" id="radioExcel" checked>
							{{"EXPORT_EXCEL"|trans}}
						</label>
					</div>
					<div class="hidden">
						<label class="radio" for="radioWord">
							<input name="type" type="radio" value="word" id="radioWord">
							{{"EXPORT_WORD"|trans}}
						</label>
					</div>
					<div>
						<label class="radio" for="radioHTML">
							<input name="type" type="radio" value="html" id="radioHTML">
							{{"EXPORT_HTML_WITH_NOTICES"|trans}}
						</label>
					</div>
					{% if customers %}
						<div>
							<label class="radio" for="radioHTMLOverview">
								<input name="type" type="radio" value="html-overview" id="radioHTMLOverview">
								{{"EXPORT_HTML_TABLE_OVERVIEW"|trans}}
								{% if project.customers_name_plural %}
									{{project.customers_name_plural}}
								{% else %}
									{{"TIMESHEETS_CUSTOMERS"|trans}}
								{% endif %}
							</label>
						</div>
					{% endif %}
				</div>
				<div class="form-group hidden" id="noticefieldsfilter">
					<div class="filter-row">
						<div class="categories-filter filter-element">
							<select id="noticefields-filter" multiple name="noticefields[]" class="noticefield" autocomplete="off">
								{% for field in customer_fields %}
									<option value="{{ field.id }}">{{ field.description | raw }}</option>
								{% endfor %}
							</select>
						</div>
					</div>
				</div>

				<div>
					<input type="submit" class="button no-loading" value="{{"TIMESHEETS_EXPORT"|trans}}"/>
				</div>
			</form>
		</div>
	</div>


{% endblock %}
